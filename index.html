<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>USCash üéÆ</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
:root {
  --primary: #1E3A8A; /* Changed to dark blue */
  --secondary: #2563EB; /* Brighter blue */
  --dark: #0A0A0A;
  --light: #FFFFFF;
  --accent: #FF6347;
  --gold: #FFD700; /* Kept for some elements */
}

body {
  font-family: 'Poppins', sans-serif;
  background-color: var(--dark);
  color: var(--light);
  text-align: center;
  margin: 0;
  padding: 0;
  background-image:
    radial-gradient(circle at 10% 20%, rgba(30, 58, 138, 0.1) 0%, transparent 20%),
    radial-gradient(circle at 90% 80%, rgba(37, 99, 235, 0.1) 0%, transparent 20%);
}

h1 {
  font-size: 2.8rem;
  background: linear-gradient(90deg, var(--secondary), var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 0 10px rgba(37, 99, 235, 0.3);
  margin: 20px 0;
  letter-spacing: 2px;
  position: relative;
  display: inline-block;
}

h1::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 0;
  width: 100%;
  height: 3px;
  background: linear-gradient(90deg, transparent, var(--secondary), transparent);
}

.nav {
  background: linear-gradient(90deg, var(--dark), var(--primary), var(--dark));
  color: var(--light);
  padding: 12px;
  display: flex;
  justify-content: space-around;
  flex-wrap: wrap;
  box-shadow: 0 4px 12px rgba(30, 58, 138, 0.2);
  position: relative;
  z-index: 100;
}

.nav a {
  color: var(--light);
  text-decoration: none;
  font-weight: bold;
  padding: 8px 15px;
  border-radius: 20px;
  transition: all 0.3s;
  font-size: 1.1rem;
}

.nav a:hover {
  background-color: var(--primary);
  color: var(--light);
  transform: translateY(-3px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.section {
  margin: 30px auto;
  padding: 25px;
  max-width: 900px;
  border: 2px solid var(--primary);
  border-radius: 15px;
  box-sizing: border-box;
  background-color: rgba(10, 10, 10, 0.8);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
  position: relative;
  overflow: hidden;
}

.section::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border: 2px solid transparent;
  border-image: linear-gradient(45deg, var(--primary), var(--secondary)) 1;
  z-index: -1;
  animation: borderRotate 8s linear infinite;
}

@keyframes borderRotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.gold-box {
  display: inline-block;
  background: linear-gradient(145deg, var(--secondary), var(--primary));
  color: var(--light);
  margin: 8px;
  padding: 12px 20px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1.1rem;
  font-weight: bold;
  transition: all 0.3s;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  border: none;
}

.gold-box:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(37, 99, 235, 0.3);
  background: linear-gradient(145deg, var(--secondary), var(--primary));
}

.gold-box.active {
  background: var(--dark);
  color: var(--secondary);
  border: 2px solid var(--secondary);
  box-shadow: 0 0 15px var(--secondary);
}

.game-options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  align-items: center;
  justify-content: center;
  padding: 20px 0;
}

.game-options .gold-box {
  width: 100%;
  height: 180px;
  font-size: 1.4rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--secondary);
  box-shadow: 0 0 20px rgba(37, 99, 235, 0.3);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  background-size: cover;
  background-position: center;
  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
}

.game-options .gold-box::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 0;
}

.game-options .gold-box > * {
  position: relative;
  z-index: 1;
}

.game-options .gold-box:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px var(--secondary);
}

.game-options .gold-box i {
  font-size: 3rem;
  margin-bottom: 15px;
  color: var(--secondary);
  text-shadow: 0 0 10px rgba(37, 99, 235, 0.8);
}

/* Game specific thumbnails */
.scratch-thumbnail {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIiBmaWxsPSJub25lIj48cGF0aCBkPSJNNDAgNDBIMTYwVjE2MEg0MFY0MFoiIGZpbGw9IiMxRTNBOEEiIHN0cm9rZT0iIzI1NjNFQiIgc3Ryb2tlLXdpZHRoPSIyIi8+PHJlY3QgeD0iNjAiIHk9IjYwIiB3aWR0aD0iODAiIGhlaWdodD0iODAiIGZpbGw9IiMyNTYzRUIiLz48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjMwIiBmaWxsPSIjMUUzQThBIi8+PHBhdGggZD0iTTgwIDgwTDEyMCAxMjBNMTIwIDgwTDgwIDEyMCIgc3Ryb2tlPSIjMjU2M0VCIiBzdHJva2Utd2lkdGg9IjQiLz48L3N2Zz4=');
}

.fruit-thumbnail {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cGF0aCBkPSJNMTUwIDEwMEMxNTAgNzIgMTI4IDUwIDEwMCA1MEM3MiA1MCA1MCA3MiA1MCAxMDBTNzIgMTUwIDEwMCAxNTBTMTUwIDEyOCAxNTAgMTAwWiIgZmlsbD0iI0ZGMDAwMCIvPjxwYXRoIGQ9Ik0xMjAgOTBDMTIwIDcyIDEwNiA2MCA5MCA2MEM3NCA2MCA2MCA3MiA2MCA5MFM3NCAxMjAgOTAgMTIwUzEyMCAxMDggMTIwIDkwWiIgZmlsbD0iIzI1NjNFQiIvPjxwYXRoIGQ9Ik04NSA3NUw3NSA4NUw4NSA4NUw3NSA3NSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjIiLz48cGF0aCBkPSJNMTE1IDk1TDEwNSAxMDVNMTE1IDEwNUwxMDUgOTUiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTkwIDQwVjYwTTExMCA0MFY2MCIgc3Ryb2tlPSIjMDA4MDAwIiBzdHJva2Utd2lkdGgPSI0Ii8+PC9zdmc+');
}

.tictactoe-thumbnail {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cGF0aCBkPSJNNjcgNjdoNjZ2NjZINjdaTTY3IDY3aDY2djY2SDY3WiIgZmlsbD0iIzFFM0E4QSIgZmlsbC1vcGFjaXR5PSIwLjEiLz48cGF0aCBkPSJNMTAwIDMzVjE2N00zMyAxMDBIMTY3IiBzdHJva2U9IiMxRTNBOEEiIHN0cm9rZS13aWR0aD0iNCIvPjxwYXRoIGQ9Ik02NyA2N0wxMzMgMTMzTTY3IDEzM0wxMzMgNjciIHN0cm9rZT0iIzI1NjNFQiIgc3Ryb2tlLXdpZHRoPSI2Ii8+PC9zdmc+');
}

.findace-thumbnail {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cGF0aCBkPSJNNDAgNDBIMTYwVjE2MEg0MFY0MFoiIGZpbGw9IiMxRTNBOEEiLz48cGF0aCBkPSJNNjAgNjBIMTQwVjE0MEg2MFY2MFoiIGZpbGw9IiMyNTYzRUIiLz48cGF0aCBkPSJNODAgODBIMTIwVjEyMEg4MFY4MFoiIGZpbGw9IiMxRTNBOEEiLz48cGF0aCBkPSJNODUgODVIMTE1VjExNUg4NVY4NVoiIGZpbGw9IiMyNTYzRUIiLz48cGF0aCBkPSJNOTAgOTBIMTExVjExMEg5MFY5MFoiIGZpbGw9IiMxRTNBOEEiLz48cGF0aCBkPSJNOTUgOTVIMTA1VjEwNUg5NVY5NVoiIGZpbGw9IiMyNTYzRUIiLz48cGF0aCBkPSJNMTAwIDEwMEgxMDBWMTAwSDEwMFoiIGZpbGw9IiMxRTNBOEEiLz48L3N2Zz4=');
}

.archery-thumbnail {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjMjU2M0VCIi8+PGNpcmNsZSBjeD0iMTAwIiBjeT0iMTAwIiByPSI2MCIgZmlsbD0iIzFFM0E4QSIvPjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iNDAiIGZpbGw9IiMwMDgwMDAiLz48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjIwIiBmaWxsPSIjRkYwMDAwIi8+PGNpcmNsZSBjeD0iMTAwIiBjeT0iMTAwIiByPSIxMCIgZmlsbD0iIzI1NjNFQiIvPjxwYXRoIGQ9Ik0xODAgMTAwSDE2ME0xNjAgMTAwSDE0ME0xNDAgMTAwSDEyME0xMjAgMTAwSDEwME0xMDAgMTAwSDgwTTgwIDEwMEg2ME02MCAxMDBINDBNNDAgMTAwSDIwIiBzdHJva2U9IiMxRTNBOEEiIHN0cm9rZS13aWR0aD0iMiIvPjxwYXRoIGQ9Ik0xODAgMTAwSDE2ME0xNjAgMTAwSDE0ME0xNDAgMTAwSDEyME0xMjAgMTAwSDEwME0xMDAgMTAwSDgwTTgwIDEwMEg2ME02MCAxMDBINDBNNDAgMTAwSDIwIiBzdHJva2U9IiMxRTNBOEEiIHN0cm9rZS13aWR0aD0iMiIgdHJhbnNmb3JtPSJyb3RhdGUoOTAgMTAwIDEwMCkiLz48cGF0aCBkPSJNMTcwIDEwMEgxMzBNMzAgMTAwSDcwIiBzdHJva2U9IiMxRTNBOEEiIHN0cm9rZS13aWR0aD0iMiIgdHJhbnNmb3JtPSJyb3RhdGUoNDUgMTAwIDEwMCkiLz48cGF0aCBkPSJNMTcwIDEwMEgxMzBNMzAgMTAwSDcwIiBzdHJva2U9IiMxRTNBOEEiIHN0cm9rZS13aWR0aD0iMiIgdHJhbnNmb3JtPSJyb3RhdGUoMTM1IDEwMCAxMDApIi8+PC9zdmc+');
}

.chess-thumbnail {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cGF0aCBkPSJNNDAgNDBIMTYwVjE2MEg0MFY0MFoiIGZpbGw9IiMxRTNBOEEiLz48cGF0aCBkPSJNNjAgNjBIMTQwVjE0MEg2MFY2MFoiIGZpbGw9IiMyNTYzRUIiLz48cmVjdCB4PSI2MCIgeT0iNjAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iIzFFM0E4QSIvPjxyZWN0IHg9IjEwMCIgeT0iNjAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iIzFFM0E4QSIvPjxyZWN0IHg9IjE0MCIgeT0iNjAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iIzFFM0E4QSIvPjxyZWN0IHg9IjgwIiB5PSI4MCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjMUUzQThBIi8+PHJlY3QgeD0iMTIwIiB5PSI4MCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjMUUzQThBIi8+PHJlY3QgeD0iNjAiIHk9IjEwMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjMUUzQThBIi8+PHJlY3QgeD0iMTAwIiB5PSIxMDAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iIzFFM0E4QSIvPjxyZWN0IHg9IjE0MCIgeT0iMTAwIiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIGZpbGw9IiMxRTNBOEEiLz48cmVjdCB4PSI4MCIgeT0iMTIwIiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIGZpbGw9IiMxRTNBOEEiLz48cmVjdCB4PSIxMjAiIHk9IjEyMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjMUUzQThBIi8+PHBhdGggZD0iTTg1IDc1Vjg1TTg1IDk1VjEwNU04NSAxMTVWMTI1TTExNSA3NVY4NU0xMTUgOTVWMTA1TTExNSAxMTVWMTI1TTc1IDg1SDg1TTk1IDg1SDEwNU0xMDUgODVIMTE1TTEyNSA4NUgxMzVNMTM1IDg1SDE0NU03NSA5NUg4NU05NSA5NUgxMDVNMTI1IDk1SDEzNU0xMzUgOTVIMTQ1TTc1IDEwNUg4NU05NSAxMDVIMTA1TTEyNSAxMDVIMTM1TTEzNSAxMDVIMTQ1TTc1IDExNUg4NU05NSAxMTVIMTA1TTEyNSAxMTVIMTM1TTEzNSAxMTVIMTQ1IiBzdHJva2U9IiMyNTYzRUIiIHN0cm9rZS13aWR0aD0iMiIvPjwvc3ZnPg==');
}

.card-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  margin: 20px auto;
  max-width: 450px;
}

.card {
  width: 90px;
  height: 110px;
  background-color: white;
  color: black;
  font-size: 2.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--secondary);
  border-radius: 10px;
  cursor: pointer;
  transition: transform 0.4s, background-color 0.3s;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  background-size: cover;
  background-position: center;
  position: relative;
  transform-style: preserve-3d;
}

.card .front, .card .back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
}

.card .front {
  background: linear-gradient(145deg, var(--secondary), var(--primary));
  color: var(--light);
  transform: rotateY(180deg);
}

.card .back {
  background: white;
  border: 2px solid var(--secondary);
}

.card.flipped {
  transform: rotateY(180deg);
}

.bet-amounts {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}

#result {
  margin-top: 20px;
  font-size: 1.3rem;
  color: var(--light);
  padding: 10px;
  border-radius: 8px;
  background-color: rgba(0, 0, 0, 0.5);
}

.shake {
  animation: shake 0.5s;
}

.glow {
  animation: glow 1s infinite alternate;
}

@keyframes shake {
  0% { transform: translate(1px, 1px) rotate(0deg); }
  20% { transform: translate(-3px, 0px) rotate(-2deg); }
  40% { transform: translate(3px, 2px) rotate(2deg); }
  60% { transform: translate(-2px, 1px) rotate(0deg); }
  80% { transform: translate(2px, -1px) rotate(2deg); }
  100% { transform: translate(1px, 1px) rotate(0deg); }
}

@keyframes glow {
  from { box-shadow: 0 0 10px var(--secondary); }
  to { box-shadow: 0 0 20px var(--light); }
}

#particles-js {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 999;
  display: none;
}

#welcomePopup {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

#welcomePopup .popup-content {
  background: var(--dark);
  border: 2px solid var(--secondary);
  padding: 30px;
  border-radius: 15px;
  max-width: 450px;
  color: var(--light);
  text-align: center;
  position: relative;
  box-shadow: 0 0 30px var(--secondary);
  animation: popupEnter 0.5s ease-out;
}

@keyframes popupEnter {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

#welcomePopup .popup-content h2 {
  color: var(--secondary);
  margin-top: 0;
  font-size: 1.8rem;
}

#welcomePopup .popup-content .close {
  position: absolute;
  top: 15px;
  right: 20px;
  cursor: pointer;
  font-weight: bold;
  color: var(--accent);
  font-size: 24px;
  transition: transform 0.3s;
}

#welcomePopup .popup-content .close:hover {
  transform: rotate(90deg);
}

/* ŸÅÿ±ŸàŸπ ÿ¥ŸàŸπÿ± ⁄Ø€åŸÖ ⁄©€í ŸÑ€å€í ÿßÿ∂ÿßŸÅ€å ÿ≥Ÿπÿßÿ¶ŸÑÿ≤ */
#fruitGame {
  display: none;
}

.shoot-area {
  position: relative;
  height: 400px;
  border: 3px dashed var(--secondary);
  border-radius: 15px;
  background-color: #222;
  overflow: hidden;
  margin-top: 20px;
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
}

.fruit {
  position: absolute;
  font-size: 3.5em;
  cursor: pointer;
  user-select: none;
  pointer-events: auto;
  transition: transform 0.1s;
  z-index: 10;
}

.fruit:hover {
  transform: scale(1.1);
}

#fruitTargetDisplay {
  font-size: 1.5em;
  margin: 15px 0;
  color: var(--light);
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
  display: inline-block;
}

#fruitScoreDisplay {
  margin-top: 15px;
  font-size: 1.3em;
  font-weight: bold;
}

#fruitCountdown {
  font-size: 1.4em;
  margin-top: 15px;
  color: var(--secondary);
  font-weight: bold;
}

/* Tic Tac Toe Styles */
#tictactoeGame {
  display: none;
}

.tic-tac-toe-board {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 8px;
  width: 320px;
  height: 320px;
  margin: 25px auto;
  background-color: rgba(37, 99, 235, 0.1);
  padding: 15px;
  border-radius: 15px;
}

.tic-tac-toe-cell {
  background-color: #222;
  border: 2px solid var(--secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3.5rem;
  cursor: pointer;
  transition: all 0.3s;
  color: var(--secondary);
}

.tic-tac-toe-cell:hover {
  background-color: #333;
  transform: scale(1.05);
}

.tic-tac-toe-cell.x {
  color: var(--secondary);
  text-shadow: 0 0 10px var(--secondary);
}

.tic-tac-toe-cell.o {
  color: var(--accent);
  text-shadow: 0 0 10px var(--accent);
}

#tictactoeResult {
  margin-top: 20px;
  font-size: 1.3rem;
  color: var(--light);
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
}

#tictactoeCountdown {
  font-size: 1.4rem;
  color: var(--secondary);
  font-weight: bold;
}

/* Find Ace Game Styles */
#findAceGame {
  display: none;
}

#findAceCountdown {
  font-size: 1.5rem;
  margin: 15px 0;
  color: var(--secondary);
  font-weight: bold;
}

#findAceResult {
  margin-top: 20px;
  font-size: 1.3rem;
  color: var(--light);
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
}

/* Archery Game Styles */
#archeryGame {
  display: none;
}

.archery-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.archery-canvas-container {
  position: relative;
  width: 520px;
  height: 520px;
  max-width: 100%;
  margin: 0 auto;
}

#archeryCanvas {
  background: transparent;
  border-radius: 12px;
  display: block;
  max-width: 100%;
  height: auto;
  border: 2px solid var(--secondary);
}

.archery-controls {
  display: flex;
  flex-direction: column;
  gap: 15px;
  width: 100%;
  max-width: 520px;
}

.archery-bets {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
}

.archery-score-row {
  display: flex;
  justify-content: center;
  gap: 10px;
}

.archery-score-box {
  width: 48px;
  height: 48px;
  border-radius: 8px;
  background: linear-gradient(145deg, #222, #111);
  border: 2px solid var(--secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  color: var(--secondary);
}

#archeryStatus {
  font-size: 1.1rem;
  color: var(--light);
  text-align: center;
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
}

/* Chess Game Styles */
#chessGame {
  display: none;
}

.chess-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.chess-board {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  width: 400px;
  height: 400px;
  border: 3px solid var(--secondary);
  border-radius: 5px;
  overflow: hidden;
  box-shadow: 0 0 20px rgba(37, 99, 235, 0.3);
}

.chess-square {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  cursor: pointer;
  transition: all 0.2s;
}

.chess-square.light {
  background-color: #f0d9b5;
}

.chess-square.dark {
  background-color: #b58863;
}

.chess-square.selected {
  background-color: rgba(37, 99, 235, 0.5);
}

.chess-square.valid-move {
  background-color: rgba(144, 238, 144, 0.6);
}

.chess-controls {
  display: flex;
  flex-direction: column;
  gap: 15px;
  width: 100%;
  max-width: 400px;
}

#chessStatus {
  font-size: 1.1rem;
  color: var(--light);
  text-align: center;
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
}

#chessCountdown {
  font-size: 1.4rem;
  color: var(--secondary);
  font-weight: bold;
  margin: 10px 0;
}

/* Auth Modal Styles */
.auth-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.85);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.auth-content {
  background-color: var(--dark);
  border: 2px solid var(--secondary);
  padding: 30px;
  border-radius: 15px;
  width: 90%;
  max-width: 400px;
  color: var(--light);
  box-shadow: 0 0 30px var(--secondary);
  animation: modalFadeIn 0.4s ease-out;
}

@keyframes modalFadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.auth-tabs {
  display: flex;
  margin-bottom: 25px;
  border-bottom: 2px solid var(--secondary);
}

.auth-tab {
  flex: 1;
  padding: 12px;
  text-align: center;
  cursor: pointer;
  border-bottom: 3px solid transparent;
  font-weight: bold;
  transition: all 0.3s;
}

.auth-tab.active {
  border-bottom: 3px solid var(--secondary);
  color: var(--secondary);
}

.auth-tab:hover {
  background-color: rgba(37, 99, 235, 0.1);
}

.auth-form {
  display: none;
}

.auth-form.active {
  display: block;
}

.auth-form input {
  width: 100%;
  padding: 12px;
  margin-bottom: 18px;
  border-radius: 8px;
  border: 1px solid #444;
  background-color: #222;
  color: var(--light);
  font-size: 1rem;
  transition: all 0.3s;
}

.auth-form input:focus {
  outline: none;
  border-color: var(--secondary);
  box-shadow: 0 0 10px var(--secondary);
}

.auth-form button {
  width: 100%;
  padding: 12px;
  background: linear-gradient(145deg, var(--secondary), var(--primary));
  color: var(--light);
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  font-size: 1.1rem;
  transition: all 0.3s;
  margin-top: 10px;
}

.auth-form button:hover {
  background: linear-gradient(145deg, var(--secondary), var(--primary));
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
}

.auth-form button:disabled {
  background: #444;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.forgot-password {
  text-align: right;
  margin-top: -15px;
  margin-bottom: 20px;
  font-size: 0.9rem;
  color: var(--secondary);
  cursor: pointer;
  transition: color 0.3s;
}

.forgot-password:hover {
  color: var(--secondary);
  text-decoration: underline;
}

/* Balance and User Info Styles */
.user-info {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  margin: 20px 0;
  flex-wrap: wrap;
}

.balance-container {
  display: flex;
  align-items: center;
  gap: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  padding: 12px 20px;
  border-radius: 30px;
  border: 1px solid var(--secondary);
  box-shadow: 0 0 15px rgba(37, 99, 235, 0.2);
}

#balanceAmount {
  font-weight: bold;
  font-size: 1.2rem;
  color: var(--secondary);
}

.refresh-balance {
  cursor: pointer;
  color: var(--secondary);
  font-size: 1.3rem;
  transition: transform 0.3s;
}

.refresh-balance:hover {
  transform: rotate(180deg);
  color: var(--secondary);
}

#userDisplay {
  display: flex;
  align-items: center;
  background-color: rgba(0, 0, 0, 0.5);
  padding: 10px 20px;
  border-radius: 30px;
  border: 1px solid var(--secondary);
  box-shadow: 0 0 15px rgba(30, 144, 255, 0.2);
  gap: 10px;
}

#usernameDisplay {
  font-weight: bold;
  color: var(--secondary);
  font-size: 0.84rem; /* 40% smaller */
}

#phoneDisplay {
  font-weight: bold;
  color: var(--secondary);
  font-size: 0.84rem; /* 40% smaller */
}

.country-flag {
  width: 24px;
  height: 16px;
  border-radius: 2px;
  box-shadow: 0 0 5px rgba(0,0,0,0.3);
}

.verified-badge {
  color: var(--secondary);
  margin-left: 5px;
  font-size: 0.84rem; /* 40% smaller */
}

/* Deposit/Withdraw Styles */
#depositSection, #withdrawSection, #moreSection, #vipSection {
  display: none;
}

.form-group {
  margin-bottom: 20px;
  text-align: left;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: var(--secondary);
  font-weight: bold;
}

.form-group input, .form-group select {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #444;
  background-color: #222;
  color: var(--light);
  font-size: 1rem;
  transition: all 0.3s;
}

.form-group input:focus, .form-group select:focus {
  outline: none;
  border-color: var(--secondary);
  box-shadow: 0 0 10px var(--secondary);
}

.submit-btn {
  background: linear-gradient(145deg, var(--secondary), var(--primary));
  color: var(--light);
  border: none;
  padding: 12px 25px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  margin-top: 15px;
  font-size: 1.1rem;
  transition: all 0.3s;
  display: inline-block;
}

.submit-btn:hover {
  background: linear-gradient(145deg, var(--secondary), var(--primary));
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
}

.transaction-history {
  margin-top: 30px;
  max-height: 400px;
  overflow-y: auto;
  padding: 15px;
  background-color: rgba(0, 0, 0, 0.3);
  border-radius: 10px;
  border: 1px solid rgba(37, 99, 235, 0.3);
}

.transaction-item {
  background-color: rgba(30, 30, 30, 0.8);
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 8px;
  border-left: 4px solid var(--secondary);
  transition: transform 0.3s;
}

.transaction-item:hover {
  transform: translateX(5px);
}

.transaction-amount {
  font-weight: bold;
  font-size: 1.1rem;
}

.transaction-approved {
  color: lime;
}

.transaction-pending {
  color: var(--secondary);
}

.transaction-rejected {
  color: var(--accent);
}

/* VIP Section Styles */
.referral-code {
  background-color: rgba(0, 0, 0, ÊûÅÈÄüÈ£ûËâá
  padding: 15px;
  border-radius: 8px;
  font-family: monospace;
  margin: 15px 0;
  word-break: break-all;
  border: 1px solid var(--secondary);
  font-size: 1.2rem;
  color: var(--secondary);
  position: relative;
}

.referral-code-copy {
  position: absolute;
  right: 10px;
  top: 10px;
  color: var(--secondary);
  cursor: pointer;
  font-size: 1rem;
}

.referral-stats {
  display: flex;
  justify-content: space-around;
  margin: 25px 0;
  flex-wrap: wrap;
  gap: 15px;
}

.stat-box {
 ÊûÅÈÄüÈ£ûËâá
  padding: 20px;
  border-radius: 10px;
  border: 1px solid var(--secondary);
  min-width: 120px;
  flex: 1;
  transition: transform 0.3s;
}

.stat-box:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px ÊûÅÈÄüÈ£ûËâá
}

.stat-label {
  color: var(--light);
  margin-bottom: 10px;
  font-size: 0.9rem;
}

.stat-value {
  font-size: 1.8rem;
  font-weight: bold;
  color: var(--secondary);
}

/* Announcement Bar */
.announcement-bar {
  position: relative;
  background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.2), transparent);
  color: var(--light);
  padding: 12px 0;
  overflow: hidden;
  margin: 0 auto;
 ÊûÅÈÄüÈ£ûËâá
  border-top: 1px solid var(--secondary);
  border-bottom: 1px solid var(--secondary);
}

.announcement-content {
  display: inline-block;
  white-space: nowrap;
  padding-left: 100%;
  animation: scroll 20ÊûÅÈÄüÈ£ûËâá
  font-size: 1.1rem;
  text-shadow: 0 0 5px var(--secondary);
}

.announcement-content span {
  color: var(--secondary);
  font-weight: bold;
}

@keyframes scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

/* Message Box */
.message-box {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: var(--dark);
  color: var(--secondary);
  padding: 15px 25ÊûÅÈÄüÈ£ûËâá
  border-radius: 8px;
  border: 2pxÊûÅÈÄüÈ£ûËâá
  box-shadow: 0 0 15px rgba(37, 99, 235, 0.5);
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s;
}

.message-box.show {
  opacity: 1;
}

/* Admin Panel Styles */
#adminSection {
  display: none;
}

.admin-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 20px;
  justify-content: center;
}

.admin-controls input {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #444;
  background-color: #222;
  color: var(--light);
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.admin-table th, .admin-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid rgba(37, 99, 235, 0.3);
}

.admin-table th {
  background-color: rgba(37, 99, 235, 0.1);
  color: var(--secondary);
}

.admin-table tr:hover {
  background-color: rgba(37, 99, 235, 0.05);
}

.admin-action {
  background: var(--secondary);
  color: var(--light);
  border: none;
  padding: 8px 12px;
  border-radius: 5px;
  cursor: pointer;
  margin: 0 5px;
  font-weight: bold;
}

.admin-action.reject {
  background: var(--accent);
}

/* Message Icon */
.message-icon {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  background: var(--secondary);
  color: var(--light);
  border-radius: 50%;
  display:ÊûÅÈÄüÈ£ûËâá
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 0 15px rgba(37, 99, 235, 0.5);
  z-index: 1000;
  font-size: 1.5rem;
}

.message-notification {
  position: absolute;
  top: -5px;
  right: -5px;
  background-color: var(--accent);
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  display: none;
}

.message-popup {
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 300px;
  background: var(--dark);
  border: 2px solid var(--secondary);
  border-radius: 10px;
  padding: 15px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  zÊûÅÈÄüÈ£ûËâá
  display: none;
}

.message-popup h3 {
  margin-top: 0;
  color: var(--secondary);
  border-bottom: 1px solid var(--secondary);
  padding-bottom: 10px;
}

.message-list {
  max-height: 200px;
  overflow-y: auto;
  marginÊûÅÈÄüÈ£ûËâá
}

.message-item {
  padding: 8px;
  margin-bottom: 8px;
  background: rgba(37, 99, 235, 0.1);
  border-radius: 5px;
  font-size: 0.9rem;
}

.message-date {
  font-size: 0.7rem;
  color: #888;
  margin-top: 4px;
}

/* Game Popup Styles - FIXED TO 75% */
.game-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.game-popup-content {
  background: var(--dark);
  border: 2px solid var(--secondary);
  padding: 20px;
  border-radius: 15px;
  width: 75%;
  height: 75%;
  overflow: auto;
  color: var(--light);
  text-align: center;
  position: relative;
  box-shadow: 0 0 30px var(--secondary);
}

.game-popup-close {
  position: absolute;
  top: 10px;
  right: 15px;
  cursor: pointer;
  font-weight: bold;
  color: var(--accent);
  font-size: 24px;
  transition: transform 0.3ÊûÅÈÄüÈ£ûËâá
}

.game-popup-close:hover {
  transform: rotate(90deg);
}

/* Responsive adjustments */
@media (max-width: 768px) {
  h1 {
    font-size: 2.2rem;
  }

  .game-options {
    grid-template-columns: 1fr;
  }

  .game-options .gold-box {
    width: 100%;
    height: 140px;
    font-size: ÊûÅÈÄüÈ£ûËâá
  }

  .tic-tac-toe-board {
    width: 280px;
    height: 280px;
  }

  .archery-canÊûÅÈÄüÈ£ûËâá
    width: 100%;
    height: auto;
  }

  .chess-board {
    width: 320px;
    height: 320px;
  }

  .nav a {
    padding: 6px 10px;
    font-size: 0.9rem;
  }

  .section {
    padding: 20px;
  }

  .user-info {
    flex-direction: column;
    gap: 10px;
  }

  #usernameDisplay, #phoneDisplay, .verified-badge {
    font-size: 0.7rem; /* Adjusted for mobile */
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 1.8rem;
  }

  .game-options .gold-box {
    height: 120px;
    font-size: 1rem;
  }

  .game-options .gold-box i {
    font-size: 2rem;
  }

  .tic-tac-toe-board {
    width: 240px;
    height: 240px;
  }

  .chess-board {
    width: 280px;
    height: 280px;
  }

  .card {
    width: 70px;
    height: 90px;
    font-size: 1.8rem;
  }

  #usernameDisplay, #phoneDisplay, .verified-badge {
    font-size: 0.6rem; /* Adjusted for small mobile */
  }
}

/* Game Thumbnails (Blue/Black) */
.games-wrap{--blue:#2563EB;--bg:#0b0b0b;--card:#121212}
.games-wrap{background:transparent;color:var(--blue);font-family:system-ui,Segoe UI,Arial}
.games-title{margin:10px 0 12px;font-size:18px;color:var(--blue);letter-spacing:.4px}
.game-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
@media (min-width:720px){.game-grid{grid-template-columns:repeat(3,minmax(0,1fr));}}
.game-card{position:relative;border-radius:16px;overflow:hidden;background:var(--card);
box-shadow:0 8px 24px rgba(ÊûÅÈÄüÈ£ûËâá
transition:transform .25s ease, box-shadow .25s ease}
.game-card:hover{transform:translateY(-4px);box-shadow:0 14px 36px rgba(0,0,0,.55)}
.thumb{position:relative;aspect-ratio:1/1;display:block;background:
radial-gradient(120% 120% at 0% 0%,rgba(37, 99, 235,.12),transparent 40%),
radial-gradient(120% 120% at 100% 0%,rgba(37, 99, 235,.08),transparent 45%),
linear-gradient(#1a1a1a,#0f0f0f);}
/* subtle noise */
.thumb:after{content:"";position:absolute;inset:0;opacity:.08;pointer-events:none;
background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)' opacity='0.35'/></svg>");background-size:180ÊûÅÈÄüÈ£ûËâá
mix-blend-mode:overlay}
.badge{position:absolute;top:10px;left:10ÊûÅÈÄüÈ£ûËâá
background:rgba(0,0,0,.55);color:var(--blue);
border:1px solid rgba(37, 99, 235,.35);padding:4px 8px;border-radius:999px;font-size:11px}
.label{display:flex;align-items:center;justify-content:space-between;gap:8px;
padding:10px 12px;border-top:1px solid rgba(37, 99, 235,.14);color:#d6e9f6}
.label span{font-size:14px}
.play{font-size:12px;border:1px solid rgba(37, 99, 235,.35);padding:4ÊûÅÈÄüÈ£ûËâá
border-radius:999px}
/* Icon layer (emoji placeholder) */
.icon{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
font-size:56px;filter:drop-shadow(0 6px 14px rgba(0,0,0,.6))}
/* Optional: replace emoji with your own images */
.thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:none}
.game-card a{color:inherit;text-decoration:none;display:block}
</style>
</head>
<body>
<div id="particles-js"></div>

<!-- Game Popup -->
<div id="gamePopup" class="game-popup" style="display: none;">
<div class="game-popup-content" id="gamePopupContent">
<div class="game-popup-close" onclick="closeGamePopup()">√ó</div>
<div id="gamePopupInner"></div>
</div>
</div>

<!-- Message Box -->
<div id="messageBox" class="message-box"></div>

<!-- Message Icon -->
<div class="message-icon" onclick="toggleMessages()">
<i class="fas fa-bell"></i>
<div class="message-notification" id="messageNotification"></ÊûÅÈÄüÈ£ûËâá
</div>

<div class="message-popup" id="messagePopup">
<h3>Announcements</h3>
<div class="message-list" id="messageList">
<!-- Messages will be populated here -->
</div>
<button class="gold-box" onclick="closeMessages()">Close</button>
</div>

<!-- Announcement Bar -->
<div class="announcement-bar">
<div class="announcement-content">
<span>üì¢ Stay connected with us!</span> For deposits, contact VIP users (verified with blue tick) or WhatsApp us at USCash WhatsApp channel
</div>
</div>

<div id="welcomePopup" style="display:none;">
<div classÊûÅÈÄüÈ£ûËâá
<div class="close" onclick="document.getElementById('welcomePopup').style.display='none'">√ó</div>
<h2>Welcome to USCash! üéÆ</h2>
<p>Experience the thrill of gaming with real rewards. We're constantly improving our platform to bring you the best gaming experience.</p>
<p>New games and features are coming soon - stay tuned!</p>
<button class="gold-box" onclick="document.getElementById('welcomePopup').style.display='none'" style="margin-top: 20px;">
Let's Play!
</button>
</div>
</div>

<!-- Auth Modals -->
<div id="authModal" class="auth-modal">
<div class="auth-content">
<div class="auth-tabs">
<div class="auth-tab active" onclick="switchAuthTab('login')">Login</div>
<div class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</div>
</div>

<div id="loginForm" class="auth-form active">
<input type="email" id="loginEmail" placeholder="Email" required />
<input type="password" id="loginPassword" placeholder="Password" required />
<div class="forgot-password" onclick="showForgotPassword()">Forgot Password?</div>
<button onclick="loginUser()">Login</button>
</div>

<div id="signupForm" class="auth-form">
<input type="text" id="signupName" placeholder="Full Name" required />
<input type="tel" id="signupPhone" placeholder="Phone Number" required />
<input type="email"ÊûÅÈÄüÈ£ûËâá
<input type="password" id="signupPassword" placeholder="Password (6+ characters)" required minlength="6" />
<input type="text" id="referralCode" placeholder="Referral Code (Optional)" />
<button onclick="signupUser()">Sign Up</button>
</div>

<div id="forgotPasswordÊûÅÈÄüÈ£ûËâá
<input type="email" id="forgotEmail" placeholder="Enter your email" required />
<button onclick="resetPassword()">Reset Password</button>
<button onclick="backToLogin()" style="margin-top: 10px; background-color: #444;">Back to Login</button>
</div>
</div>
</div>

<h1>USCash üéÆ</h1>

<div class="user-info">
<div id="userDisplay" style="display:none;">
<img src="https://flagcdn.com/w20/pk.png" class="country-flag" alt="Country Flag" id="countryFlag">
<span id="usernameDisplay"></span>
<span id="phoneDisplay"></span>
<i class="fas fa-check-circle verified-badge" id="verifiedBadge" style="display:none;"></i>
</div>
<div class="balance-container">
<span>Balance: Rs. <span id="balanceAmount">0</span></span>
<i class="fas fa-sync-alt refresh-balance" onclick="refreshBalance()"></i>
</div>
<div id="authButtons">
<button class="gold-box" onclick="showAuthModal('login')">Login</button>
<button class="gold-box" onclickÊûÅÈÄüÈ£ûËâá
</div>
<div id="logoutButton" style="display:none;">
<button class="gold-box" onclick="logoutUser()">Logout</button>
</div>
</div>

<div class="nav">
<a href="#" onclick="showSection('home')"><i class="fas fa-home"></i> Home</a>
<a href="#" onclick="showSection('deposit')"><i class="fas fa-money-bill-wave"></i> Deposit</a>
<a href="#" onclick="showSection('withdraw')"><i class="fas fa-wallet"></i> Withdraw</a>
<a href="#" onclick="showSection('vip')"><i class="fas fa-crown"></i> VIP</a>
<a href="#" onclick="showSection('status')" id="statusLink" style="display:none;"><i class="fas fa-info-circle"></ÊûÅÈÄüÈ£ûËâá
<a href="#" onclick="showSection('admin')" id="adminLink" styleÊûÅÈÄüÈ£ûËâá
</div>

<!-- Home Section -->
<div class="section" id="homeSection">
<h2>Select Game</h2>

<!-- Game Thumbnails -->
<section class="games-wrap">
<div class="games-title">Select Game</div>
<div class="game-grid">

<!-- Scratch Match -->
<article class="game-card">
<a href="#/scratch-match" onclick="startCardGame(); return false;">
<div class="thumb" aria-label="Scratch Match">
<div class="badge">Hot</div>
<div class="icon">üé´</div>
</div>
<div class="label"><span>Scratch Match</span><span class="play">Play</span></div>
</a>
</article>

<!-- Fruit Shooting -->
<article class="game-card">
<a href="#/fruit-shooting" onclick="startFruitGame(); return false;">
<div class="thumb" aria-label="Fruit Shooting">
<div class="badge">Arcade</div>
<div class="icon">üçâ</div>
</ÊûÅÈÄüÈ£ûËâá
<div class="label"><span>Fruit Shooting</span><span class="play">Play</span></div>
</a>
</article>

<!-- Tic Tac Toe -->
<article class="game-card">
<a href="#/tic-tac-toe" onclick="startTicTacToeGame(); return false;">
<div class="thumb" aria-label="Tic Tac Toe">
<div class="badge">Classic</div>
<div class="icon">#Ô∏è‚É£</div>
</div>
<div class="label"><span>Tic Tac Toe</span><span class="play">Play</span></div>
</a>
</article>

<!-- Find Ace -->
<article class="game-card">
<a href="#/find-ace" onclick="startFindAceGame(); return false;">
<div class="thumbÊûÅÈÄüÈ£ûËâá
<div class="badge">Cards</ÊûÅÈÄüÈ£ûËâá
<div class="icon">A‚ô†Ô∏è</div>
</div>
<div class="label"><span>Find Ace</span><span class="play">Play</span></div>
</a>
</article>

<!-- Archery Challenge -->
<article class="game-card">
<a href="#/archery-challenge" onclick="startArcheryGame(); return false;">
<div class="thumb" aria-label="Archery Challenge">
<div class="badge">Skill</div>
<div class="icon">üéØ</div>
</div>
<div class="label"><span>Archery Challenge</span><span class="play">Play</span></div>
</a>
</article>

<!-- Chess Challenge -->
<article class="game-card">
<a href="#/chess-challenge" onclick="startChessGame(); return false;">
<div class="thumb" aria-label="Chess Challenge">
<div class="badge">Strategy</div>
<div class="icon">‚ôî</div>
</div>
<div class="label"><span>Chess Challenge</span><span class="play">Play</span></div>
</a>
</article>

</div>
</section>
</div>

<!-- Scratch Game -->
<div class="section" id="scratchGame" style="display:none;">
<h2><i class="fas fa-scroll"></i> Scratch & Match</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="selectBet(20)">20</div>
<div class="gold-box" onclick="selectBet(50ÊûÅÈÄüÈ£ûËâá
<div class="gold-box" onclick="selectBet(100)">100</div>
<div class="gold-box" onclick="selectBet(150)">150</div>
<div class="gold-box" onclick="selectBet(200)">200</div>
<div class="gold-box" onclick="selectBet(300)">300</div>
</div>
<div class="card-grid" id="cardGrid"></div>
<div id="result"></div>
</div>

<!-- Fruit Game -->
<div class="section" id="fruitGame" style="display:none;">
<h2><i class="fas fa-apple-alt"></i> Fruit Shooting</h2>
<div id="fruitTargetDisplay">Target: Shoot the <b style="color:red;">RED</b> Apple üçé!</div>
<div class="bet-amounts">
<div class="gold-box" onclick="startFruitRound(20)">Rs. 20</div>
<div class="gold-box" onclick="startFruitRound(50)">Rs. 50</div>
<div class="gold-box" onclick="startÊûÅÈÄüÈ£ûËâá
<div class="gold-box" onclick="startFruitRound(150)">Rs. 150</div>
<div class="gold-box" onclick="startFruitRound(200)">Rs. 200</ÊûÅÈÄüÈ£ûËâá
</div>
<div id="fruitCountdown">Time: 0s</div>
<div classÊûÅÈÄüÈ£ûËâá
<div id="fruitScoreDisplay"></div>
</div>

<!-- Tic Tac Toe Game -->
<div class="section" id="tictactoeGame" style="display:none;">
<h2><i class="fas fa-times"></i> Tic Tac Toe</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="selectTicTacToeBet(50)">Rs. 50</div>
<div class="gold-box" onclick="selectTicTacToeBet(100)">Rs. 100</div>
<div class="gold-box" onclick="selectTicTacToeBet(200)">Rs. 200</div>
<div class="gold-box" onclick="selectTicTacToeBet(300)">Rs. 300</div>
</div>
<div id="tictactoeCountdown">Time: 30s</div>
<div class="tic-tac-toe-board" id="ticTacToeBoard"></div>
<div id="tictactoeResult"></div>
</div>

<!-- Find Ace Game -->
<div class="section" id="findAceGame" style="display:none;">
<h2><i classÊûÅÈÄüÈ£ûËâá
<div class="bet-amounts">
<div class="gold-box" onclick="startFindAceRound(50)">Rs. 50</div>
<div class="gold-box" onclick="startFindAceRound(100)">Rs. 100</div>
<div class="gold-box" onclick="startFindAceRound(200)">Rs. 200</div>
<div class="gold-box" onclick="startFindAceRound(300)">Rs. 300</div>
</div>
<div id="findAceCountdown">Time: 15s</div>
<div class="card-grid" id="findAceGrid"></div>
<div id="findAceResult"></div>
</div>

<!-- Archery Game -->
<div class="section" id="archeryGame" style="ÊûÅÈÄüÈ£ûËâá
<h2><i class="fas fa-bullseye"></i> Archery Challenge</h2>
<div class="archery-container">
<div class="archery-canvas-container">
<canvas id="archeryCanvas" width="520" height="520"></canvas>
</div>

<div class="archery-controls">
<div class="bet-amounts">
<div class="gold-box" onclick="selectArcheryBet(20)">Rs. 20</div>
<div class="gold-box" onclick="selectArcheryBet(50)">Rs. 50</div>
<div class="gold-box" onclick="selectArcheryBet(100)">Rs. 100</div>
<div class="gold-box" onclick="selectArcheryBet(150)">Rs. 150</div>
<div class="gold-box" onclick="selectArcheryBet(200)">Rs. 200</div>
</div>

<div class="archery-score-row" id="archeryScoreRow">
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
</div>

<div id="archeryStatus">Pick a bet to start</div>

<div style="display: flex; justify-content: center; gap: 10px;">
<button class="gold-boxÊûÅÈÄüÈ£ûËâá
<button class="gold-box" onclick="toggleArcheryAuto()" id="archeryAutoBtn">Auto: OFF</button>
</div>
</div>
</div>
</div>

<!-- Chess Game -->
<div class="section" id="chessGame" style="display:none;">
<h2><i class="fas fa-chess"></i> Chess Challenge</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="selectChessBet(100)">Rs. 100</div>
<div class="gold-box" onclick="selectChessBet(200)">Rs. 200</div>
<div class="gold-box" onclick="selectChessBet(300)">Rs. ÊûÅÈÄüÈ£ûËâá
<div class="gold-box" onclick="selectChessBet(500)">Rs. 500</div>
<div class="gold-box" onclick="selectChessBet(1000)">Rs. 1000</div>
</div>
<div id="chessCountdown">Time: 15:00</div>
<div class="chess-container">
<div class="chess-board" id="chessBoard"></div>
<div class="chess-controls">
<div id="chessStatus">Select a bet to start the game</div>
<button class="gold-box" onclick="resignÊûÅÈÄüÈ£ûËâá
</div>
</div>
</div>

<!-- Deposit Section -->
<div class="section" id="depositSection" style="display:none;">
<h2><i class="fas fa-money-bill-wave"></i> Deposit</h2>
<p style="color: var(--secondary);">Minimum deposit amount is Rs. 150. To deposit, please contact VIP users (verified with blue tick) or WhatsApp us at USCash WhatsApp channel</p>
<div class="form-group">
<label for="depositAmount">Amount (Rs.)</label>
<input type="number" id="depositAmount" min="150" placeholder="Minimum 150" />
</div>
<div class="form-group">
<label for="depositMethod">Payment Method</label>
<select id="depositMethod">
<option value="easypaisa">EasyPaisa</option>
<option value="jazzcash">JazzCash</option>
<option value="bank">Bank Transfer</option>
</select>
</div>
<div class="form-group">
<label for="transactionId">Transaction ID</label>
<input type="text" id="transactionId" placeholder="Enter transaction reference" />
</div>
<button class="submit-btn" onclick="submitDeposit()">Submit Deposit Request</button>

<div class="transaction-history" id="depositHistory">
<h3><i class="fas fa-history"></i> Deposit History</h3>
<!-- Will be populated by JavaScript -->
</div>
</div>

<!-- Withdraw Section -->
<div class="section" id="withdrawSection" style="display:none;">
<h2><i class="fas fa-wallet"></i> Withdraw</h2>
<p style="color: var(--secondary);">Minimum withdrawal amount is Rs. 300. You can submit requests anytime.</p>
<div class="form-group">
<ÊûÅÈÄüÈ£ûËâá
<input type="number" id="withdrawAmount" min="300" placeholder="Minimum 300" />
</div>
<div class="form-group">
<label for="withdrawMethod">Payment Method</label>
<select id="withdrawMethod">
<option value="easypaisa">EasyPaisa</option>
<option value="jazzcash">JazzCash</option>
<option value="bank">Bank Transfer</option>
</select>
</ÊûÅÈÄüÈ£ûËâá
<div class="form-group">
<label for="accountNumber">Account Number</label>
<input type="text" id="accountNumber" placeholder="Enter your account number" />
</div>
<div class="form-group">
<label for="accountName">Account Name</label>
<input type="text" id="accountName" placeholder="Enter account holder name" />
</div>
<button class="submit-btn" onclick="submitWithdraw()">Submit Withdrawal Request</button>

<div class="transaction-history" id="withdrawHistory">
<h3><i class="fas fa-history"></i> Withdrawal History</h3>
<!-- Will be populated by JavaScript -->
</div>
</div>

<!-- VIP Section -->
<div class="section" id="vipSection" style="display:none;">
<h2><i class="fas fa-crown"></i> VIP Program</h2>
<p style="color: var(--secondary);">Earn money by referring friends! When a user refers someone, the referral must make their first deposit. Only then will the referring user receive 5% of the referral's next withdrawal amount.</p>

<div class="referral-stats">
<div class="stat-box">
<div class="stat-label">Total Referrals</div>
<div class="stat-value" id="referralCount">0</div>
</div>
<div class="stat-box">
<div class="stat-label">Your Earnings</div>
<div classÊûÅÈÄüÈ£ûËâá
</div>
<div class="stat-box">
<div class="stat-label">VIP Status</div>
<div class="stat-value" id="vipStatus">Basic</div>
</div>
</div>

<h3><i class="fas fa-user-plus"></i> Your Referral Code</ÊûÅÈÄüÈ£ûËâá
<div class="referral-code" id="userReferralCode">
Login to see your code
<i class="far fa-copy referral-codeÊûÅÈÄüÈ£ûËâá
</div>

<h3><i class="fas fa-info-circle"></i> How It Works</h3>
<ol style="text-align: left; padding-left: 20px;">
<li>Share your unique referral code with friends</li>
<li>They sign up using your code and make their first deposit</li>
<li>You earn <b>5% of their next withdrawal amount</b></li>
<li>Withdraw your earnings anytime</ÊûÅÈÄüÈ£ûËâá
<li>Reach higher VIP levels for more benefits</li>
</ol>

<button class="submit-btn" onclick="shareReferralCode()" style="margin-top: 20px;">
<i class="fas fa-share-alt"></i> Share Your Referral Code
</button>
</div>

<!-- Status Section (replaces More Section) -->
<div class="section" id="statusSection" style="display:none;">
<hÊûÅÈÄüÈ£ûËâá
<h3><i class="fas fa-clock"></i> Deposit Request Status</h3>
<div class="transaction-history" id="depositStatus">
<!-- Will be populated by JavaScript -->
</div>

<h3><i class="fas fa-clock"></i> Withdrawal Request Status</h3>
<div class="transaction-history" id="withdrawStatus">
<!-- Will be populated by JavaScript -->
</div>

<h3><i class="fas fa-exchange-alt"></ÊûÅÈÄüÈ£ûËâá
<div class="transaction-history" id="fullTransactionHistory">
<!-- Will be populated by JavaScript -->
</div>

<button class="submit-btn" onclick="refreshAllData()ÊûÅÈÄüÈ£ûËâá
<i class="fas fa-sync-alt"></i> Refresh All Data
</button>
</div>

<!-- Admin Section -->
<div class="section" id="adminSection" style="display:none;">
<h2><i class="fas fa-user-shield"></i> Admin Panel</h2>

<div class="admin-controls">
<input type="text" id="searchUser" placeholder="Search by name..." oninput="searchUsers()">
</div>

<h3>Users</h3>
<div class="transaction-history">
<table class="admin-table">
<thead>
<tr>
<th>Name</th>
<th>Email</th>
<th>Starting Balance</th>
<th>Current Balance</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="usersTable">
<!-- Users will be populated here -->
</tbody>
</table>
</div>

<h3>Deposit Requests</h3>
<div class="transaction-history">
<table class="admin-table">
<thead>
<tr>
<th>User</th>
<th>Amount</th>
<th>Method</th>
<th>Transaction ID</th>
<th>Status</th>
<th>Date</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="depositRequestsTable">
<!-- Deposit requests will be populated here -->
</tbody>
</table>
</div>

<h3>Withdrawal Requests</h3>
<div class="transaction-history">
<table class="admin-table">
<thead>
<tr>
<th>User</th>
<th>Amount</th>
<th>Method</th>
<th>Account Details</th>
<th>Status</th>
<th>Date</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="withdrawRequestsTable">
<!-- Withdrawal requests will be populated here -->
</tbody>
</table>
</div>

<h3>Send Announcement</h3>
<div class="form-group">
<textarea id="announcementText" placeholder="Enter announcement message..." rows="3" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background-color: #222; color: var(--light);"></textarea>
</div>
<button class="submit-btn" onclick="sendAnnouncement()">Send Announcement</button>
</div>

<audio id="bgMusic" loop>
<source src="https://cdn.pixabay.com/audio/2023/03ÊûÅÈÄüÈ£ûËâá
</audio>
<audio id="flipSound">
<source src="https://cdn.pixabay.com/download/audio/2022/10/03/audio_07d4930c1c.mp3" type="audio/mp3">
</audio>
<audio id="winSound">
<source src="https://cdn.pixabay.com/download/audio/2022/03/21/audio_5a9f1d8e6b.mpÊûÅÈÄüÈ£ûËâá
</audio>
<audio id="loseSound">
<source src="https://cdnÊûÅÈÄüÈ£ûËâá
</audio>
<audio id="shotSound">
<source src="https://cdn.pixabay.com/download/audio/2023/08/19/audio_5a9f1d8e6b.mp3" type="audio/mp3">
</audio>
<audio id="shuffleSound">
<source src="https://cdn.pixabay.com/download/audio/2022/03/04/audio_6b08f2e9f8.mp3" type="audio/mp3">
</audio>
<audio id="moveSound">
<source src="https://cdn.pixabay.com/download/audio/2022/10/25/audio_6f8c1c9c0c.mp3" type="audio/mp3">
</audio>
<audio id="checkSound">
<source src="https://cdn.pixabay.com/download/audio/2022/03/15ÊûÅÈÄüÈ£ûËâá
</audio>

<!-- Firebase SDK -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/fÊûÅÈÄüÈ£ûËâá
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<!-- Chess Engine -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

<script>
// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBM7DY6i11IPk8DAvVA6tsgmz7Epi5bJh0",
  authDomain: "pakcashplay.firebaseapp.com",
  projectId: "pakcashplay",
  storageBucket: "pakcashplay.appspot.com",
  messagingSenderId: "551195851632",
  appId: "1:551195851632:web:4dcf6a8fb36d82e6a6adb5"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Game variables
let balance = 0;
let selectedBet = null;
let gameStarted = false;
let currentUser = null;
let lastWithdrawRequestTime = 0;
let activeGameType = null;
let activeGameBet = 0;

// Initialize games when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  checkAuthState();
  setupGames();

  // Remove welcome popup
  document.getElementById('welcomePopup').style.display = 'none';
  localStorage.setItem('welcomeShown', 'true');

  // Start background music
  try {
    document.getElementById('bgMusic').volume = 0.3;
    document.getElementById('bgMusic').play();
  } catch (e) {
    console.log("Audio autoplay blocked:", e);
  }

  // Add beforeunload event to handle game closure
  window.addEventListener('beforeunload', function(e) {
    if (activeGameType && activeGameBet > 0) {
      // User is leaving during an active game, deduct bet
      db.collection('users').doc(currentUser.uid).update({
        balance: firebase.firestore.FieldValue.increment(-activeGameBet)
      }).then(() => {
        // Log the forced game end
        db.collection('game_logs').add({
          userId: currentUser.uid,
          gameType: activeGameType,
          betAmount: activeGameBet,
          result: 'lost',
          reason: 'user_left',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      });
    }
  });
});

// Authentication functions
function checkAuthState() {
  auth.onAuthÊûÅÈÄüÈ£ûËâá
    if (user) {
      currentUser = user;
      document.getElementById('authButtons').style.display = 'none';
      document.getElementById('logoutButton').style.display = 'block';
      document.getElementById('userDisplay').style.display = 'flex';
      document.getElementById('statusLink').style.display = 'block';
      loadUserData();

      // Check if user is admin
      db.collection('users').doc(user.uid).get()
      .then(doc => {
        if (doc.exists) {
          const userData = doc.data();
          if (userData.email === 'cptanil1995@gmail.com' || userData.email === 'auk5562@gmail.com' || userData.email === 'kafe2999@gmail.com') {
            document.getElementById('adminLink').style.display = 'block';

            // Add star icon for admin users
            if (userData.email === 'cptÊûÅÈÄüÈ£ûËâá
              document.getElementById('verifiedBadge').style.display = 'inline-block';
              document.getElementById('verifiedBadge').className = 'fas fa-star verified-badge';
            }
          }
        }
      });
    } else {
      currentUser = null;
      document.getElementById('authButtons').style.display = 'flex';
      document.getElementById('logoutButton').style.display = 'none';
      document.getElementById('userDisplay').style.display = 'none';
      document.getElementById('statusLinkÊûÅÈÄüÈ£ûËâá
      document.getElementById('adminLink').style.display = 'none';
      showSection('home');
      // Reset balance display when logged out
      document.getElementById('balanceAmount').textContent = '0';
    }
  });
}

function showAuthModal(tab) {
  document.getElementById('authModal').style.display = 'flex';
  switchAuthTab(tab);
}

function hideAuthModal() {
  document.getElementById('authModal').style.display = 'none';
}

function switchAuthTab(tab) {
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));

  if (tab === 'login') {
    document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
    document.getElementById('loginForm').classList.add('active');
  } else if (tab === 'signup') {
    document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
    document.getElementById('signupForm').classList.add('active');
  }
}

function showForgotPassword() {
  document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
  document.getElementById('forgotPasswordForm').classList.add('active');
}

function backToLogin() {
  switchAuthTab('login');
}

function loginUser() {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;

  if (!email || !password) {
    showMessage('Please enter both email and password', 'error');
    return;
  }

  // Show loading state
  const loginBtn = document.querySelector('#loginForm button');
  loginBtn.disabled = true;
  loginBtn.textContent = 'Logging in...';

  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      hideAuthModal();
      showMessage('Login successful! Welcome back.', 'success');

      // Update last login time
      if (currentUser) {
        db.collection('users').doc(currentUser.uid).update({
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
    })
    .catch(error => {
      let errorMessage = 'Login failed. ';
      switch(error.code) {
        case 'auth/user-not-found':
          errorMessage += 'No account found with this email.';
          break;
        case 'auth/wrong-password':
          errorMessage += 'Incorrect password.';
          break;
        case 'auth/invalid-email':
          errorMessage += 'The email address is invalid.';
          break;
        default:
          errorMessage += error.message;
      }
      showMessage(errorMessage, 'error');
    })
    .finally(() => {
      // Reset button state
      loginBtn.disabled = false;
      loginBtn.textContent = 'Login';
    });
}

function signupUser() {
  const email = document.getElementById('signupEmail').value;
  const password = document.getElementById('signupPassword').value;
  const name = document.getElementById('ÊûÅÈÄüÈ£ûËâá
  const phone = document.getElementById('signupPhone').value;
  const referralCode = document.getElementById('referralCode').value;

  // Validate all required fields
  if (!email || !password || !name || !phone) {
    showMessage('Please fill in all required fields', 'error');
    return;
  }

  // Validate email format
  if (!validateEmail(email)) {
    showMessage('Please enter a valid email address', 'error');
    return;
  }

  // Validate password length
  if (password.length < 6) {
    showMessage('Password should be at least 6 characters', 'error');
    return;
  }

  // Show loading state
  const signupBtn = document.querySelector('#signupForm button');
  signupBtn.disabled = true;
  signupBtn.textContent = 'Creating account...';

  // Create user with Firebase Auth
  auth.createUserWithEmailAndPassword(email, password)
    .then((userCredential) => {
      // Create user document in Firestore
      return db.collection('users').doc(userCredential.user.uid).set({
        name: name,
        phone: phone,
        email: email,
        balance: 0, // No welcome bonus
        startingBalance: 0, // Track starting balance
        referralCode: generateReferralCode(),
        referredBy: referralCode || null,
        referralCount: 0,
        referralEarnings: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
        depositCount: 0
      });
    })
    .then(() => {
      // If referral code was provided, update the referrer's stats
      if (referralCode) {
        return db.collection('users').where('referralCode', '==', referralCode).get()
          .then(querySnapshot => {
            if (!querySnapshot.empty) {
              const referrerId = querySnapshot.docs[0].id;
              return db.collection('users').doc(referrerId).update({
                referralCount: firebase.firestore.FieldValue.increment(1)
              });
            }
          });
      }
    })
    .then(() => {
      // Success - hide modal and show welcome message
      hideAuthModal();
      showMessage('Signup successful! Welcome to USCash.', 'success');

      // Reset form
      document.getElementById('signupForm').reset();
    })
    .catch(error => {
      // Handle specific errors
      let errorMessage = 'Signup failed. ';
      switch(error.code) {
        case 'auth/email-already-in-use':
          errorMessage += 'This email is already registered.';
          break;
        case 'auth/invalid-email':
          errorMessage += 'The email address is invalid.';
          break;
        case 'auth/weak-password':
          errorMessage += 'The password is too weak.';
          break;
        default:
          errorMessage += error.message;
      }
      showMessage(errorMessage, 'error');
    })
    .finally(() => {
      // Reset button state
      signupBtn.disabled = false;
      signupBtn.textContent = 'Sign Up';
    });
}

// Helper function to validate email
function validateEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

function resetPassword() {
  const email = document.getElementById('forgotEmail').value;

  if (!emailÊûÅÈÄüÈ£ûËâá
    showMessage('Please enter your email', 'error');
    return;
  }

  auth.sendPasswordResetEmail(email)
    .then(() => {
      showMessage('Password reset email sent! Please check your inbox.', 'success');
      backToLogin();
    })
    .catch(error => {
      showMessage('Error sending reset email: ' + error.message, 'error');
    });
}

function logoutUser() {
  auth.signOut().then(() => {
    showSection('home');
    showMessage('Logged out successfully', 'success');
    // Reset balance to zero when logging out
    balance = 0;
    document.getElementById('balanceAmount').textContent = '0';
  });
}

function generateReferralCode() {
  return Math.random().toString(36).substring(2, 8).toUpperCase();
}

function copyReferralCode() {
  const referralCode = document.getElementById('userReferralCode').textContent;
  navigator.clipboard.writeText(referralCode)
    .then(() => {
      showMessage('Referral code copied to clipboard!', 'success');
    })
    .catch(err => {
      console.error('Failed to copy: ', err);
    });
}

function shareReferralCode() {
  const referralCode = document.getElementById('userReferralCode').textContent;
  const shareText = `Join USCash and use my referral code: ${referralCode} to get bonus rewards!`;

  if (navigator.share) {
    navigator.share({
      title: 'USCash Referral',
      text: shareText,
      url: window.location.href
    })
    .catch(err => {
      console.error('Error sharing:', err);
      fallbackShare(referralCode, shareText);
    });
  } else {
    fallbackShare(referralCode, shareText);
  }
}

function fallbackShare(referralCode, shareText) {
  prompt('Copy your referral code to share:', shareText);
}

// User data functions
function loadUserData() {
  if (!currentUser) return;

  db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
    if (doc.exists) {
      const userData = doc.data();
      balance = userData.balance || 0;
      updateBalanceDisplay();

      // Update user display
      document.getElementById('usernameDisplay').textContent = userData.name || userData.email || 'User';
      document.getElementById('phoneDisplay').textContent = userData.phone || '';

      // Check if user is verified (cptanil1995@gmail.com, auk5562@gmail.com, or kafe2999@gmail.com)
      if (userData.email === 'cptanil1995@gmail.com' || userData.email === 'auk5562@gmail.com' || userData.email === 'kafe2999@gmail.com') {
        document.getElementById('verifiedBadge').style.display = 'inline-block';
        document.getElementById('verifiedÊûÅÈÄüÈ£ûËâá
      }

      // Update VIP section if visible
      if (document.getElementById('vipSection').style.display === 'block') {
        document.getElementById('userReferralCode').textContent = userData.referralCode || 'N/A';
        document.getElementById('referralCount').textContent = userData.referralCount || 0;
        document.getElementById('referralEarnings').textContent = 'Rs. ' + (userData.referralEarnings || 0);

        // Show copy button if referral code exists
        if (userData.referralCode) {
          document.querySelector('.referral-code-copy').style.display = 'block';
        }

        // Set VIP status
        const earnings = userData.referralEarnings || 0;
        let vipStatus = 'Basic';
        if (earnings >= 5000) vipStatus = 'Gold';
        else if (earnings >= 1000) vipStatus = 'Silver';
        document.getElementById('vipStatus').textContent = vipStatus;
      }
    }
  });

  // Load transaction history
  loadTransactionHistory();

  // Load announcements
  loadAnnouncements();
}

function refreshBalance() {
  if (currentUser) {
    db.collection('users').doc(currentUserÊûÅÈÄüÈ£ûËâá
      .then(doc => {
        if (doc.exists) {
          balance = doc.data().balance || 0;
          updateBalanceDisplay();
          showMessage('Balance refreshed!', 'success');
        }
      });
  }
}

function refreshAllData() {
  refreshBalance();
  loadTransactionHistory();
  showMessage('All data refreshed!', 'success');
}

function updateBalanceDisplay() {
  document.getElementById('balanceAmount').textContent = Math.floor(balance);
}

// Message display function
function showMessage(message, type = 'info') {
  const messageBox = document.getElementById('messageBox');
  messageBox.textContent = message;
  messageBox.className = 'message-box';

  if (type === 'error') {
    messageÊûÅÈÄüÈ£ûËâá
    messageBox.style.color = 'var(--accent)';
  } else if (type === 'success') {
    messageBox.style.borderColor = 'lime';
    messageBox.style.color = 'lime';
  } else {
    messageBox.style.borderColor = 'var(--secondary)';
    messageBox.style.color = 'var(--secondary)';
  }

  messageBox.classList.add('show');

  setTimeout(() => {
    messageBox.classList.remove('show');
  }, 3000);
}

// Transaction functions
function submitDeposit() {
  if (!currentUser) {
    showMessage('Please login to deposit', 'error');
    return;
  }

  const amount = parseFloat(document.getElementById('depositAmount').value);
  const method = document.getElementById('depositMethod').value;
  const transactionId = document.getElementById('transactionId').value;

  if (isNaN(amount) || amount < 150) {
    showMessage('Minimum deposit amount is Rs. 150', 'error');
    return;
  }

  if (!transactionId) {
    showMessage('Please enter transaction ID', 'error');
    return;
  }

  // Add deposit request
  db.collection('deposit_requests').add({
    userId: currentUser.uid,
    userName: currentUser.displayName || currentUser.email,
    amount: amount,
    method: method,
    transactionId: transactionId,
    status: 'pending',
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    showMessage('Deposit request submitted successfully!', 'success');
    document.getElementById('depositAmount').value = '';
    document.getElementById('transactionId').value = '';
    loadTransactionHistory();
  })
  .catch(error => {
    showMessage('Error submitting deposit: ' + error.message, 'error');
  });
}

function submitWithdraw() {
  if (!currentUser) {
    showMessage('Please login to withdraw', 'error');
    return;
  }

  const amount = parseFloat(document.getElementById('withdrawAmount').value);
  const method = document.getElementById('withdrawMethod').value;
  const accountNumber = document.getElementById('accountNumber').value;
  const accountName = document.getElementById('accountName').value;

  if (isNaN(amount) || amount < 300) {
    showMessage('Minimum withdrawal amount is Rs. 300', 'error');
    return;
  }

  if (amount > balance) {
    showMessage('Insufficient balance', 'error');
    return;
  }

  if (!accountNumber || !accountName) {
    showMessage('Please enter account details', 'error');
    return;
  }

  // Deduct amount immediately
  balance -= amount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  // Add withdrawal request
  db.collection('withdraw_requests').add({
    userId: currentUser.uid,
    userName: currentUser.displayName || currentUser.email,
    amount: amount,
    method: method,
    accountNumber: accountNumber,
    accountName: accountName,
    status: 'pending',
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    lastWithdrawRequestTime = Date.now();
    showMessage('Withdrawal request submitted successfully! It will be processed within 24 hours.', 'success');
    document.getElementById('withdrawAmount').value = '';
    document.getElementById('accountNumber').value = '';
    document.getElementById('accountName').value = '';
    loadTransactionHistory();
  })
  .catch(error => {
    // If there was an error, add the amount back
    balance += amount;
    updateUserBalance(balance);
    updateBalanceDisplay();
    showMessage('Error submitting withdrawal: ' + error.message, 'error');
  });
}

function loadTransactionHistory() {
  if (!currentUser) return;

  // Load deposit history
  db.collection('deposit_requests')
    .where('userId', '==', currentUser.uid)
    .orderBy('createdAt', 'desc')
    .limit(10)
    .get()
    .then(querySnapshot => {
      const depositHistory = document.getElementById('depositHistory');
      if (depositHistory) {
        depositHistory.innerHTML = '<h3><i class="fas fa-history"></i> Deposit History</h3>';

        if (querySnapshot.empty) {
          depositHistory.innerHTML += '<p>No deposit history found</p>';
          return;
        }

        querySnapshot.forEach(doc => {
          const data = doc.data();
          const item = document.createElement('div');
          item.className = 'transaction-item';

          let statusClass = 'transaction-pending';
          if (data.status === 'approved') statusClass = 'transaction-approved';
          if (data.status === 'rejected') statusClass = 'transaction-rejected';

          item.innerHTML = `
            <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
            <div>Method: ${data.method}</div>
            <div>Status: <span class="${statusClass}">${data.status}</ÊûÅÈÄüÈ£ûËâá
            <div>Date: ${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
          `;

          depositHistory.appendChild(item);
        });
      }

      // Also update deposit status in status section
      const depositStatus = document.getElementById('depositStatus');
      if (depositStatus) {
        depositStatus.innerHTML = '';

        if (querySnapshot.empty) {
          depositStatus.innerHTML = '<p>No deposit requests found</p>';
          return;
        }

        querySnapshot.forEach(docÊûÅÈÄüÈ£ûËâá
          const data = doc.data();
          const item = document.createElement('div');
          item.className = 'transaction-item';

          let statusClass = 'transaction-pending';
          if (data.status === 'approved') statusClass = 'transaction-approved';
          if (data.status === 'rejected') statusClass = 'transaction-rejected';

          item.innerHTML = `
            <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
            <div>Status: <span class="${statusClass}">${data.status}</span></div>
            <div>Date: ${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
          `;

          depositStatus.appendChild(item);
        });
      }
    });

  // Load withdrawal history
  db.collection('withdraw_requests')
    .where('userId', '==', currentUser.uid)
    .orderBy('createdAt', 'desc')
    .limit(10)
    .get()
    .then(querySnapshot => {
      const withdrawHistory = document.getElementById('withdrawHistory');
      if (withdrawHistory) {
        withdrawHistory.innerHTML = '<hÊûÅÈÄüÈ£ûËâá

        if (querySnapshot.empty) {
          withdrawHistory.innerHTML += '<p>No withdrawal history found</p>';
          return;
        }

        querySnapshot.forEach(doc => {
          const data = doc.data();
          const item = document.createElement('div');
          item.className = 'transaction-item';

          let statusClass = 'transaction-pending';
          if (data.status === 'approved') statusClass = 'transaction-approved';
          if (data.status === 'rejected') statusClass = 'transaction-rejected';

          item.innerHTML = `
            <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
            <div>Method: ${data.method}</div>
            <div>Status: <span class="${statusClass}">${data.status}</span></div>
            <div>Date: ${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
          `;

          withdrawHistory.appendChild(item);
        });
      }

      // Also update withdrawal status in status section
      const withdrawStatus = document.getElementById('withdrawStatus');
      if (withdrawStatus) {
        withdrawStatus.innerHTML = '';

        if (querySnapshot.empty) {
          withdrawStatus.innerHTML = '<ÊûÅÈÄüÈ£ûËâá
          return;
        }

        querySnapshot.forEach(doc => {
          const data = doc.data();
          const item = document.createElement('div');
          item.className = 'transaction-item';

          let statusClass = 'ÊûÅÈÄüÈ£ûËâá
          if (data.status === 'approved') statusClass = 'transaction-approved';
          if (data.status === 'rejected') statusClass = 'transaction-rejected';

          item.innerHTML = `
            <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
            <div>Status: <span class="${statusClass}">${data.status}</span></div>
            <ÊûÅÈÄüÈ£ûËâá
          `;

          withdrawStatus.appendChild(item);
        });
      }
    });

  // Load full transaction history
  const fullHistory = document.getElementById('fullTransactionHistory');
  if (fullHistory) {
    fullHistory.innerHTML = '';

    // Combine deposits and withdrawals for full history
    Promise.all([
      db.collection('deposit_requests')
        .where('userId', '==', currentUser.uid)
        .orderBy('createdAt', 'desc')
        .limit(10)
        .get(),
      db.collection('withdraw_requests')
        .where('userId', '==', currentUser.uid)
        .orderBy('createdAt', 'desc')
        .limit(10)
        .get()
    ])
    .then(([deposits, withdrawals]) => {
      const allTransactions = [];

      deposits.forEach(doc => {
        const data = doc.data();
        allTransactions.push({
          type: 'deposit',
          amount: data.amount,
          status: data.status,
          date: data.createdAt,
          method: data.method
        });
      });

      withdrawals.forEach(doc => {
        const data = doc.data();
        allTransactions.push({
          type: 'withdrawal',
          amount: data.amount,
          status: data.status,
          date: data.createdAt,
          method: data.method
        });
      });

      // Sort by date
      allTransactions.sort((a, b) => (b.date?.seconds || 0) - (a.date?.seconds || 0));

      if (allTransactions.length === 0) {
        fullHistory.innerHTML = '<p>No transaction history found</p>';
        return;
      }

      allTransactions.forEach(trans => {
        const item = document.createElement('div');
        item.className = 'transaction-item';

        let statusClass = 'transaction-pending';
        if (trans.status === 'approved') statusClass = 'transaction-approved';
        if (trans.status === 'rejected') statusClass = 'transaction-rejected';

        item.innerHTML = `
          <div>Type: ${trans.type === 'deposit' ? 'Deposit' : 'Withdrawal'}</div>
          <div>Amount: <span class="transaction-amount">Rs. ${trans.amount}</span></div>
          <div>Method: ${trans.method}</div>
          <div>Status: <span class="${statusClass}">${trans.status}</span></div>
          <div>Date: ${trans.date?.toDate().toLocaleString() || 'N/A'}</div>
        `;

        fullHistory.appendChild(item);
      });
    });
  }
}

// Navigation functions
function showSection(section) {
  document.querySelectorAll('.section').forEach(sec => {
    sec.style.display = 'none';
  });

  switch(section) {
    case 'home':
      document.getElementById('homeSection').style.display = 'block';
      break;
    case 'deposit':
      if (!currentUser) {
        showAuthModal('login');
        return;
      }
      document.getElementById('depositSection').style.display = 'block';
      break;
    case 'withdraw':
      if (!currentUser) {
        showAuthModal('login');
        return;
      }
      document.getElementById('withdrawSection').style.display = 'block';
      break;
    case 'vip':
      if (!currentUser) {
        showAuthModal('login');
        return;
      }
      document.getElementById('vipSection').ÊûÅÈÄüÈ£ûËâá
      // Load VIP data if not already loaded
      if (document.getElementById('userReferralCode').textContent === 'Login to see your code') {
        loadUserData();
      }
      break;
    case 'status':
      if (!currentUser) {
        showAuthModal('login');
        return;
      }
      document.getElementById('statusSection').style.display = 'block';
      loadTransactionHistory();
      break;
    case 'admin':
     ÊûÅÈÄüÈ£ûËâá
        showAuthModal('login');
        return;
      }
      // Check if user is admin
      db.collection('users').doc(currentUser.uid).get()
        .then(doc => {
          if (doc.exists) {
            const userData = doc.data();
            if (userData.email === 'cptanil1995@gmail.com' || userData.email === 'auk5562@gmail.com' || userData.email === 'kafe2999@gmail.com') {
              document.getElementById('adminSection').style.display = 'block';
              loadAdminData();
            } else {
              showMessage('Access denied. Admin only.', 'error');
              showSection('home');
            }
          }
        });
      break;
  }
}

// Game setup
function setupGames() {
  setupScratchGame();
  setupFruitGame();
  setupTicTacToeGame();
  setupFindAceGame();
  setupArcheryGame();
  setupChessGame();
}

// Game popup functions
function openGamePopup(gameType) {
  document.getElementById('gamePopup').style.display = 'flex';
  document.getElementById('gamePopupInner').innerHTML = document.getElementById(gameType + 'Game').innerHTML;
  activeGameType = gameType;
}

function closeGamePopup() {
  document.getElementById('gamePopup').style.display = 'none';
  document.getElementById('gamePopupInner').innerHTML = '';
  activeGameType = null;
  activeGameBet = 0;
}

function endGamePopup() {
  setTimeout(() => {
    closeGamePopup();
  }, 6000);
}

// Scratch Game
let icons = ['üêÑ', 'üêî', 'üê∂']; // Only cow, hen, and dog
let cardData = [];
let flippedCards = [];
let scratchChances = 4;

function setupScratchGame() {
  icons = ['üêÑ', 'üêî', 'üê∂'];
  cardData = [];
  flippedCards = [];
}

function startCardGame() {
  openGamePopup('scratch');
  setupCards();
}

function setupCardsÊûÅÈÄüÈ£ûËâá
  flippedCards = [];
  cardData = [];
  gameStarted = false;
  scratchChances = 4;
  const grid = document.getElementById('cardGrid');
  if (!grid) return;
  grid.classList.remove('shake', 'glow');
  grid.innerHTML = '';
  document.getElementById("particles-js").style.display = "none";
  const resultElement = document.getElementById("result");
  if (resultElement) resultElement.innerText = '';

  // 9 cards with 3 of each icon
  let allIcons = [];
  for (let i = 0; i < 3; i++) {
    for (let j = 0; j < 3; j++) {
      allIcons.push(icons[i]);
    }
  }

  // Shuffle the cards
  allIcons = shuffleArray(allIcons);

  allIcons.forEach((icon) => {
    const card = document.createElement('div');
    card.className = 'card';

    const front = document.createElement('div');
    front.className = 'front';
    front.textContent = icon;

    const back = document.createElement('div');
    back.className = 'back';

    card.appendChild(front);
    card.appendChild(back);
    card.dataset.icon = icon;

    grid.appendChild(card);
    cardData.push({ element: card, icon: icon });
  });
}

function selectBet(amount) {
  if (gameStarted) return;

  if (balance < amount) {
    showMessage('Insufficient balance! Please deposit more to play.', 'error');
    return;
  }

  selectedBet = amount;
  document.querySelectorAll('#scratchGame .bet-amounts .gold-box').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');

  // Deduct bet amount
  balance -= amount;
  activeGameBet = amount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  revealAndShuffleCards();
}

function revealAndShuffleCards() {
  const grid = document.getElementById('cardGrid');
  if (!grid) return;
  setupCards();

  cardData.forEach(data => {
    data.element.querySelector('.front').style.display = 'flex';
    data.element.classList.add('flipped');
  });

  setTimeout(() => {
    // Shuffle with animation (4x faster)
    shuffleCards(cardData.map((data, index) => {
      return { el: data.element, index: index };
    }), { swaps: 12, first: 20, last: 140 }).then(() => {
      grid.innerHTML = '';
      cardData.forEach(data => {
        data.element.querySelector('.front').style.display = 'none';
        data.element.classList.remove('flipped');
        data.element.onclick = () => flipCard(data.element);
        grid.appendChild(data.element);
      });

      gameStarted = true;
    });
  }, 2000);
}

// Animate swap between two card elements
function animateSwap(c1, c2, duration) {
  return new Promise(res => {
    c1.el.style.transition = `left ${duration}ms ease, top ${duration}ms ease`;
    c2.el.style.transition = `left ${durationÊûÅÈÄüÈ£ûËâá

    // store current positions
    const l1 = c1.el.style.left, t1 = c1.el.style.top;
    const l2 = c2.el.style.left, t2 = c2.el.style.top;

    // swap visually
    c1.el.style.left = l2; c1.el.style.top = t2;
    c2.el.style.left = l1; c2.el.style.top = t1;

    setTimeout(() => {
      c1.el.style.transition = "";
      c2.el.style.transition = "";
      res();
    }, duration + 10);
  });
}

// Shuffle cards with visible speed change (4x faster)
async function shuffleCards(cards, opts = {}) {
  const totalSwaps = opts.swaps ?? 12;
  // 4ÊûÅÈÄüÈ£ûËâá
  const first = opts.first ?? 20; // fastest
  const last = opts.last ?? 140; // slower (~7x slower but 4x faster than before)

  for (let i = 0; i < totalSwaps; i++) {
    const t = i / (totalSwaps - 1);
    const dur = Math.round(first + (last - first) * t);

    let a = Math.floor(Math.random() * cards.length);
    let b = a;
    while (b === a) b = Math.floor(Math.random() * cards.length);

    await animateSwap(cards[a], cards[b], dur);
    [cards[a], cards[b]] = [cards[b], cards[a]];
    await new Promise(r => setTimeout(r, 20));
  }
}

function flipCard(card) {
  if (!selectedBet) {
    showMessage("Please select a bet amount before starting!", 'error');
    return;
  }
  if (flippedCards.includes(card) || flippedCards.length >= 2) return;
  if (!gameStarted) return;

  card.classList.add('flipped');
  card.querySelector('.front').style.display = 'flex';
  document.getElementById('flipSound').currentTime = 0;
  document.getElementById('flipSound').play().catch(() => {});
  flippedCards.push(card);

  if (flippedCards.length === 2) {
    scratchChances--;
    setTimeout(checkWin, 1000);
  }
}

function checkWin() {
  const iconsPicked = flippedCards.map(c => c.dataset.icon);
  const result = document.getElementById('result');
  const grid = document.getElementById('cardGrid');

  if (iconsPicked[0] === iconsÊûÅÈÄüÈ£ûËâá
    // Match found
    flippedCards = [];

    // Check if all matches found
    const allFlipped = document.querySelectorAll('.card.flipped');
    if (allFlipped.length >= 8) { // 4 pairs = 8 cards
      const winAmount = selectedBet * 2;
      balance += winAmount;
      updateUserBalance(balance);
      result.innerText = `üéâ You won! Rs. ${winAmount} added.`;
      grid.classList.add('glow');
      document.getElementById('winSound').play().catch(() => {});
      document.getElementById("particles-js").style.display = "block";
      setTimeout(() => {
        document.getElementById("particles-js").style.display = "none";
        setupCards();
        activeGameBet = 0;
        endGamePopup();
      }, 2500);
    }
  } else {
    // No match
    setTimeout(() => {
      flippedCards.forEach(card => {
        card.classList.remove('flipped');
        card.querySelector('.front').style.display = 'none';
      });
      flippedCards = [];

      if (scratchChances <= 0) {
        result.innerText = `‚ùå You lost! Rs. ${selectedBet} deducted.`;
        grid.classList.add('shake');
        document.getElementById('loseSound').play().catch(() => {});

        setTimeout(()ÊûÅÈÄüÈ£ûËâá
          result.innerText = '';
          setupCards();
          activeGameBet = 0;
          if (balance <= 0) {
            showMessage("Your balance is too low. Please deposit to play again.", 'error');
            closeGamePopup();
          }
          endGamePopup();
        }, 2500);
      } else {
        result.innerText = `Chances left: ${scratchChances}`;
        setTimeout(() => {
          result.innerText = '';
        }, 1000);
      }
    }, 1000);
  }

  updateBalanceDisplay();
}

function updateUserBalance(newBalance) {
  if (!currentUser) return;

  db.collection('users').doc(currentUser.uid).update({
    balance: newBalance
  })
  .catch(error => {
    console.error('Error updating balance:', error);
  });
}

// Fruit Game
const colors = ["red", "green", "yellow", "blue", "purple"];
const fruits = {
  red: "üçé",
  green: "üçè",
  yellow: "üçã",
  blue: "üçá",
  purple: "üçÜ"
};
const durations = {
  20: 8000,
  50: 15000,
  100: 30000,
  150: 45000,
  200: 60000
};

let targetColor = "";
let fruitScore = 0;
let fruitGameInterval, fruitGameTimer, fruitCountdownInterval;
let fruitGameStarted = false;
let fruitSelectedBet = 0;

function setupFruitGame() {
  setNewFruitTarget();
}

function startFruitGame() {
  openGamePopup('fruit');
  setNewFruitTarget();
}

function setNewFruitTarget() {
  targetColor = colors[Math.floor(Math.random() * colors.length)];
  const targetDisplay = document.getElementById("fruitTargetDisplay");
  if (targetDisplay) targetDisplay.innerHTML = `Target: Shoot the <b style="color:${targetColor};">${targetColor.toUpperCase()}</b> Fruit ${fruits[targetColor]}`;
}

function spawnFruit() {
  const shootArea = document.getElementById("shootArea");
  if (!shootArea || shootArea.childElementCount >= 10) return;

  const fruit = document.createElement("div");
  fruit.classList.add("fruit");

  const isTarget = Math.random() < 0.40;
  const color = isTarget ? targetColor : colors[Math.floor(Math.random() * colors.length)];
  fruit.style.color = color;
  fruit.innerText = fruits[color];

  const size = Math.random() * 30 + 20;
  fruit.style.fontSize = `${size}px`;

  const x = Math.random() * (shootArea.clientWidth - 40);
  fruit.style.left = `${x}px`;
  fruit.style.top = "-30px";

  fruit.addEventListener("click", () => {
    if (!fruitGameStarted || fruit.clicked) return;
    fruit.clicked = true;

    if (color === targetColor) {
      fruitScore++;
    } else {
      fruitScore = Math.max(0, fruitScore - 2);
    }
    const scoreDisplay = document.getElementById("fruitScoreDisplay");
    if (scoreDisplay) scoreDisplay.textÊûÅÈÄüÈ£ûËâá
    fruit.remove();
  });

  shootArea.appendChild(fruit);

  let top = -30;
  const fallSpeed = setInterval(() => {
    top += 15;
    fruit.style.top = `${top}px`;
    if (top > shootArea.clientHeight) {
      clearInterval(fallSpeed);
      fruit.remove();
    }
  }, 50);
}

function startFruitRound(amount) {
  if (fruitGameStarted || balance < amount) {
    if (balance < amount) {
      showMessage("Insufficient balance! Please deposit more to play.", 'error');
    }
    return;
  }

  balance -= amount;
  activeGameBet = amount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  const shootArea = document.getElementById("shootArea");
  if (shootArea) shootArea.innerHTML = "";
  clearInterval(fruitGameInterval);
  clearInterval(fruitCountdownInterval);
  clearTimeout(fruitGameTimer);
  fruitScore = 0;
  const scoreDisplay = document.getElementById("fruitScoreDisplay");
  if (scoreDisplay) scoreDisplay.innerText = "Score: 0";
  setNewFruitTarget();

  fruitSelectedBet = amount;
  fruitÊûÅÈÄüÈ£ûËâá

  document.querySelectorAll('#fruitGame .bet-amounts .gold-box').forEach(btn => {
    btn.style.pointerEvents = "none";
    btn.style.opacity = "0.4";
  });

  let timeLeft = durations[amount] / 1000;
  const countdownElement = document.getElementById("fruitCountdown");
  if (countdownElement) countdownElement.innerText = `Time: ${timeLeft}s`;

  fruitCountdownInterval = setInterval(() => {
    timeLeft--;
    if (countdownElement) countdownElement.innerText = `Time: ${timeLeft}s`;
    if (timeLeft <= 0) clearInterval(fruitCountdownInterval);
  }, 1000);

  fruitGameInterval = setInterval(spawnFruit, 200);

  fruitGameTimer = setTimeout(() => {
    clearInterval(fruitGameInterval);
    clearInterval(fruitCountdownInterval);
    fruitGameStarted = false;

    let winAmount = 0;
    if (fruitScore >= Math.floor(fruitSelectedBet * 1.5)) {
      winAmount = fruitSelectedBet * 2;
      balance += winAmount;
      updateUserBalance(balance);
      showMessage(`üéâ Congratulations! You scored ${fruitScore} points (Target: ${Math.floor(fruitSelectedÊûÅÈÄüÈ£ûËâá
      document.getElementById('winSound').play().catch(() => {});
    } else {
      showMessage(`‚ùå Game Over! You scored ${fruitScore} points (Target: ${Math.floor(fruitSelectedBet * 1.5)}).\nYou lost your bet of Rs. ${fruitSelectedBet}.\nNew Balance: Rs. ${balance}`, 'error');
      document.getElementById('loseSound').play().catch(() => {});
    }

    updateBalanceDisplay();
    activeGameBet = 0;

    document.querySelectorAll('#fruitGame .bet-amounts .gold-box').forEach(btn => {
      btn.style.pointerEvents = "auto";
      btn.style.opacity = "1";
    });

    if (shootArea) shootArea.innerHTML = "";
    if (scoreDisplay) scoreDisplay.innerText = "";
    if (countdownElement) countdownElement.innerText = "Time: 0s";
    setNewFruitTarget();
    endGamePopup();

  }, durations[amount]);
}

// Tic Tac Toe Game
let ticTacToeBoard = ['', '', '', '', '', '', '', '', ''];
let currentPlayer = 'X';
let ticTacToeGameActive = false;
let ticTacToeBetAmount = 0;
let tÊûÅÈÄüÈ£ûËâá
let ticTacToeTimer;

function setupTicTacToeGame() {
  ticTacToeBoard = ['', '', '', '', '', '', '', '', ''];
  currentPlayer = 'X';
}

function startTicTacToeGame() {
  openGamePopup('tictactoe');
  setupTicTacToeGame();
  renderTicTacToeBoard();
}

function selectTicTacToeBet(amount) {
  if (ticTacToeGameActive) return;

  if (balanceÊûÅÈÄüÈ£ûËâá
    showMessage("Insufficient balance! Please deposit more to play.", 'error');
    return;
  }

  ticTacToeBetAmount = amount;
  activeGameBet = amount;
  document.querySelectorAll('#tictactoeGame .bet-amounts .gold-box').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');

  startTicTacToeRound();
}

function startTicTacToeRound() {
  ticTacToeGameActive = true;
  currentPlayer = 'X';
  ticTacToeBoard = ['', '', '', '', '', '', '', '', ''];
  ticTacToeCountdown = 30;

  balance -= ticTacToeBetAmount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  const countdownElement = document.getElementById('tictactoeCountdown');
  if (countdownElement) countdownElement.textContent = `Time: ${ticTacToeCountdown}s`;
  ticTacÊûÅÈÄüÈ£ûËâá
    ticTacToeCountdown--;
    if (countdownElement) countdownElement.textContent = `Time: ${ticTacToeCountdown}s`;

    if (ticTacToeCountdown <= 0) {
      clearInterval(ticTacToeTimer);
      endTicTacToeGame(false, "Time's up! Game ended in a draw.");
    }
  }, 1000);

  renderTicTacToeBoard();
  const resultElement = document.getElementById('tictactoeResult');
  if (resultElement) resultElementÊûÅÈÄüÈ£ûËâá
}

function renderTicTacToeBoard() {
  const boardElement = document.getElementById('ticTacToeBoard');
  if (!boardElement) return;
  boardElement.innerHTML = '';

  for (let i = 0; i < 9; i++) {
    const cell = document.createElement('div');
    cell.className = 'tic-tac-toe-cell';
    cell.textContent = ticTacToeBoard[i];
    cell.onclick = () => makeTicTacToeMove(i);
    boardElement.appendChild(cell);
  }
}

function makeTicTacToeMove(index) {
  if (!ticTacToeGameActive || ticTacToeBoard[index] !== '' || currentPlayer !== 'X') return;

  ticTacToeBoard[index] = 'X';
  renderTicTacToeBoard();

  if (checkTicTacToeWin('X')) {
    endTicTacToeGame(true, "You won! Rs. " + (ticTacToeBetAmount * 2) + " added to your balance.");
    return;
  }

  if (!ticTacToeBoard.includes('')) {
    endTÊûÅÈÄüÈ£ûËâá
    return;
  }

  const resultElement = document.getElementById('tictactoeResult');
  if (resultElement) resultElement.textContent = "Computer thinking...";

  setTimeout(() => {
    let move = findBestMove();
    ticTacToeBoard[move] = 'O';
    renderTicTacToeBoard();

    if (checkTicTacToeWin('O')) {
      endTicTacToeGame(false, "Computer won! You lost your bet.");
      return;
    }

    if (!ticTacToeBoard.includes('')) {
      endTicTacToeGame(false, "Game ended in a draw. You lost 25% of your bet.");
      return;
    }

    if (resultElement) resultElement.textContent = "Your turn (X)";
  }, 1000);
}

function findBestMove() {
  // Try to win first
  for (let i = 0; i < 9; i++) {
    if (ticTacToeBoard[i] === '') {
      ticTacToeBoard[i] = 'O';
      if (checkTicTacToeWin('O')) {
        ticTacToeBoard[i] = '';
        return i;
      }
      ticTacToeBoard[i] = '';
    }
  }

  // Block player from winning
  for (let i = 0; i < 9; i++) {
    if (ticTacToeBoard[i] === '') {
      ticTacToeBoard[i] = 'X';
      if (checkTicTacToeWin('X')) {
        ticTacToeBoard[i] = '';
        return i;
      }
      ticTacToeBoard[i] = '';
    }
  }

  // Take center if available
  if (ticTacToeBoard[4] === '') return 4;

  // Take corners if available
  const corners = [0, 2, 6, 8];
  const availableCorners = corners.filter(i => ticTacToeBoard[i] === '');
  if (availableCorners.length > 0) {
    return availableCorners[Math.floor(Math.random() * availableCorners.length)];
  }

  // Take any available spot
  const availableSpots = [];
  for (let i = ÊûÅÈÄüÈ£ûËâá
    if (ticTacToeBoard[i] === '') availableSpots.push(i);
  }
  return availableSpots[Math.floor(Math.random() * availableSpots.length)];
}

function checkTicTacToeWin(player) {
  const winPatterns = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8],
    [0, 3, 6], [1, 4, 7], [2, 5, 8],
    [0, 4, 8], [2, 4, 6]
  ];

  return winPatterns.some(pattern => {
    return pattern.every(index => ticTacToeBoard[index] === player);
  });
}

function endTicTacToeGame(playerWon, message) {
  clearInterval(ticTacToeTimer);
  ticTacToeGameActive = false;

  if (playerWon) {
    const winAmount = ticTacToeBetAmount * 2;
    balance += winAmount;
    document.getElementById('winSound').play().catch(() => {});
  } else {
    const deduction = ticTacToeBetAmount * 0.25;
    balance -= deduction;
    document.getElementById('loseSound').play().catch(() => {});
  }

  updateUserBalance(balance);
  updateBalanceDisplay();
  activeGameBet = 0;

  const resultElement = document.getElementById('tictactoeResult');
  if (resultElement) resultElement.textContent = message;
  document.querySelectorAll('#tictactoeGame .bet-amounts .gold-box').forEach(btn => {
    btn.classList.remove('active');
  });

  if (playerÊûÅÈÄüÈ£ûËâá
    document.getElementById("particles-js").ÊûÅÈÄüÈ£ûËâá
    setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
  }
  endGamePopup();
}

// Find Ace Game
let findAceCards = ['K', 'Q', 'A'];
let findAceFlippedCards = [];
let findAceGameActive = false;
let findAceBetAmount = 0;
let findAceTimer;
let findAceCountdown = 15;

function setupFindAceGame() {
  findAceCards = ['K', 'Q', 'A'];
}

function startFindAceGame() {
  openGamePopup('findAce');
  setupFindAceGame();
}

function startFindAceRound(amount) {
  if (findAceGameActive || balance < amount) {
    if (balance < amount) {
      showMessage("Insufficient balance! Please deposit more to play.", 'error');
    }
    return;
  }

  findAÊûÅÈÄüÈ£ûËâá
  activeGameBet = amount;
  findAceGameActive = true;
  findAceFlippedCards = [];

  balance -= amount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  const resultElement = document.getElementById('findAceResult');
  if (resultElement) resultElement.textContent = '';
  const grid = document.getElementById('findAceGrid');
  if (grid) grid.innerHTML = '';

  const cardsToShow = shuffleArray([...findAceCards]);
  if (grid) {
    cardsToShow.forEach((card, index) => {
      const cardElement = document.createElement('div');
      cardElement.className = 'card';

      const front = document.createElement('div');
      front.className = 'front';
      front.textContent = card;

      const back = document.createElement('div');
      back.className = 'back';

      cardElement.appendChild(front);
      cardElement.appendChild(back);
      cardElement.dataset.value = card;
      grid.appendChild(cardElement);
    });
  }

  findAceCountdown = 15;
  const countdownElement = document.getElementById('findAceCountdown');
  if (countdownElement) countdownElement.textContent = `Time: ${findAceCountdown}s`;

  const countdownInterval = setInterval(() => {
    findAceCountdown--;
    if (countdownElement) countdownElement.textContent = `Time: ${findAceCountdown}s`;

    if (findAceCountdown <= 0) {
      clearInterval(countdownInterval);
      endFindAceRound(false, "Time's up! You lost your bet.");
    }
  }, 1000);

  setTimeout(() => {
    document.querySelectorAll('#findAceGrid .card').forEach(card => {
      card.querySelector('.front').style.display = 'none';
      card.classList.remove('flipped');
    });

    // Shuffle with animation (4x faster)
    const cardElements = Array.from(document.querySelectorAll('#findAceGrid .card'));
    shuffleCards(cardElements.map((el, index) => {
      return { el: el, index: index };
    }), { swaps: 12, first: 20, last: 140 }).then(() => {
      document.querySelectorAll('#findAceGrid .card').forEach(card => {
        card.onclick = () => flipFindAceCard(card);
      });
    });
  }, 3000);
}

function flipFindAceCard(card) {
  if (!findAceGameActive || card.classList.contains('flipped')) return;

  card.classList.add('flipped');
  card.querySelector('.front').style.display = 'flex';
  document.getElementById('flipSound').currentTime = 0;
  document.getElementById('flipSound').play().catch(() => {});

  if (card.dataset.value === 'A') {
    endFindAceRound(true, "üéâ You found the Ace! You win double your bet.");
  } else {
    endFindAceRound(false, "‚ùå Wrong card! You lost your bet.");
  }
}

function endFindAceRound(won, message) {
  findAceGameActive = false;

  if (won) {
    const winAmount = findAceBetAmount * 2;
    balance += winAmount;
    document.getElementById('winSound').play().catch(() => {});
  } else {
    document.getElementById('loseSound').play().catch(() => {});
  }

  updateUserBalance(balance);
  updateBalanceDisplay();
  activeGameBet = 0;

  const resultElement = document.getElementById('findAceResult');
  if (resultElement) resultElement.textContent = message;

  if (won) {
    document.getElementById("particles-js").style.display = "block";
    setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
  }
  endGamePopup();
}

// Archery Game
let archeryBet = 0;
let archeryShots = [];
let archeryAutoMode = false;
let archeryGameActive = false;
let ringRadii = [];

function setupArcheryGame() {
  const canvas = document.getElementById('archeryCanvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');

  let DPR = window.devicePixelRatio || 1;
  function fixCanvas() {
    const cssW = canvas.clientWidth || canvas.width;
    const cssH = canvas.clientHeight || canvas.height;
    canvas.width = Math.round(cssW * DPR);
    canvas.height = Math.round(cssH * DPR);
    canvas.style.width = cssW + 'px';
    canvas.style.height = cssH + 'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  fixCanvas();
  window.addEventListener('resize', () => { fixCanvas(); drawArchery(); });

  const W = canvas.width / DPR;
  const H = canvas.height / DPR;
  const cx = W/2;
  const cy = H/2;

  let boardRadius = Math.min(W,H) * 0.42 * 1.6; // Increased by 60% as requested

  const ringDefs = [
    {score:10, colorInner:'#ffdd66', colorOuter:'#ffcc00', radiusRatio:0.06},
    {score:8, colorInner:'#ffb76b', colorOuter:'#ff8f2e', radiusRatio:0.16},
    {score:7, colorInner:'#ff6b6b', colorOuter:'#d6453b', radiusRatio:0.28},
    {score:5, colorInner:'#3aa0ff', colorOuter:'#1475c7', radiusRatio:0.45},
    {ÊûÅÈÄüÈ£ûËâá
    {score:1, colorInner:'#f6f6f6', colorOuter:'#e9e9e9', radiusRatio:1.00}
  ];

  ringRadii = ringDefs.map(r => boardRadius * r.radiusRatio);

  let sight = {
    x: W - 8,
    y: cy,
    radius: 14 * 1.1, // Increased by 10% as requested
    movingLeft: true,
    speed: 6.0,
    active: false,
    auto: false,
    _lastCross: false
  };

  function drawBoard(){
    const woodR = boardRadius * 1.08;
    const g = ctx.createLinearÊûÅÈÄüÈ£ûËâá
    g.addColorStop(0,'#7a5232'); g.addColorStop(0.5,'#a8764f'); g.addColorStop(1,'#5b391f');
    ctx.beginPath();
    ctx.arc(cx, cy, woodR, 0, Math.PI*2);
    ctx.fillStyle = g; ctx.fill();

    ctx.beginPath();
    ctx.arc(cx, cy, boardRadius + 6, 0, Math.PIÊûÅÈÄüÈ£ûËâá
    ctx.fillStyle = '#f8f5ee'; ctx.fill();

    for(let i = ringDefs.length-1; i >= 0; i--){
      const rd = ringRadii[i];
      const def = ringDefs[i];
      const grad = ctx.createRadialGradient(cx, cy, rd*0.1, cx, cy, rd);
      grad.addColorStop(0, def.colorInner);
      grad.addColorStop(1, def.colorOuter);
      ctx.beginPath();
      ctx.arc(cx, cy, rd, 0, Math.PI*2);
      ctx.fillStyle = grad;
      ctx.fill();

      ctx.beginPath();
      ctx.arc(cx, cy, rd, 0, Math.PI*2);
      ctx.lineWidth = 1;
      ctx.strokeStyle = 'rgba(0,0,0,0.18)';
      ctx.stroke();
    }

    ctx.beginPath();
    ctx.arc(cx, cy, 2.2, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(255,255,255,0.06)';
    ctx.fill();
  }

  function drawSight(){
    if(!sight.active) return;
    ctx.save();
    ctx.translate(sight.x, sight.y);
    ctx.beginPath();
    ctx.arc(0,0, sight.radius+6, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(30,220,120,0.04)';
    ctx.fill();
    ctx.beginPath();
    ctx.arc(0,0, sight.radius, 0, Math.PI*2);
    ctx.lineWidth = 2;
    ctx.strokeStyle = 'rgba(180,255,200,0.95)';
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(-14,0); ctx.lineTo(-6,0);
    ctx.moveTo(6,0); ctx.lineTo(14,0);
    ctx.moveTo(0,-14); ctx.lineÊûÅÈÄüÈ£ûËâá
    ctx.moveTo(0,6); ctx.lineTo(0,14);
    ctx.strokeStyle = 'ÊûÅÈÄüÈ£ûËâá
    ctx.lineWidth = 1.6;
    ctx.stroke();
    ctx.restore();
  }

  function updateSight(){
    if(!ÊûÅÈÄüÈ£ûËâá
    if(sight.movingLeft){
      sight.x -= sight.speed;
      if(sight.x <= 8){
        sight.x = 8;
        sight.movingLeft = false;
      }
    } else {
      sight.x += sight.speed;
      if(sight.x >= W - 8){
        sight.x = W - 8;
        sight.movingLeft = true;
      }
    }

    if(sight.auto){
      const centerBand = 8;
      if(!sight._lastCross && Math.abs(sight.x - cx) <= centerBand){
        sight._lastCross = true;
        performShot();
      } else if(Math.abs(sight.x - cx) > centerBand){
        sight._lastCross = false;
      }
    }
  }

  function computeScore(px, py){
    const dx = px - cx;
    const dy = py - cy;
    const dist = Math.sqrt(dx*dx + dy*dy);
    for(let i=0;i<ringRadii.length;i++){
      if(dist <= ringRadii[i]) {
        return ringDefs[i].score;
      }
    }
    return 0;
  }

  function performShot(){
    if(!sight.active) return;
    if(archeryBet === 0){
      const statusElement = document.getElementById('archeryStatus');
      if (statusElement) statusElement.textContent = 'You must select a bet first.';
      return;
    }
    if(archeryShots.length >= 5) return;

    const score = computeScore(sight.x, sight.y);
    archeryShots.push(score);
    refreshScoreBoxes();

    const statusElement = document.getElementById('archeryStatus');
    if (statusElement) statusElement.textContent = `Shot ${archeryShots.length}/5: ${score} points`;

    if(archeryShots.length >= 5){
      finishArcheryGame();
    }
  }

  function refreshScoreBoxes(){
    const scoreRow = document.getElementById('archeryScoreRow');
    if (!scoreRow) return;
    scoreRow.innerHTML = '';
    for(let i=0;i<5;i++){
      const box = document.createElement('div');
      box.className = 'archery-score-box';
      if(i < archeryShots.length){
        box.textContent = archeryShots[i];
      }
      scoreRow.appendChild(box);
    }
  }

  function drawArchery(){
    ctx.clearRect(0,0,W,H);
    drawBoard();
    drawSight();
    for(let i=0;i<archeryShots.length;i++){
      const s = archeryShots[i];
      const angle = Math.random() * Math.PI*2;
      const offset = 3 + Math.random() * 6;
      const x = cx + Math.cos(angle) * offset;
      const y = cy + Math.sin(angle) * offset;
      const color = ringDefs.find(r => r.score === s)?.colorOuter || '#000';
      ctx.beginPath();
      ctx.arc(x, y, 2.5, 0, Math.PI*2);
      ctx.fillStyle = color;
      ctx.fill();
      ctx.beginPath();
      ctx.arc(x, y, 2.5, 0, Math.PI*2);
      ctx.strokeStyle = 'rgba(0,0,0,0.4)';
      ctx.lineWidth = 0.8;
      ctx.stroke();
    }
  }

  function animate(){
    if(archeryGameActive){
      updateSight();
    }
    drawArchery();
    requestAnimationFrame(animate);
  }

  canvas.addEventListener('click', () => {
    if(archeryAutoMode) return;
    performShot();
  });

  animate();

  // Start game when bet is selected
  refreshScoreBoxes();
}

function startArcheryGame() {
  openGamePopup('archery');
  setupArcheryGame();
}

function selectArcheryBet(amount) {
  if (archeryGameActive) return;

  if (balance < amount) {
    showMessage("Insufficient balance! Please deposit more to play.", 'error');
    return;
  }

  archeryBet = amount;
  activeGameBet = amount;
  document.querySelectorAll('#archeryGame .bet-amounts .gold-box').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');

  balance -= amount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  const canvas = document.getElementById('archeryCanvas');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    archeryGameActive = true;
    archeryShots = [];
    refreshScoreBoxes();
    const statusElement = document.getElementById('archeryStatus');
    if (statusElement) statusElement.textContent = 'Take your shots by clicking or using Auto mode';
  }
}

function toggleArcheryAuto() {
  const btn = document.getElementById('archeryAutoBtn');
  if (!btn) return;
  archeryAutoMode = !archeryAutoMode;
  btn.textContent = 'Auto: ' + (archeryAutoMode ? 'ON' : 'OFF');
}

function finishArcheryGame() {
  const totalScore = archeryShots.reduce((sum, score) => sum + score, 0);
  const statusElement = document.getElementById('archeryStatus');
  if (!statusElement) return;

  if (totalScore >= 25) {
    const winAmount = archeryBet * 2;
    balance += winAmount;
    updateUserBalance(balance);
    statusElement.textContent = `üéâ You scored ${totalScore}/50 points! You win Rs. ${winAmount}`;
    document.getElementById('winSound').play().catch(() => {});
  } else {
    statusElement.textContent = `‚ùå You scored ${totalScore}/50 points. You lost your bet of Rs. ${archeryBet}`;
    document.getElementById('loseSound').play().catch(() => {});
  }

  updateBalanceDisplay();
  activeGameBet = 0;

  if (totalScore >= 25) {
    document.getElementById("particles-js").style.display = "block";
    setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
  }
  endGamePopup();
}

// Chess Game
let chessGame = new Chess();
let chessBoardElement;
let chessSelectedBet = 0;
let chessTimer;
let chessTimeLeft = 900; // 15 minutes
let chessGameActive = false;

function setupChessGame() {
  chessGame = new Chess();
  chessTimeLeft = 900;
  chessGameActive = false;
}

function startChessGame() {
  openGamePopup('chess');
  setupChessGame();
  renderChessBoard();
}

function selectChessBet(amount) {
  if (chessGameActive) return;

  if (balance < amount) {
    showMessage("Insufficient balance! Please deposit more to play.", 'error');
    return;
  }

  chessSelectedBet = amount;
  activeGameBet = amount;
  document.querySelectorAll('#chessGame .bet-amounts .gold-box').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');

  balance -= amount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  startChessRound();
}

function startChessRound() {
  chessGameActive = true;
  chessTimeLeft = 900;
  chessGame.reset();
  renderChessBoard();

  const countdownElement = document.getElementById('chessCountdown');
  if (countdownElement) countdownElement.textContent = formatTime(chessTimeLeft);

  chessTimer = setInterval(() => {
    chessTimeLeft--;
    if (countdownElement) countdownElement.textContent = formatTime(chessTimeLeft);

    if (chessTimeLeft <= 0) {
      clearInterval(chessTimer);
      endChessGame(false, "Time's up! You lost the game.");
    }
  }, 1000);

  const statusElement = document.getElementById('chessStatus');
  if (statusElement) statusElement.textContent = "Your turn (White)";
}

function renderChessBoard() {
  const boardElement = document.getElementById('chessBoard');
  if (!boardElement) return;
  boardElement.innerHTML = '';

  const isWhite = true; // Player is always white
  const pieces = {
    'p': isWhite ? '‚ôô' : '‚ôü',
    'n': isWhite ? '‚ôò' : '‚ôû',
    'b': isWhite ? '‚ôó' : '‚ôù',
    'r': isWhite ? '‚ôñ' : '‚ôú',
    'q': isWhite ? '‚ôï' : '‚ôõ',
    'k': isWhite ? '‚ôî' : '‚ôö'
  };

  for (let i = 0; i < 8; i++) {
    for (let j = 0; j < 8; j++) {
      const square = document.createElement('div');
      square.className = `chess-square ${(i + j) % 2 === 0 ? 'light' : 'dark'}`;
      square.dataset.row = i;
      square.dataset.col = j;

      const piece = chessGame.board()[i][j];
      if (piece) {
        square.textContent = pieces[piece.type];
      }

      square.onclick = () => makeChessMove(square);
      boardElement.appendChild(square);
    }
  }
}

function makeChessMove(square) {
  if (!chessGameActive || chessGame.turn() !== 'w') return;

  const row = parseInt(square.dataset.row);
  const col = parseInt(square.dataset.col);
  const from = getSquareFromCoords(selectedPiece.row, selectedPiece.col);
  const to = getSquareFromCoords(row, col);

  const move = chessGame.move({
    from: from,
    to: to,
    promotion: 'q' // Always promote to queen for simplicity
  });

  if (move) {
    renderChessBoard();
    document.getElementById('moveSound').play().catch(() => {});

    if (chessGame.in_check()) {
      document.getElementById('checkSound').play().catch(() => {});
    }

    if (chessGame.is_checkmate()) {
      endChessGame(true, "Checkmate! You won the game!");
      return;
    }

    if (chessGame.is_draw()) {
      endChessGame(false, "Game ended in a draw. You lost 25% of your bet.");
      return;
    }

    // Computer's turn
    setTimeout(makeComputerMove, 1000);
  } else {
    // Select piece
    selectedPiece = { row, col };
    highlightValidMoves(from);
  }
}

function highlightValidMoves(from) {
  const validMoves = chessGame.moves({ square: from, verbose: true });
  validMoves.forEach(move => {
    const coords = getCoordsFromSquare(move.to);
    const square = document.querySelector(`.chess-square[data-row="${coords.row}"][data-col="${coords.col}"]`);
    if (square) {
      square.classList.add('valid-move');
    }
  });
}

function getSquareFromCoords(row, col) {
  const files = 'abcdefgh';
  const ranks = '87654321';
  return files[col] + ranks[row];
}

function getCoordsFromSquare(square) {
  const files = 'abcdefgh';
  const ranks = '87654321';
  return {
    row: ranks.indexOf(square[1]),
    col: files.indexOf(square[0])
  };
}

function makeComputerMove() {
  if (!chessGameActive || chessGame.turn() !== 'b') return;

  const moves = chessGame.moves();
  if (moves.length === 0) {
    endChessGame(false, "Stalemate! Game ended in a draw.");
    return;
  }

  // Simple AI: evaluate moves and choose the best one
  let bestMove = null;
  let bestScore = -Infinity;

  for (const move of moves) {
    chessGame.move(move);
    const score = evaluateBoard();
    chessGame.undo();

    if (score > bestScore) {
      bestScore = score;
      bestMove = move;
    }
  }

  if (bestMove) {
    chessGame.move(bestMove);
    renderChessBoard();
    document.getElementById('moveSound').play().catch(() => {});

    if (chessGame.in_check()) {
      document.getElementById('checkSound').play().catch(() => {});
    }

    if (chessGame.is_checkmate()) {
      endChessGame(false, "Checkmate! Computer won the game.");
      return;
    }

    if (chessGame.is_draw()) {
      endChessGame(false, "Game ended in a draw. You lost 25% of your bet.");
      return;
    }
  }
}

function evaluateBoard() {
  // Simple evaluation function
  let score = 0;
  const pieceValues = {
    'p': 1, 'n': 3, 'b': 3, 'r': 5, 'q': 9, 'k': 0
  };

  for (let i = 0; i < 8; i++) {
    for (let j = 0; j < 8; j++) {
      const piece = chessGame.board()[i][j];
      if (piece) {
        const value = pieceValues[piece.type];
        score += piece.color === 'b' ? value : -value;
      }
    }
  }

  return score;
}

function resignChessGame() {
  if (chessGameActive) {
    endChessGame(false, "You resigned the game. You lost your bet.");
  }
}

function endChessGame(won, message) {
  clearInterval(chessTimer);
  chessGameActive = false;

  if (won) {
    const winAmount = chessSelectedBet * 2;
    balance += winAmount;
    document.getElementById('winSound').play().catch(() => {});
  } else {
    const deduction = chessSelectedBet * 0.25;
    balance -= deduction;
    document.getElementById('loseSound').play().catch(() => {});
  }

  updateUserBalance(balance);
  updateBalanceDisplay();
  activeGameBet = 0;

  const statusElement = document.getElementById('chessStatus');
  if (statusElement) statusElement.textContent = message;

  if (won) {
    document.getElementById("particles-js").style.display = "block";
    setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
  }
  endGamePopup();
}

function formatTime(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// Admin functions
function loadAdminData() {
  if (!currentUser) return;

  // Load users
  db.collection('users').get()
    .then(querySnapshot => {
      const usersTable = document.getElementById('usersTable');
      if (usersTable) usersTable.innerHTML = '';

      querySnapshot.forEach(doc => {
        const userData = doc.data();
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${userData.name || 'N/A'}</td>
          <td>${userData.email || 'N/A'}</td>
          <td>Rs. ${userData.startingBalance || 0}</td>
          <td>Rs. ${userData.balance || 0}</td>
          <td>
            <button class="admin-action" onclick="adjustBalance('${doc.id}', '${userData.name || userData.email}')">Adjust</button>
          </td>
        `;
        if (usersTable) usersTable.appendChild(row);
      });
    });

  // Load deposit requests
  db.collection('deposit_requests')
    .orderBy('createdAt', 'desc')
    .get()
    .then(querySnapshot => {
      const table = document.getElementById('depositRequestsTable');
      if (table) table.innerHTML = '';

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${data.userName || 'N/A'}</td>
          <td>Rs. ${data.amount}</td>
          <td>${data.method}</td>
          <td>${data.transactionId}</td>
          <td>${data.status}</td>
          <td>${data.createdAt?.toDate().toLocaleString() || 'N/A'}</td>
          <td>
            ${data.status === 'pending' ? `
              <button class="admin-action" onclick="updateRequestStatus('deposit', '${doc.id}', 'approved')">Approve</button>
              <button class="admin-action reject" onclick="updateRequestStatus('deposit', '${doc.id}', 'rejected')">Reject</button>
            ` : 'Completed'}
          </td>
        `;
        if (table) table.appendChild(row);
      });
    });

  // Load withdrawal requests
  db.collection('withdraw_requests')
    .orderBy('createdAt', 'desc')
    .get()
    .then(querySnapshot => {
      const table = document.getElementById('withdrawRequestsTable');
      if (table) table.innerHTML = '';

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${data.userName || 'N/A'}</td>
          <td>Rs. ${data.amount}</td>
          <td>${data.method}</td>
          <td>${data.accountNumber} (${data.accountName})</td>
          <td>${data.status}</td>
          <td>${data.createdAt?.toDate().toLocaleString() || 'N/A'}</td>
          <td>
            ${data.status === 'pending' ? `
              <button class="admin-action" onclick="updateRequestStatus('withdraw', '${doc.id}', 'approved')">Approve</button>
              <button class="admin-action reject" onclick="updateRequestStatus('withdraw', '${doc.id}', 'rejected')">Reject</button>
            ` : 'Completed'}
          </td>
        `;
        if (table) table.appendChild(row);
      });
    });
}

function searchUsers() {
  const searchTerm = document.getElementById('searchUser').value.toLowerCase();
  const rows = document.querySelectorAll('#usersTable tr');

  rows.forEach(row => {
    const name = row.cells[0].textContent.toLowerCase();
    const email = row.cells[1].textContent.toLowerCase();
    if (name.includes(searchTerm) || email.includes(searchTerm)) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
}

function adjustBalance(userId, userName) {
  const newBalance = prompt(`Adjust balance for ${userName}:`, '0');
  if (newBalance !== null && !isNaN(newBalance)) {
    db.collection('users').doc(userId).update({
      balance: parseFloat(newBalance)
    })
    .then(() => {
      showMessage('Balance updated successfully!', 'success');
      loadAdminData();
    })
    .catch(error => {
      showMessage('Error updating balance: ' + error.message, 'error');
    });
  }
}

function updateRequestStatus(type, requestId, status) {
  const collection = type === 'deposit' ? 'deposit_requests' : 'withdraw_requests';

  db.collection(collection).doc(requestId).get()
    .then(doc => {
      if (!doc.exists) {
        showMessage('Request not found', 'error');
        return;
      }

      const data = doc.data();
      if (data.status !== 'pending') {
        showMessage('Request has already been processed', 'error');
        return;
      }

      if (type === 'withdraw' && status === 'rejected') {
        // Refund the amount to user's balance
        return db.collection('users').doc(data.userId).update({
          balance: firebase.firestore.FieldValue.increment(data.amount)
        })
        .then(() => {
          return db.collection(collection).doc(requestId).update({
            status: status,
            processedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        });
      } else {
        return db.collection(collection).doc(requestId).update({
          status: status,
          processedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
    })
    .then(() => {
      showMessage(`Request ${status} successfully!`, 'success');
      loadAdminData();
    })
    .catch(error => {
      showMessage('Error updating request: ' + error.message, 'error');
    });
}

function sendAnnouncement() {
  const message = document.getElementById('announcementText').value;
  if (!message) {
    showMessage('Please enter a message', 'error');
    return;
  }

  db.collection('announcements').add({
    message: message,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    createdBy: currentUser.uid
  })
  .then(() => {
    showMessage('Announcement sent successfully!', 'success');
    document.getElementById('announcementText').value = '';
  })
  .catch(error => {
    showMessage('Error sending announcement: ' + error.message, 'error');
  });
}

// Announcement functions
function loadAnnouncements() {
  db.collection('announcements')
    .orderBy('createdAt', 'desc')
    .limit(10)
    .get()
    .then(querySnapshot => {
      const messageList = document.getElementById('messageList');
      if (messageList) messageList.innerHTML = '';

      if (querySnapshot.empty) {
        messageList.innerHTML = '<p>No announcements yet</p>';
        return;
      }

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const item = document.createElement('div');
        item.className = 'message-item';
        item.innerHTML = `
          <div>${data.message}</div>
          <div class="message-date">${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
        `;
        if (messageList) messageList.appendChild(item);
      });
    });
}

function toggleMessages() {
  const popup = document.getElementById('messagePopup');
  if (popup.style.display === 'block') {
    popup.style.display = 'none';
  } else {
    popup.style.display = 'block';
    loadAnnouncements();
  }
}

function closeMessages() {
  document.getElementById('messagePopup').style.display = 'none';
}

// Utility functions
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Initialize particles
particlesJS("particles-js", {
  particles: {
    number: { value: 30, density: { enable: true, value_area: 800 } },
    color: { value: "#2563EB" },
    shape: { type: "circle" },
    opacity: { value: 0.5, random: true },
    size: { value: 3, random: true },
    line_linked: { enable: true, distance: 150, color: "#2563EB", opacity: 0.4, width: 1 },
    move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
  },
  interactivity: {
    detect_on: "canvas",
    events: { onhover: { enable: true, mode: "repulse" }, onclick: { enable: true, mode: "push" }, resize: true }
  }
});
</script>
</body>
</html>
