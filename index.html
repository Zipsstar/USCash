<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USCash 🎮</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #FFD700;
            --secondary: #1E90FF;
            --dark: #0A0A0A;
            --light: #FFFFFF;
            --accent: #FF6347;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark);
            color: var(--primary);
            text-align: center;
            margin: 0;
            padding: 0;
            background-image: radial-gradient(circle at 10% 20%, rgba(255, 215, 0, 0.05) 0%, transparent 20%),
                            radial-gradient(circle at 90% 80%, rgba(30, 144, 255, 0.05) 0%, transparent 20%);
        }

        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            margin: 20px 0;
            letter-spacing: 2px;
            position: relative;
            display: inline-block;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        .nav {
            background: linear-gradient(90deg, var(--dark), var(--primary), var(--dark));
            color: var(--dark);
            padding: 12px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
            position: relative;
            z-index: 100;
        }

        .nav a {
            color: var(--dark);
            text-decoration: none;
            font-weight: bold;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s;
            font-size: 1.1rem;
        }

        .nav a:hover {
            background-color: var(--dark);
            color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .section {
            margin: 30px auto;
            padding: 25px;
            max-width: 900px;
            border: 2px solid var(--primary);
            border-radius: 15px;
            box-sizing: border-box;
            background-color: rgba(10, 10, 10, 0.8);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid transparent;
            border-image: linear-gradient(45deg, var(--primary), var(--secondary)) 1;
            z-index: -1;
            animation: borderRotate 8s linear infinite;
        }

        @keyframes borderRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .gold-box {
            display: inline-block;
            background: linear-gradient(145deg, var(--primary), #e6c200);
            color: var(--dark);
            margin: 8px;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: none;
        }

        .gold-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(255, 215, 0, 0.3);
            background: linear-gradient(145deg, #ffdf00, var(--primary));
        }

        .gold-box.active {
            background: var(--dark);
            color: var(--primary);
            border: 2px solid var(--primary);
            box-shadow: 0 0 15px var(--primary);
        }

        .game-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
        }

        .game-options .gold-box {
            width: 100%;
            height: 180px;
            font-size: 1.4rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        .game-options .gold-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 0;
        }

        .game-options .gold-box > * {
            position: relative;
            z-index: 1;
        }

        .game-options .gold-box:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--primary);
        }

        .game-options .gold-box i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        /* Updated game thumbnails */
        .scratch-thumbnail {
            background-image: url('https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
        }

        .fruit-thumbnail {
            background-image: url('https://images.unsplash.com/photo-1619566636858-adf3ef46400b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
        }

        .tictactoe-thumbnail {
            background-image: url('https://images.unsplash.com/photo-1536514498073-50e69d39c6cf?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
        }

        .findace-thumbnail {
            background-image: url('https://images.unsplash.com/photo-1501004318641-b39e6451bec6?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
        }

        .archery-thumbnail {
            background-image: url('https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
        }

        .card-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px auto;
            max-width: 450px;
        }

        .card {
            width: 90px;
            height: 110px;
            background-color: white;
            color: black;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary);
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.4s, background-color 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background-size: cover;
            background-position: center;
        }

        .card.flipped {
            background: linear-gradient(145deg, var(--primary), #e6c200);
            color: var(--dark);
            transform: rotateY(180deg);
            box-shadow: 0 0 15px var(--primary);
        }

        .bet-amounts {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        #result {
            margin-top: 20px;
            font-size: 1.3rem;
            color: var(--light);
            padding: 10px;
            border-radius: 8px;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .shake {
            animation: shake 0.5s;
        }

        .glow {
            animation: glow 1s infinite alternate;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            20% { transform: translate(-3px, 0px) rotate(-2deg); }
            40% { transform: translate(3px, 2px) rotate(2deg); }
            60% { transform: translate(-2px, 1px) rotate(0deg); }
            80% { transform: translate(2px, -1px) rotate(2deg); }
            100% { transform: translate(1px, 1px) rotate(0deg); }
        }

        @keyframes glow {
            from { box-shadow: 0 0 10px var(--primary); }
            to { box-shadow: 0 0 20px var(--light); }
        }

        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            display: none;
        }

        #welcomePopup {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        #welcomePopup .popup-content {
            background: var(--dark);
            border: 2px solid var(--primary);
            padding: 30px;
            border-radius: 15px;
            max-width: 450px;
            color: var(--primary);
            text-align: center;
            position: relative;
            box-shadow: 0 0 30px var(--primary);
            animation: popupEnter 0.5s ease-out;
        }

        @keyframes popupEnter {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        #welcomePopup .popup-content h2 {
            color: var(--secondary);
            margin-top: 0;
            font-size: 1.8rem;
        }

        #welcomePopup .popup-content .close {
            position: absolute;
            top: 15px;
            right: 20px;
            cursor: pointer;
            font-weight: bold;
            color: var(--accent);
            font-size: 24px;
            transition: transform 0.3s;
        }

        #welcomePopup .popup-content .close:hover {
            transform: rotate(90deg);
        }

        /* فروٹ شوٹر گیم کے لیے اضافی سٹائلز */
        #fruitGame {
            display: none;
        }

        .shoot-area {
            position: relative;
            height: 400px;
            border: 3px dashed var(--primary);
            border-radius: 15px;
            background-color: #222;
            overflow: hidden;
            margin-top: 20px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .fruit {
            position: absolute;
            font-size: 3.5em;
            cursor: pointer;
            user-select: none;
            pointer-events: auto;
            transition: transform 0.1s;
            z-index: 10;
        }

        .fruit:hover {
            transform: scale(1.1);
        }

        #fruitTargetDisplay {
            font-size: 1.5em;
            margin: 15px 0;
            color: var(--light);
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            display: inline-block;
        }

        #fruitScoreDisplay {
            margin-top: 15px;
            font-size: 1.3em;
            font-weight: bold;
        }

        #fruitCountdown {
            font-size: 1.4em;
            margin-top: 15px;
            color: var(--primary);
            font-weight: bold;
        }

        /* Tic Tac Toe Styles */
        #tictactoeGame {
            display: none;
        }

        .tic-tac-toe-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            width: 320px;
            height: 320px;
            margin: 25px auto;
            background-color: rgba(255, 215, 0, 0.1);
            padding: 15px;
            border-radius: 15px;
        }

        .tic-tac-toe-cell {
            background-color: #222;
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--primary);
        }

        .tic-tac-toe-cell:hover {
            background-color: #333;
            transform: scale(1.05);
        }

        .tic-tac-toe-cell.x {
            color: var(--secondary);
            text-shadow: 0 0 10px var(--secondary);
        }

        .tic-tac-toe-cell.o {
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent);
        }

        #tictactoeResult {
            margin-top: 20px;
            font-size: 1.3rem;
            color: var(--light);
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }

        #tictactoeCountdown {
            font-size: 1.4rem;
            color: var(--primary);
            font-weight: bold;
        }

        /* Find Ace Game Styles */
        #findAceGame {
            display: none;
        }

        #findAceCountdown {
            font-size: 1.5rem;
            margin: 15px 0;
            color: var(--primary);
            font-weight: bold;
        }

        #findAceResult {
            margin-top: 20px;
            font-size: 1.3rem;
            color: var(--light);
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }

        /* Archery Game Styles */
        #archeryGame {
            display: none;
        }

        .archery-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .archery-canvas-container {
            position: relative;
            width: 360px;
            height: 360px;
            max-width: 100%;
            margin: 0 auto;
        }

        #archeryCanvas {
            background: transparent;
            border-radius: 12px;
            display: block;
            max-width: 100%;
            height: auto;
            border: 2px solid var(--primary);
        }

        .archery-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 520px;
        }

        .archery-bets {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .archery-score-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .archery-score-box {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: linear-gradient(145deg, #222, #111);
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: var(--primary);
        }

        #archeryStatus {
            font-size: 1.1rem;
            color: var(--light);
            text-align: center;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }

        /* Auth Modal Styles */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .auth-content {
            background-color: var(--dark);
            border: 2px solid var(--primary);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            color: var(--light);
            box-shadow: 0 0 30px var(--primary);
            animation: modalFadeIn 0.4s ease-out;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--primary);
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: bold;
            transition: all 0.3s;
        }

        .auth-tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
        }

        .auth-tab:hover {
            background-color: rgba(255, 215, 0, 0.1);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 18px;
            border-radius: 8px;
            border: 1px solid #444;
            background-color: #222;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .auth-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px var(--primary);
        }

        .auth-form button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(145deg, var(--primary), #e6c200);
            color: var(--dark);
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }

        .auth-form button:hover {
            background: linear-gradient(145deg, #ffdf00, var(--primary));
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .auth-form button:disabled {
            background: #444;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .forgot-password {
            text-align: right;
            margin-top: -15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: var(--secondary);
            cursor: pointer;
            transition: color 0.3s;
        }

        .forgot-password:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        /* Balance and User Info Styles */
        .user-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .balance-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 12px 20px;
            border-radius: 30px;
            border: 1px solid var(--primary);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        #balanceAmount {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .refresh-balance {
            cursor: pointer;
            color: var(--primary);
            font-size: 1.3rem;
            transition: transform 0.3s;
        }

        .refresh-balance:hover {
            transform: rotate(180deg);
            color: var(--secondary);
        }

        #userDisplay {
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 30px;
            border: 1px solid var(--secondary);
            box-shadow: 0 0 15px rgba(30, 144, 255, 0.2);
            gap: 10px;
        }

        #usernameDisplay {
            font-weight: bold;
            color: var(--secondary);
            font-size: 0.84rem; /* 40% smaller */
        }

        #phoneDisplay {
            font-weight: bold;
            color: var(--primary);
            font-size: 0.84rem; /* 40% smaller */
        }

        .country-flag {
            width: 24px;
            height: 16px;
            border-radius: 2px;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }

        .verified-badge {
            color: var(--secondary);
            margin-left: 5px;
            font-size: 0.84rem; /* 40% smaller */
        }

        /* Deposit/Withdraw Styles */
        #depositSection, #withdrawSection, #moreSection, #vipSection {
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
            background-color: #222;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px var(--primary);
        }

        .submit-btn {
            background: linear-gradient(145deg, var(--primary), #e6c200);
            color: var(--dark);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            font-size: 1.1rem;
            transition: all 0.3s;
            display: inline-block;
        }

        .submit-btn:hover {
            background: linear-gradient(145deg, #ffdf00, var(--primary));
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .transaction-history {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .transaction-item {
            background-color: rgba(30, 30, 30, 0.8);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            transition: transform 0.3s;
        }

        .transaction-item:hover {
            transform: translateX(5px);
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .transaction-approved {
            color: lime;
        }

        .transaction-pending {
            color: var(--primary);
        }

        .transaction-rejected {
            color: var(--accent);
        }

        /* VIP Section Styles */
        .referral-code {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 15px 0;
            word-break: break-all;
            border: 1px solid var(--primary);
            font-size: 1.2rem;
            color: var(--primary);
            position: relative;
        }

        .referral-code-copy {
            position: absolute;
            right: 10px;
            top: 10px;
            color: var(--secondary);
            cursor: pointer;
            font-size: 1rem;
        }

        .referral-stats {
            display: flex;
            justify-content: space-around;
            margin: 25px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-box {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--primary);
            min-width: 120px;
            flex: 1;
            transition: transform 0.3s;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
        }

        .stat-label {
            color: var(--light);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* Announcement Bar */
        .announcement-bar {
            position: relative;
            background: linear-gradient(90deg, transparent, rgba(30, 144, 255, 0.2), transparent);
            color: var(--light);
            padding: 12px 0;
            overflow: hidden;
            margin: 0 auto;
            width: 100%;
            border-top: 1px solid var(--secondary);
            border-bottom: 1px solid var(--secondary);
        }

        .announcement-content {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%;
            animation: scroll 20s linear infinite;
            font-size: 1.1rem;
            text-shadow: 0 0 5px var(--secondary);
            font-weight: bold;
        }

        .announcement-content span {
            color: var(--secondary);
            font-weight: bold;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-left: 4px solid var(--primary);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .toast.show {
            opacity: 1;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }

            .game-options {
                grid-template-columns: 1fr;
            }

            .game-options .gold-box {
                width: 100%;
                height: 140px;
                font-size: 1.2rem;
            }

            .tic-tac-toe-board {
                width: 280px;
                height: 280px;
            }

            .archery-canvas-container {
                width: 100%;
                height: auto;
            }

            .nav a {
                padding: 6px 10px;
                font-size: 0.9rem;
            }

            .section {
                padding: 20px;
            }

            .user-info {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }

            .game-options .gold-box {
                width: 100%;
                height: 120px;
                font-size: 1rem;
            }

            .game-options .gold-box i {
                font-size: 2rem;
            }

            .tic-tac-toe-board {
                width: 240px;
                height: 240px;
            }

            .card {
                width: 70px;
                height: 90px;
                font-size: 1.8rem;
            }
        }

        /* Terms and Conditions Modal */
        .terms-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .terms-content {
            background-color: var(--dark);
            border: 2px solid var(--primary);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: var(--light);
            text-align: left;
            position: relative;
            box-shadow: 0 0 30px var(--primary);
        }

        .terms-content h2 {
            color: var(--secondary);
            text-align: center;
        }

        .terms-content p {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .terms-content ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .terms-content li {
            margin-bottom: 8px;
        }

        .terms-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        /* Side Menu */
        .side-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background-color: var(--dark);
            border-left: 2px solid var(--primary);
            z-index: 1000;
            transition: right 0.3s;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }

        .side-menu.open {
            right: 0;
        }

        .side-menu-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: var(--accent);
        }

        .side-menu-item {
            padding: 15px;
            margin: 10px 0;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            border-left: 3px solid var(--primary);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
        }

        .side-menu-item:hover {
            background-color: rgba(255, 215, 0, 0.1);
            transform: translateX(5px);
        }

        /* Watch and Earn Section */
        #watchEarnSection {
            display: none;
        }

        .watch-earn-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            display: none;
        }

        .ad-container {
            width: 280px;
            height: 180px;
            background-color: #222;
            border: 2px solid var(--primary);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ad-container:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--primary);
        }

        .ad-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ad-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            color: var(--light);
            font-size: 0.9rem;
        }

        .ad-progress {
            height: 5px;
            background-color: var(--secondary);
            width: 0%;
            transition: width 0.3s;
        }

        .ad-watched {
            border-color: var(--secondary);
        }

        .ad-watched .ad-overlay {
            background-color: rgba(0, 128, 0, 0.7);
        }

        /* Game History Section */
        #gameHistorySection {
            display: none;
        }

        .game-history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .game-history-table th,
        .game-history-table td {
            padding: 12px;
            border: 1px solid var(--primary);
            text-align: center;
        }

        .game-history-table th {
            background-color: rgba(255, 215, 0, 0.1);
        }

        .game-history-table tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.3);
        }

        /* Admin Panel Styles */
        .admin-section {
            display: none;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .admin-card {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--primary);
            text-align: left;
        }

        .admin-card h3 {
            color: var(--secondary);
            margin-top: 0;
            border-bottom: 1px solid var(--primary);
            padding-bottom: 10px;
        }

        .admin-form input,
        .admin-form select,
        .admin-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #222;
            color: var(--light);
        }

        .admin-form button {
            background: linear-gradient(145deg, var(--primary), #e6c200);
            color: var(--dark);
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .user-search-results {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid var(--primary);
            border-radius: 5px;
            padding: 10px;
        }

        .user-result {
            padding: 10px;
            border-bottom: 1px solid #333;
            cursor: pointer;
        }

        .user-result:hover {
            background-color: rgba(255, 215, 0, 0.1);
        }

        /* Message Center */
        .message-center {
            margin-top: 30px;
        }

        .message-item {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
            text-align: left;
        }

        .message-date {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        /* VIP Badges */
        .vip-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .vip-1 {
            background-color: #cd7f32; /* Bronze */
            color: #fff;
        }

        .vip-2 {
            background-color: #c0c0c0; /* Silver */
            color: #000;
        }

        .vip-3 {
            background-color: #ffd700; /* Gold */
            color: #000;
        }

        .vip-4 {
            background-color: #e5e4e2; /* Platinum */
            color: #000;
        }

        .vip-5 {
            background-color: #b9f2ff; /* Diamond */
            color: #000;
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div id="toast" class="toast"></div>

    <!-- Terms and Conditions Modal -->
    <div id="termsModal" class="terms-modal">
        <div class="terms-content">
            <h2>Terms and Conditions</h2>
            <p>By using USCash, you agree to the following terms and conditions:</p>
            <ul>
                <li>You must be at least 18 years old to use this platform.</li>
                <li>All games are for entertainment purposes only.</li>
                <li>Since terms & conditions or gambling promotions are not added, users are informed that the platform is not responsible for abandoned accounts.</li>
                <li>If a user leaves their account inactive for more than 15 days, the platform reserves the right not to return the deposited money.</li>
                <li>All deposit and withdrawal requests are subject to verification.</li>
                <li>The platform reserves the right to suspend or terminate accounts that violate these terms.</li>
                <li>Users are solely responsible for maintaining the confidentiality of their account credentials.</li>
            </ul>
            <div class="terms-buttons">
                <button class="gold-box" onclick="acceptTerms()">I Accept</button>
                <button class="gold-box" style="background: var(--accent);" onclick="rejectTerms()">I Decline</button>
            </div>
        </div>
    </div>

    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <div class="side-menu-close" onclick="toggleSideMenu()">×</div>
        <h3>Menu</h3>
        <div class="side-menu-item" onclick="showSection('gameHistory')">
            <i class="fas fa-history"></i> Game History
        </div>
        <div class="side-menu-item" onclick="showSection('updates')">
            <i class="fas fa-bell"></i> Updates & Announcements
        </div>
        <div class="side-menu-item" onclick="contactSupport()">
            <i class="fas fa-headset"></i> Customer Service
        </div>
        <div class="side-menu-item" onclick="shareWhatsapp()">
            <i class="fab fa-whatsapp"></i> WhatsApp Channel
        </div>
        <div class="side-menu-item" onclick="showSection('terms')">
            <i class="fas fa-file-contract"></i> Terms & Conditions
        </div>
    </div>

    <!-- Announcement Bar -->
    <div class="announcement-bar">
        <div class="announcement-content">
            <span>📢 For deposits contact VIP users (verified with blue tick) or WhatsApp us at USCash WhatsApp channel</span>
        </div>
    </div>

    <div id="welcomePopup">
        <div class="popup-content">
            <div class="close" onclick="document.getElementById('welcomePopup').style.display='none'">×</div>
            <h2>Welcome to USCash! 🎮</h2>
            <p>Experience the thrill of gaming with real rewards. We're constantly improving our platform to bring you the best gaming experience.</p>
            <p>New games and features are coming soon - stay tuned!</p>
            <button class="gold-box" onclick="document.getElementById('welcomePopup').style.display='none'" style="margin-top: 20px;">
                Let's Play!
            </button>
        </div>
    </div>

    <!-- Auth Modals -->
    <div id="authModal" class="auth-modal">
        <div class="auth-content">
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">Login</div>
                <div class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</div>
            </div>

            <div id="loginForm" class="auth-form active">
                <input type="email" id="loginEmail" placeholder="Email" required />
                <input type="password" id="loginPassword" placeholder="Password" required />
                <div class="forgot-password" onclick="showForgotPassword()">Forgot Password?</div>
                <button onclick="loginUser()">Login</button>
            </div>

            <div id="signupForm" class="auth-form">
                <input type="text" id="signupName" placeholder="Full Name" required />
                <input type="tel" id="signupPhone" placeholder="Phone Number" required />
                <input type="email" id="signupEmail" placeholder="Email" required />
                <input type="password" id="signupPassword" placeholder="Password (6+ characters)" required minlength="6" />
                <input type="password" id="confirmPassword" placeholder="Confirm Password" required />
                <input type="text" id="referralCode" placeholder="Referral Code (Optional)" />
                <button onclick="signupUser()">Sign Up</button>
            </div>

            <div id="forgotPasswordForm" class="auth-form">
                <input type="email" id="forgotEmail" placeholder="Enter your email" required />
                <button onclick="resetPassword()">Reset Password</button>
                <button onclick="backToLogin()" style="margin-top: 10px; background-color: #444;">Back to Login</button>
            </div>
        </div>
    </div>

    <h1>USCash 🎮</h1>

    <div class="user-info">
        <div id="userDisplay" style="display:none;">
            <img src="https://flagcdn.com/w20/pk.png" class="country-flag" alt="Country Flag" id="countryFlag">
            <span id="usernameDisplay"></span>
            <span id="phoneDisplay"></span>
            <i class="fas fa-check-circle verified-badge" id="verifiedBadge" style="display:none;"></i>
        </div>
        <div class="balance-container">
            <span>Balance: Rs. <span id="balanceAmount">0</span></span>
            <i class="fas fa-sync-alt refresh-balance" onclick="refreshBalance()"></i>
        </div>
        <div id="authButtons">
            <button class="gold-box" onclick="showAuthModal('login')">Login</button>
            <button class="gold-box" onclick="showAuthModal('signup')">Sign Up</button>
        </div>
        <div id="logoutButton" style="display:none;">
            <button class="gold-box" onclick="logoutUser()">Logout</button>
        </div>
        <div class="gold-box" onclick="toggleSideMenu()" style="display: none;" id="menuButton">
            <i class="fas fa-bars"></i> Menu
        </div>
    </div>

    <div class="nav">
        <a href="#" onclick="showSection('home')"><i class="fas fa-home"></i> Home</a>
        <a href="#" onclick="showSection('deposit')"><i class="fas fa-money-bill-wave"></i> Deposit</a>
        <a href="#" onclick="showSection('withdraw')"><i class="fas fa-wallet"></i> Withdraw</a>
        <a href="#" onclick="showSection('watchEarn')"><i class="fas fa-eye"></i> Watch & Earn</a>
        <a href="#" onclick="showSection('vip')"><i class="fas fa-crown"></i> VIP</a>
        <a href="#" id="adminTab" style="display:none;" onclick="showSection('admin')"><i class="fas fa-cog"></i> Admin</a>
    </div>

    <!-- Home Section -->
    <div class="section" id="homeSection">
        <h2>Select Game</h2>
        <div class="game-options">
            <div class="gold-box scratch-thumbnail" onclick="startCardGame()">
                <i class="fas fa-scroll"></i>
                Scratch Match
            </div>
            <div class="gold-box fruit-thumbnail" onclick="startFruitGame()">
                <i class="fas fa-apple-alt"></i>
                Fruit Shooting
            </div>
            <div class="gold-box tictactoe-thumbnail" onclick="startTicTacToeGame()">
                <i class="fas fa-times"></i>
                Tic Tac Toe
            </div>
            <div class="gold-box findace-thumbnail" onclick="startFindAceGame()">
                <i class="fas fa-search"></i>
                Find Ace
            </div>
            <div class="gold-box archery-thumbnail" onclick="startArcheryGame()">
                <i class="fas fa-bullseye"></i>
                Archery Challenge
            </div>
        </div>
    </div>

    <!-- Watch & Earn Section -->
    <div class="section" id="watchEarnSection">
        <h2><i class="fas fa-eye"></i> Watch & Earn</h2>
        <p style="color: var(--secondary);">Pay Rs. 150 to unlock this feature and watch ads to earn money!</p>

        <div id="watchEarnStatus">
            <!-- Will be populated by JavaScript -->
        </div>

        <div class="watch-earn-container" id="watchEarnAds">
            <!-- Will be populated by JavaScript -->
        </div>

        <button class="submit-btn" onclick="unlockWatchEarn()" id="unlockWatchEarnBtn">
            Unlock for Rs. 150
        </button>
    </div>

    <!-- Game History Section -->
    <div class="section" id="gameHistorySection">
        <h2><i class="fas fa-history"></i> Game History</h2>
        <div class="transaction-history">
            <table class="game-history-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Game</th>
                        <th>Bet Amount</th>
                        <th>Result</th>
                        <th>Amount Won/Lost</th>
                    </tr>
                </thead>
                <tbody id="gameHistoryBody">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Updates Section -->
    <div class="section" id="updatesSection">
        <h2><i class="fas fa-bell"></i> Updates & Announcements</h2>
        <div class="message-center" id="announcementsContainer">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Admin Section -->
    <div class="section admin-section" id="adminSection">
        <h2><i class="fas fa-cog"></i> Admin Panel</h2>
        <div class="admin-controls">
            <div class="admin-card">
                <h3>User Management</h3>
                <div class="admin-form">
                    <input type="text" id="searchUser" placeholder="Search by name or email">
                    <button onclick="searchUsers()">Search</button>
                </div>
                <div class="user-search-results" id="userSearchResults">
                    <!-- Results will appear here -->
                </div>
            </div>

            <div class="admin-card">
                <h3>Balance Adjustment</h3>
                <div class="admin-form">
                    <input type="text" id="adjustUserEmail" placeholder="User Email">
                    <input type="number" id="adjustAmount" placeholder="Amount">
                    <select id="adjustType">
                        <option value="add">Add Balance</option>
                        <option value="subtract">Subtract Balance</option>
                        <option value="set">Set Balance</option>
                    </select>
                    <button onclick="adjustUserBalance()">Apply</button>
                </div>
            </div>

            <div class="admin-card">
                <h3>Deposit/Withdrawal Requests</h3>
                <div id="adminRequests">
                    <!-- Requests will appear here -->
                </div>
            </div>

            <div class="admin-card">
                <h3>Send Announcement</h3>
                <div class="admin-form">
                    <input type="text" id="announcementTitle" placeholder="Title">
                    <textarea id="announcementContent" placeholder="Message content" rows="4"></textarea>
                    <button onclick="sendAnnouncement()">Send to All Users</button>
                </div>
            </div>

            <div class="admin-card">
                <h3>Send Private Message</h3>
                <div class="admin-form">
                    <input type="text" id="pmUserEmail" placeholder="User Email">
                    <input type="text" id="pmTitle" placeholder="Title">
                    <textarea id="pmContent" placeholder="Message content" rows="4"></textarea>
                    <button onclick="sendPrivateMessage()">Send Message</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms Section -->
    <div class="section" id="termsSection">
        <h2><i class="fas fa-file-contract"></i> Terms & Conditions</h2>
        <div class="terms-content">
            <p>By using USCash, you agree to the following terms and conditions:</p>
            <ul>
                <li>You must be at least 18 years old to use this platform.</li>
                <li>All games are for entertainment purposes only.</li>
                <li>Since terms & conditions or gambling promotions are not added, users are informed that the platform is not responsible for abandoned accounts.</li>
                <li>If a user leaves their account inactive for more than 15 days, the platform reserves the right not to return the deposited money.</li>
                <li>All deposit and withdrawal requests are subject to verification.</li>
                <li>The platform reserves the right to suspend or terminate accounts that violate these terms.</li>
                <li>Users are solely responsible for maintaining the confidentiality of their account credentials.</li>
            </ul>
        </div>
    </div>

    
    <!-- Deposit Section -->
    <div class="section" id="depositSection">
        <h2><i class="fas fa-money-bill-wave"></i> Deposit</h2>
        <form id="depositForm">
            <div class="form-group">
                <label for="depositAmount">Amount (Rs.)</label>
                <input type="number" id="depositAmount" placeholder="Enter deposit amount" required>
            </div>
            <div class="form-group">
                <label for="depositNumber">JazzCash Number</label>
                <input type="text" id="depositNumber" placeholder="03XXXXXXXXX" required>
            </div>
            <div class="form-group">
                <label for="depositTxnId">Transaction ID</label>
                <input type="text" id="depositTxnId" placeholder="Enter JazzCash Transaction ID" required>
            </div>
            <button type="button" class="submit-btn" onclick="submitDeposit()">Submit Deposit</button>
        </form>
        <div class="transaction-history" id="depositHistory">
            <h3>Deposit History</h3>
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- Withdraw Section -->
    <div class="section" id="withdrawSection">
        <h2><i class="fas fa-wallet"></i> Withdraw</h2>
        <form id="withdrawForm">
            <div class="form-group">
                <label for="withdrawAmount">Amount (Rs.)</label>
                <input type="number" id="withdrawAmount" placeholder="Enter withdraw amount" required>
            </div>
            <div class="form-group">
                <label for="withdrawNumber">JazzCash Number</label>
                <input type="text" id="withdrawNumber" placeholder="03XXXXXXXXX" required>
            </div>
            <button type="button" class="submit-btn" onclick="submitWithdraw()">Submit Withdraw</button>
        </form>
        <div class="transaction-history" id="withdrawHistory">
            <h3>Withdraw History</h3>
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- VIP Section -->
    <div class="section" id="vipSection">
        <h2><i class="fas fa-crown"></i> VIP Zone</h2>
        <div class="referral-code">
            Referral Code: <span id="userReferralCode">N/A</span>
            <i class="fas fa-copy referral-code-copy" onclick="copyReferralCode()" title="Copy"></i>
        </div>
        <div style="margin: 10px 0;">
            <button class="submit-btn" onclick="shareReferralCode()">Share Code</button>
        </div>
        <div class="referral-stats">
            <div class="stat-box">
                <div class="stat-label">Referrals</div>
                <div class="stat-value" id="referralCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Referral Earnings</div>
                <div class="stat-value" id="referralEarnings">Rs. 0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">VIP Status</div>
                <div class="stat-value" id="vipStatus">Basic</div>
            </div>
        </div>
    </div>


    <!-- Firebase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBM7DY6i11IPk8DAvVA6tsgmz7Epi5bJh0",
            authDomain: "pakcashplay.firebaseapp.com",
            projectId: "pakcashplay",
            storageBucket: "pakcashplay.appspot.com",
            messagingSenderId: "551195851632",
            appId: "1:551195851632:web:4dcf6a8fb36d82e6a6adb5"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let balance = 0;
        let currentUser = null;
        let termsAccepted = false;

        // Check if user has accepted terms on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Show terms modal if not accepted
            if (!localStorage.getItem('termsAccepted')) {
                document.getElementById('termsModal').style.display = 'flex';
            } else {
                termsAccepted = true;
                checkAuthState();
            }

            // Check if user is admin
            auth.onAuthStateChanged(user => {
                if (user) {
                    db.collection('users').doc(user.uid).get().then(doc => {
                        if (doc.exists) {
                            const userData = doc.data();
                            if (userData.email === 'cptanil1995@gmail.com' || 
                                userData.email === 'auk5562@gmail.com' ||
                                userData.email === 'kafe2999@gmail.com') {
                                // Show admin tab
                                document.getElementById('adminTab').style.display = 'block';
                            }
                        }
                    });
                }
            });
        });

        function acceptTerms() {
            localStorage.setItem('termsAccepted', 'true');
            termsAccepted = true;
            document.getElementById('termsModal').style.display = 'none';
            checkAuthState();
        }

        function rejectTerms() {
            alert('You must accept the terms and conditions to use USCash.');
            window.location.href = 'about:blank';
        }

        // Toggle side menu
        function toggleSideMenu() {
            const sideMenu = document.getElementById('sideMenu');
            sideMenu.classList.toggle('open');
        }

        // Contact support
        function contactSupport() {
            window.location.href = 'mailto:uscash4@gmail.com?subject=USCash Support';
        }

        // Share WhatsApp
        function shareWhatsapp() {
            window.open('https://wa.me/yourwhatsappnumber', '_blank');
        }

        // Show section
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => {
                sec.style.display = 'none';
            });

            // Show selected section
            document.getElementById(section + 'Section').style.display = 'block';

            // Load section data if needed
            if (section === 'gameHistory') {
                loadGameHistory();
            } else if (section === 'updates') {
                loadAnnouncements();
            } else if (section === 'admin') {
                loadAdminData();
            } else if (section === 'watchEarn') {
                loadWatchEarnSection();
            } else if (section === 'deposit') {
                loadDepositHistory();
            } else if (section === 'withdraw') {
                loadWithdrawHistory();
            } else if (section === 'vip') {
                loadVipData();
            }
        }

        // Authentication functions
        function checkAuthState() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    document.getElementById('authButtons').style.display = 'none';
                    document.getElementById('logoutButton').style.display = 'block';
                    document.getElementById('userDisplay').style.display = 'flex';
                    document.getElementById('menuButton').style.display = 'block';
                    loadUserData();
                } else {
                    currentUser = null;
                    document.getElementById('authButtons').style.display = 'flex';
                    document.getElementById('logoutButton').style.display = 'none';
                    document.getElementById('userDisplay').style.display = 'none';
                    document.getElementById('menuButton').style.display = 'none';
                    showSection('home');
                    // Reset balance display when logged out
                    document.getElementById('balanceAmount').textContent = '0';
                }
            });
        }

        function showAuthModal(tab) {
            document.getElementById('authModal').style.display = 'flex';
            switchAuthTab(tab);
        }

        function hideAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }

        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));

            if (tab === 'login') {
                document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else if (tab === 'signup') {
                document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
        }

        function showForgotPassword() {
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.getElementById('forgotPasswordForm').classList.add('active');
        }

        function backToLogin() {
            switchAuthTab('login');
        }

        function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showToast('Please enter both email and password', 'error');
                return;
            }

            // Show loading state
            const loginBtn = document.querySelector('#loginForm button');
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';

            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    hideAuthModal();
                    showToast('Login successful! Welcome back.', 'success');

                    // Update last login time
                    if (currentUser) {
                        db.collection('users').doc(currentUser.uid).update({
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                })
                .catch(error => {
                    let errorMessage = 'Login failed. ';
                    switch(error.code) {
                        case 'auth/user-not-found':
                            errorMessage += 'No account found with this email.';
                            break;
                        case 'auth/wrong-password':
                            errorMessage += 'Incorrect password.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage += 'The email address is invalid.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    showToast(errorMessage, 'error');
                })
                .finally(() => {
                    // Reset button state
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'Login';
                });
        }

        function signupUser() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const name = document.getElementById('signupName').value;
            const phone = document.getElementById('signupPhone').value;
            const referralCode = document.getElementById('referralCode').value;

            // Validate all required fields
            if (!email || !password || !name || !phone || !confirmPassword) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            // Validate password match
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }

            // Validate email format
            if (!validateEmail(email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }

            // Validate password length
            if (password.length < 6) {
                showToast('Password should be at least 6 characters', 'error');
                return;
            }

            // Show loading state
            const signupBtn = document.querySelector('#signupForm button');
            signupBtn.disabled = true;
            signupBtn.textContent = 'Creating account...';

            // Create user with Firebase Auth
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Create user document in Firestore
                    return db.collection('users').doc(userCredential.user.uid).set({
                        name: name,
                        phone: phone,
                        email: email,
                        balance: 0, // No welcome bonus
                        referralCode: generateReferralCode(),
                        referredBy: referralCode || null,
                        referralCount: 0,
                        referralEarnings: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                        depositCount: 0
                    });
                })
                .then(() => {
                    // If referral code was provided, update the referrer's stats
                    if (referralCode) {
                        return db.collection('users').where('referralCode', '==', referralCode).get()
                            .then(querySnapshot => {
                                if (!querySnapshot.empty) {
                                    const referrerId = querySnapshot.docs[0].id;
                                    return db.collection('users').doc(referrerId).update({
                                        referralCount: firebase.firestore.FieldValue.increment(1),
                                        referralEarnings: firebase.firestore.FieldValue.increment(50)
                                    });
                                }
                            });
                    }
                })
                .then(() => {
                    // Success - hide modal and show welcome message
                    hideAuthModal();
                    showToast('Signup successful! Welcome to USCash.', 'success');

                    // Reset form
                    document.getElementById('signupForm').reset();
                })
                .catch(error => {
                    // Handle specific errors
                    let errorMessage = 'Signup failed. ';
                    switch(error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage += 'This email is already registered.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage += 'The email address is invalid.';
                            break;
                        case 'auth/weak-password':
                            errorMessage += 'The password is too weak.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    showToast(errorMessage, 'error');
                })
                .finally(() => {
                    // Reset button state
                    signupBtn.disabled = false;
                    signupBtn.textContent = 'Sign Up';
                });
        }

        // Helper function to validate email
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function resetPassword() {
            const email = document.getElementById('forgotEmail').value;

            if (!email) {
                showToast('Please enter your email', 'error');
                return;
            }

            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showToast('Password reset email sent! Please check your inbox.', 'success');
                    backToLogin();
                })
                .catch(error => {
                    showToast('Error sending reset email: ' + error.message, 'error');
                });
        }

        function logoutUser() {
            auth.signOut().then(() => {
                showSection('home');
                showToast('Logged out successfully', 'success');
                // Reset balance to zero when logging out
                balance = 0;
                document.getElementById('balanceAmount').textContent = '0';
            });
        }

        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function copyReferralCode() {
            const referralCode = document.getElementById('userReferralCode').textContent;
            navigator.clipboard.writeText(referralCode)
                .then(() => {
                    showToast('Referral code copied to clipboard!', 'success');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                });
        }

        function shareReferralCode() {
            const referralCode = document.getElementById('userReferralCode').textContent;
            const shareText = `Join USCash and use my referral code: ${referralCode} to get bonus rewards!`;

            if (navigator.share) {
                navigator.share({
                    title: 'USCash Referral',
                    text: shareText,
                    url: window.location.href
                })
                .catch(err => {
                    console.error('Error sharing:', err);
                    fallbackShare(referralCode, shareText);
                });
            } else {
                fallbackShare(referralCode, shareText);
            }
        }

        function fallbackShare(referralCode, shareText) {
            prompt('Copy your referral code to share:', shareText);
        }

        // User data functions
        function loadUserData() {
            if (!currentUser) return;

            db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    balance = userData.balance || 0;
                    updateBalanceDisplay();

                    // Update user display
                    document.getElementById('usernameDisplay').textContent = userData.name || userData.email || 'User';
                    document.getElementById('phoneDisplay').textContent = userData.phone || '';

                    // Check if user is verified (cptanil1995@gmail.com or auk5562@gmail.com)
                    if (userData.email === 'cptanil1995@gmail.com' || userData.email === 'auk5562@gmail.com') {
                        document.getElementById('verifiedBadge').style.display = 'inline-block';
                    }

                    // Update VIP section if visible
                    loadVipData();
                }
            });

            // Load transaction history
            loadTransactionHistory();
        }

        function loadVipData() {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.uid).get().then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    document.getElementById('userReferralCode').textContent = userData.referralCode || 'N/A';
                    document.getElementById('referralCount').textContent = userData.referralCount || 0;
                    document.getElementById('referralEarnings').textContent = 'Rs. ' + (userData.referralEarnings || 0);

                    // Show copy button if referral code exists
                    if (userData.referralCode) {
                        document.querySelector('.referral-code-copy').style.display = 'block';
                    }

                    // Set VIP status
                    const earnings = userData.referralEarnings || 0;
                    let vipStatus = 'Basic';
                    if (earnings >= 5000) vipStatus = 'Gold';
                    else if (earnings >= 1000) vipStatus = 'Silver';
                    document.getElementById('vipStatus').textContent = vipStatus;
                }
            });
        }

        function refreshBalance() {
            if (currentUser) {
                db.collection('users').doc(currentUser.uid).get()
                    .then(doc => {
                        if (doc.exists) {
                            balance = doc.data().balance || 0;
                            updateBalanceDisplay();
                            showToast('Balance refreshed!', 'success');
                        }
                    });
            }
        }

        function refreshAllData() {
            refreshBalance();
            loadTransactionHistory();
            showToast('All data refreshed!', 'success');
        }

        function updateBalanceDisplay() {
            document.getElementById('balanceAmount').textContent = Math.floor(balance);
        }

        // Toast notification function
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast';
            toast.classList.add('show');
            toast.style.borderLeftColor = type === 'success' ? 'lime' : type === 'error' ? 'red' : 'var(--primary)';
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Deposit and Withdrawal functions
        function submitDeposit() {
            if (!currentUser) {
                showToast('Please login to deposit', 'error');
                return;
            }

            const amount = parseFloat(document.getElementById('depositAmount').value);
            const number = document.getElementById('depositNumber').value;
            const txnId = document.getElementById('depositTxnId').value;

            if (!amount || amount <= 0 || !number || !txnId) {
                showToast('Please fill all fields with valid values', 'error');
                return;
            }

            // Show loading state
            const depositBtn = document.querySelector('#depositForm .submit-btn');
            depositBtn.disabled = true;
            depositBtn.textContent = 'Processing...';

            // Create deposit request
            db.collection('deposit_requests').add({
                userId: currentUser.uid,
                amount: amount,
                method: 'JazzCash',
                accountNumber: number,
                transactionId: txnId,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                showToast('Deposit request submitted successfully! It will be processed soon.', 'success');
                document.getElementById('depositForm').reset();
                loadDepositHistory();
            })
            .catch(error => {
                showToast('Error submitting deposit request: ' + error.message, 'error');
            })
            .finally(() => {
                depositBtn.disabled = false;
                depositBtn.textContent = 'Submit Deposit';
            });
        }

        function submitWithdraw() {
            if (!currentUser) {
                showToast('Please login to withdraw', 'error');
                return;
            }

            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const number = document.getElementById('withdrawNumber').value;

            if (!amount || amount <= 0 || !number) {
                showToast('Please fill all fields with valid values', 'error');
                return;
            }

            if (amount > balance) {
                showToast('Insufficient balance for withdrawal', 'error');
                return;
            }

            // Show loading state
            const withdrawBtn = document.querySelector('#withdrawForm .submit-btn');
            withdrawBtn.disabled = true;
            withdrawBtn.textContent = 'Processing...';

            // Create withdrawal request
            db.collection('withdraw_requests').add({
                userId: currentUser.uid,
                amount: amount,
                method: 'JazzCash',
                accountNumber: number,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                showToast('Withdrawal request submitted successfully! It will be processed soon.', 'success');
                document.getElementById('withdrawForm').reset();
                loadWithdrawHistory();
            })
            .catch(error => {
                showToast('Error submitting withdrawal request: ' + error.message, 'error');
            })
            .finally(() => {
                withdrawBtn.disabled = false;
                withdrawBtn.textContent = 'Submit Withdraw';
            });
        }

        function loadDepositHistory() {
            if (!currentUser) return;

            db.collection('deposit_requests')
                .where('userId', '==', currentUser.uid)
                .orderBy('createdAt', 'desc')
                .get()
                .then(querySnapshot => {
                    const container = document.getElementById('depositHistory');
                    container.innerHTML = '<h3>Deposit History</h3>';

                    if (querySnapshot.empty) {
                        container.innerHTML += '<p>No deposit history found</p>';
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'transaction-item';
                        item.innerHTML = `
                            <div><strong>Amount:</strong> Rs. ${data.amount}</div>
                            <div><strong>Method:</strong> ${data.method}</div>
                            <div><strong>Account:</strong> ${data.accountNumber}</div>
                            <div><strong>Status:</strong> <span class="transaction-${data.status}">${data.status}</span></div>
                            <div><strong>Date:</strong> ${data.createdAt.toDate().toLocaleString()}</div>
                        `;
                        container.appendChild(item);
                    });
                });
        }

        function loadWithdrawHistory() {
            if (!currentUser) return;

            db.collection('withdraw_requests')
                .where('userId', '==', currentUser.uid)
                .orderBy('createdAt', 'desc')
                .get()
                .then(querySnapshot => {
                    const container = document.getElementById('withdrawHistory');
                    container.innerHTML = '<h3>Withdraw History</h3>';

                    if (querySnapshot.empty) {
                        container.innerHTML += '<p>No withdrawal history found</p>';
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'transaction-item';
                        item.innerHTML = `
                            <div><strong>Amount:</strong> Rs. ${data.amount}</div>
                            <div><strong>Method:</strong> ${data.method}</div>
                            <div><strong>Account:</strong> ${data.accountNumber}</div>
                            <div><strong>Status:</strong> <span class="transaction-${data.status}">${data.status}</span></div>
                            <div><strong>Date:</strong> ${data.createdAt.toDate().toLocaleString()}</div>
                        `;
                        container.appendChild(item);
                    });
                });
        }

        function loadTransactionHistory() {
            loadDepositHistory();
            loadWithdrawHistory();
        }

        // Watch and Earn functionality
        function unlockWatchEarn() {
            if (balance < 150) {
                showToast('Insufficient balance. You need Rs. 150 to unlock Watch & Earn.', 'error');
                return;
            }

            // Deduct 150 RS
            balance -= 150;
            updateUserBalance(balance);
            updateBalanceDisplay();

            // Set unlock status
            db.collection('users').doc(currentUser.uid).update({
                watchEarnUnlocked: true,
                watchEarnUnlockDate: firebase.firestore.FieldValue.serverTimestamp(),
                watchEarnAds: generateAds()
            }).then(() => {
                showToast('Watch & Earn unlocked successfully!', 'success');
                loadWatchEarnSection();
            });
        }

        function generateAds() {
            const ads = [];
            for (let i = 0; i < 10; i++) {
                ads.push({
                    id: i,
                    watched: false,
                    watchDate: null,
                    earned: false
                });
            }
            return ads;
        }

        function loadWatchEarnSection() {
            if (!currentUser) return;

            db.collection('users').doc(currentUser.uid).get().then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    const container = document.getElementById('watchEarnAds');
                    container.innerHTML = '';
                    const statusEl = document.getElementById('watchEarnStatus');
                    const unlockBtn = document.getElementById('unlockWatchEarnBtn');

                    if (userData.watchEarnUnlocked) {
                        unlockBtn.style.display = 'none';
                        const unlockDate = userData.watchEarnUnlockDate.toDate();
                        const expireDate = new Date(unlockDate);
                        expireDate.setDate(expireDate.getDate() + 4);

                        if (new Date() > expireDate) {
                            statusEl.innerHTML = '<p style="color: var(--accent);">Your Watch & Earn period has expired. Deposit again to unlock.</p>';
                            return;
                        }

                        // Calculate days left
                        const daysLeft = Math.ceil((expireDate - new Date()) / (1000 * 60 * 60 * 24));
                        statusEl.innerHTML = `<p>You have ${daysLeft} days left to watch ads and earn money.</p>`;

                        // Display ads
                        userData.watchEarnAds.forEach(ad => {
                            const adEl = document.createElement('div');
                            adEl.className = `ad-container ${ad.watched ? 'ad-watched' : ''}`;
                            adEl.innerHTML = `
                                <div class="ad-progress"></div>
                                <img src="https://via.placeholder.com/300x200?text=Ad+${ad.id+1}" alt="Advertisement">
                                <div class="ad-overlay">
                                    ${ad.watched ? '✓ Watched - Rs. 1.25 earned' : 'Click to watch and earn Rs. 1.25'}
                                </div>
                            `;

                            if (!ad.watched) {
                                adEl.onclick = () => watchAd(ad.id);
                            }

                            container.appendChild(adEl);
                        });
                    } else {
                        unlockBtn.style.display = 'block';
                        statusEl.innerHTML = '<p>Unlock Watch & Earn for Rs. 150 to start earning by watching ads.</p>';
                    }
                }
            });
        }

        function watchAd(adId) {
            // Show ad for 30 seconds
            const adContainer = document.querySelectorAll('.ad-container')[adId];
            const progressBar = adContainer.querySelector('.ad-progress');
            let progress = 0;

            const interval = setInterval(() => {
                progress += 3.33; // 100% in 30 seconds
                progressBar.style.width = `${progress}%`;

                if (progress >= 100) {
                    clearInterval(interval);
                    // Mark as watched
                    db.collection('users').doc(currentUser.uid).get().then(doc => {
                        const userData = doc.data();
                        const ads = userData.watchEarnAds;
                        ads[adId].watched = true;
                        ads[adId].watchDate = firebase.firestore.FieldValue.serverTimestamp();

                        db.collection('users').doc(currentUser.uid).update({
                            watchEarnAds: ads
                        }).then(() => {
                            // Add 1.25 RS to balance
                            balance += 1.25;
                            updateUserBalance(balance);
                            updateBalanceDisplay();
                            showToast('Ad watched successfully! Rs. 1.25 added to your balance.', 'success');
                            loadWatchEarnSection();
                        });
                    });
                }
            }, 1000);
        }

        // Game history
        function loadGameHistory() {
            if (!currentUser) return;

            db.collection('game_history')
                .where('userId', '==', currentUser.uid)
                .orderBy('date', 'desc')
                .limit(50)
                .get()
                .then(querySnapshot => {
                    const tbody = document.getElementById('gameHistoryBody');
                    tbody.innerHTML = '';

                    if (querySnapshot.empty) {
                        tbody.innerHTML = '<tr><td colspan="5">No game history found</td></tr>';
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${data.date.toDate().toLocaleString()}</td>
                            <td>${data.game}</td>
                            <td>Rs. ${data.betAmount}</td>
                            <td>${data.won ? 'Won' : 'Lost'}</td>
                            <td>${data.won ? 'Rs. ' + data.amountWon : 'Rs. -' + data.betAmount}</td>
                        `;
                        tbody.appendChild(row);
                    });
                });
        }

        // Admin functions
        function loadAdminData() {
            if (!currentUser) return;

            // Check if user is admin
            db.collection('users').doc(currentUser.uid).get().then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    if (userData.email === 'cptanil1995@gmail.com' || 
                        userData.email === 'auk5562@gmail.com' ||
                        userData.email === 'kafe2999@gmail.com') {
                        // Load pending requests
                        loadAdminRequests();
                    } else {
                        showToast('Access denied. Admin only.', 'error');
                        showSection('home');
                    }
                }
            });
        }

        function loadAdminRequests() {
            // Load deposit requests
            db.collection('deposit_requests')
                .where('status', '==', 'pending')
                .orderBy('createdAt', 'desc')
                .get()
                .then(querySnapshot => {
                    const requestsContainer = document.getElementById('adminRequests');
                    requestsContainer.innerHTML = '<h3>Pending Requests</h3>';

                    if (querySnapshot.empty) {
                        requestsContainer.innerHTML += '<p>No pending requests</p>';
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const requestEl = document.createElement('div');
                        requestEl.className = 'transaction-item';
                        requestEl.innerHTML = `
                            <div><strong>Type:</strong> Deposit</div>
                            <div><strong>User ID:</strong> ${data.userId}</div>
                            <div><strong>Amount:</strong> Rs. ${data.amount}</div>
                            <div><strong>Method:</strong> ${data.method}</div>
                            <div><strong>Transaction ID:</strong> ${data.transactionId}</div>
                            <div>
                                <button onclick="approveRequest('deposit', '${doc.id}', '${data.userId}', ${data.amount})">Approve</button>
                                <button onclick="rejectRequest('deposit', '${doc.id}')" style="background: var(--accent);">Reject</button>
                            </div>
                        `;
                        requestsContainer.appendChild(requestEl);
                    });
                });

            // Load withdrawal requests
            db.collection('withdraw_requests')
                .where('status', '==', 'pending')
                .orderBy('createdAt', 'desc')
                .get()
                .then(querySnapshot => {
                    const requestsContainer = document.getElementById('adminRequests');

                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const requestEl = document.createElement('div');
                        requestEl.className = 'transaction-item';
                        requestEl.innerHTML = `
                            <div><strong>Type:</strong> Withdrawal</div>
                            <div><strong>User ID:</strong> ${data.userId}</div>
                            <div><strong>Amount:</strong> Rs. ${data.amount}</div>
                            <div><strong>Method:</strong> ${data.method}</div>
                            <div><strong>Account:</strong> ${data.accountNumber} (${data.accountName})</div>
                            <div>
                                <button onclick="approveRequest('withdraw', '${doc.id}', '${data.userId}', ${data.amount})">Approve</button>
                                <button onclick="rejectRequest('withdraw', '${doc.id}')" style="background: var(--accent);">Reject</button>
                            </div>
                        `;
                        requestsContainer.appendChild(requestEl);
                    });
                });
        }

        function searchUsers() {
            const searchTerm = document.getElementById('searchUser').value.toLowerCase();
            const resultsContainer = document.getElementById('userSearchResults');
            resultsContainer.innerHTML = 'Loading...';

            db.collection('users')
                .get()
                .then(querySnapshot => {
                    resultsContainer.innerHTML = '';
                    let found = false;

                    querySnapshot.forEach(doc => {
                        const userData = doc.data();
                        if (userData.name && userData.name.toLowerCase().includes(searchTerm) || 
                            userData.email && userData.email.toLowerCase().includes(searchTerm)) {
                            found = true;
                            const userEl = document.createElement('div');
                            userEl.className = 'user-result';
                            userEl.innerHTML = `
                                <div><strong>${userData.name}</strong> (${userData.email})</div>
                                <div>Phone: ${userData.phone || 'N/A'}</div>
                                <div>Balance: Rs. ${userData.balance || 0}</div>
                                <div>VIP: Level ${getVipLevel(userData.referralCount || 0)}</div>
                            `;
                            userEl.onclick = () => {
                                document.getElementById('adjustUserEmail').value = userData.email;
                                document.getElementById('pmUserEmail').value = userData.email;
                            };
                            resultsContainer.appendChild(userEl);
                        }
                    });

                    if (!found) {
                        resultsContainer.innerHTML = 'No users found';
                    }
                });
        }

        function adjustUserBalance() {
            const email = document.getElementById('adjustUserEmail').value;
            const amount = parseFloat(document.getElementById('adjustAmount').value);
            const type = document.getElementById('adjustType').value;

            if (!email || isNaN(amount)) {
                showToast('Please enter valid email and amount', 'error');
                return;
            }

            // Find user by email
            db.collection('users')
                .where('email', '==', email)
                .get()
                .then(querySnapshot => {
                    if (querySnapshot.empty) {
                        showToast('User not found', 'error');
                        return;
                    }

                    const userDoc = querySnapshot.docs[0];
                    const userData = userDoc.data();
                    let newBalance = userData.balance || 0;

                    if (type === 'add') {
                        newBalance += amount;
                    } else if (type === 'subtract') {
                        newBalance = Math.max(0, newBalance - amount);
                    } else if (type === 'set') {
                        newBalance = amount;
                    }

                    db.collection('users').doc(userDoc.id).update({
                        balance: newBalance
                    }).then(() => {
                        showToast(`Balance updated successfully. New balance: Rs. ${newBalance}`, 'success');
                    });
                });
        }

        function approveRequest(type, requestId, userId, amount) {
            const collection = type === 'deposit' ? 'deposit_requests' : 'withdraw_requests';
                
            db.collection(collection).doc(requestId).update({
                status: 'approved',
                processedAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                if (type === 'deposit') {
                    // For deposits, add the amount to user's balance
                    db.collection('users').doc(userId).update({
                        balance: firebase.firestore.FieldValue.increment(amount)
                    });
                }
                showToast('Request approved successfully', 'success');
                loadAdminRequests();
            });
        }

        function rejectRequest(type, requestId) {
            const collection = type === 'deposit' ? 'deposit_requests' : 'withdraw_requests';
                
            db.collection(collection).doc(requestId).update({
                status: 'rejected',
                processedAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                if (type === 'withdraw') {
                    // For withdrawals, return the amount to user's balance
                    db.collection(collection).doc(requestId).get().then(doc => {
                        const data = doc.data();
                        db.collection('users').doc(data.userId).update({
                            balance: firebase.firestore.FieldValue.increment(data.amount)
                        });
                    });
                }
                showToast('Request rejected', 'success');
                loadAdminRequests();
            });
        }

        function sendAnnouncement() {
            const title = document.getElementById('announcementTitle').value;
            const content = document.getElementById('announcementContent').value;

            if (!title || !content) {
                showToast('Please enter title and content', 'error');
                return;
            }

            db.collection('announcements').add({
                title: title,
                content: content,
                date: firebase.firestore.FieldValue.serverTimestamp(),
                from: 'Admin'
            }).then(() => {
                showToast('Announcement sent to all users', 'success');
                document.getElementById('announcementTitle').value = '';
                document.getElementById('announcementContent').value = '';
            });
        }

        function sendPrivateMessage() {
            const userEmail = document.getElementById('pmUserEmail').value;
            const title = document.getElementById('pmTitle').value;
            const content = document.getElementById('pmContent').value;

            if (!userEmail || !title || !content) {
                showToast('Please fill all fields', 'error');
                return;
            }

            // Find user by email
            db.collection('users')
                .where('email', '==', userEmail)
                .get()
                .then(querySnapshot => {
                    if (querySnapshot.empty) {
                        showToast('User not found', 'error');
                        return;
                    }

                    const userId = querySnapshot.docs[0].id;

                    db.collection('user_messages').add({
                        userId: userId,
                        title: title,
                        content: content,
                        date: firebase.firestore.FieldValue.serverTimestamp(),
                        read: false,
                        from: 'Admin'
                    }).then(() => {
                        showToast('Message sent successfully', 'success');
                        document.getElementById('pmTitle').value = '';
                        document.getElementById('pmContent').value = '';
                    });
                });
        }

        function loadAnnouncements() {
            const container = document.getElementById('announcementsContainer');
            container.innerHTML = 'Loading...';

            db.collection('announcements')
                .orderBy('date', 'desc')
                .limit(20)
                .get()
                .then(querySnapshot => {
                    container.innerHTML = '';

                    if (querySnapshot.empty) {
                        container.innerHTML = '<p>No announcements yet</p>';
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const messageEl = document.createElement('div');
                        messageEl.className = 'message-item';
                        messageEl.innerHTML = `
                            <h3>${data.title}</h3>
                            <p>${data.content}</p>
                            <div class="message-date">${data.date.toDate().toLocaleString()} - From: ${data.from}</div>
                        `;
                        container.appendChild(messageEl);
                    });
                });
        }

        // VIP level calculation
        function getVipLevel(referralCount) {
            if (referralCount >= 25) return 5;
            if (referralCount >= 15) return 4;
            if (referralCount >= 10) return 3;
            if (referralCount >= 5) return 2;
            return 1;
        }

        // Update user balance in Firebase
        function updateUserBalance(newBalance) {
            if (!currentUser) return;

            db.collection('users').doc(currentUser.uid).update({
                balance: newBalance
            })
            .catch(error => {
                console.error('Error updating balance:', error);
            });
        }

        // Initialize the application
        function initApp() {
            // Check authentication state
            checkAuthState();

            // Load user data if logged in
            if (currentUser) {
                loadUserData();
            }

            // Setup games
            setupGames();
        }

        // Call initApp when terms are accepted
        if (termsAccepted) {
            initApp();
        }

        // Setup games (this would be your existing game setup code)
        function setupGames() {
            // Your existing game setup code here
        }

        // Your existing game functions here (startCardGame, startFruitGame, etc.)
    </script>
</body>
</html>
