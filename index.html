<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>USCash üéÆ</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
:root {
--primary: #FFD700;
--secondary: #1E90FF;
--dark: #0A0A0A;
--light: #FFFFFF;
--accent: #FF6347;
}

body {
font-family: 'Poppins', sans-serif;
background-color: var(--dark);
color: var(--primary);
text-align: center;
margin: 0;
padding: 0;
background-image:
radial-gradient(circle at 10% 20%, rgba(255, 215, 0, 0.05) 0%, transparent 20%),
radial-gradient(circle at 90% 80%, rgba(30, 144, 255, 0.05) 0%, transparent 20%);
}

h1 {
font-size: 2.8rem;
background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
margin: 20px 0;
letter-spacing: 2px;
position: relative;
display: inline-block;
}

h1::after {
content: '';
position: absolute;
bottom: -10px;
left: 0;
width: 100%;
height: 3px;
background: linear-gradient(90deg, transparent, var(--primary), transparent);
}

.nav {
background: linear-gradient(90deg, var(--dark), var(--primary), var(--dark));
color: var(--dark);
padding: 12px;
display: flex;
justify-content: space-around;
flex-wrap: wrap;
box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
position: relative;
z-index: 100;
}

.nav a {
color: var(--dark);
text-decoration: none;
font-weight: bold;
padding: 8px 15px;
border-radius: 20px;
transition: all 0.3s;
font-size: 1.1rem;
}

.nav a:hover {
background-color: var(--dark);
color: var(--primary);
transform: translateY(-3px);
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.section {
margin: 30px auto;
padding: 25px;
max-width: 900px;
border: 2px solid var(--primary);
border-radius: 15px;
box-sizing: border-box;
background-color: rgba(10, 10, 10, 0.8);
box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
position: relative;
overflow: hidden;
}

.section::before {
content: '';
position: absolute;
top: -2px;
left: -2px;
right: -2px;
bottom: -2px;
border: 2px solid transparent;
border-image: linear-gradient(45deg, var(--primary), var(--secondary)) 1;
z-index: -1;
animation: borderRotate 8s linear infinite;
}

@keyframes borderRotate {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.gold-box {
display: inline-block;
background: linear-gradient(145deg, var(--primary), #e6c200);
color: var(--dark);
margin: 8px;
padding: 12px 20px;
border-radius: 12px;
cursor: pointer;
font-size: 1.1rem;
font-weight: bold;
transition: all 0.3s;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
border: none;
}

.gold-box:hover {
transform: translateY(-5px);
box-shadow: 0 8px 16px rgba(255, 215, 0, 0.3);
background: linear-gradient(145deg, #ffdf00, var(--primary));
}

.gold-box.active {
background: var(--dark);
color: var(--primary);
border: 2px solid var(--primary);
box-shadow: 0 0 15px var(--primary);
}

.game-options {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 20px;
align-items: center;
justify-content: center;
padding: 20px 0;
}

.game-options .gold-box {
width: 100%;
height: 180px;
font-size: 1.4rem;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
border: 2px solid var(--primary);
box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
transition: all 0.3s ease;
position: relative;
overflow: hidden;
background-size: cover;
background-position: center;
text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
}

.game-options .gold-box::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0, 0, 0, 0.4);
z-index: 0;
}

.game-options .gold-box > * {
position: relative;
z-index: 1;
}

.game-options .gold-box:hover {
transform: scale(1.05);
box-shadow: 0 0 30px var(--primary);
}

.game-options .gold-box i {
font-size: 3rem;
margin-bottom: 15px;
color: var(--primary);
text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
}

/* Updated game thumbnails */
.scratch-thumbnail {
background-image: url('https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
}

.fruit-thumbnail {
background-image: url('https://images.unsplash.com/photo-1619566636858-adf3ef46400b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
}

.tictactoe-thumbnail {
background-image: url('https://images.unsplash.com/photo-1536514498073-50e69d39c6cf?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
}

.findace-thumbnail {
background-image: url('https://images.unsplash.com/photo-1501004318641-b39e6451bec6?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
}

.archery-thumbnail {
background-image: url('https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
}

.impossible-tower-thumbnail {
background-image: url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
}

.card-grid {
display: flex;
flex-wrap: wrap;
justify-content: center;
gap: 15px;
margin: 20px auto;
max-width: 450px;
}

.card {
width: 90px;
height: 110px;
background-color: white;
color: black;
font-size: 2.2rem;
display: flex;
align-items: center;
justify-content: center;
border: 2px solid var(--primary);
border-radius: 10px;
cursor: pointer;
transition: transform 0.4s, background-color 0.3s;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
background-size: cover;
background-position: center;
}

.card.flipped {
background: linear-gradient(145deg, var(--primary), #e6c200);
color: var(--dark);
transform: rotateY(180deg);
box-shadow: 0 0 15px var(--primary);
}

.bet-amounts {
margin-top: 20px;
display: flex;
justify-content: center;
flex-wrap: wrap;
gap: 12px;
}

#result {
margin-top: 20px;
font-size: 1.3rem;
color: var(--light);
padding: 10px;
border-radius: 8px;
background-color: rgba(0, 0, 0, 0.5);
}

.shake {
animation: shake 0.5s;
}

.glow {
animation: glow 1s infinite alternate;
}

@keyframes shake {
0% { transform: translate(1px, 1px) rotate(0deg); }
20% { transform: translate(-3px, 0px) rotate(-2deg); }
40% { transform: translate(3px, 2px) rotate(2deg); }
60% { transform: translate(-2px, 1px) rotate(0deg); }
80% { transform: translate(2px, -1px) rotate(2deg); }
100% { transform: translate(1px, 1px) rotate(0deg); }
}

@keyframes glow {
from { box-shadow: 0 0 10px var(--primary); }
to { box-shadow: 0 0 20px var(--light); }
}

#particles-js {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
pointer-events: none;
z-index: 999;
display: none;
}

#welcomePopup {
position: fixed;
top: 0; left: 0;
width: 100%; height: 100%;
background-color: rgba(0, 0, 0, 0.9);
display: flex;
justify-content: center;
align-items: center;
z-index: 10000;
}

#welcomePopup .popup-content {
background: var(--dark);
border: 2px solid var(--primary);
padding: 30px;
border-radius: 15px;
max-width: 450px;
color: var(--primary);
text-align: center;
position: relative;
box-shadow: 0 0 30px var(--primary);
animation: popupEnter 0.5s ease-out;
}

@keyframes popupEnter {
from { transform: scale(0.8); opacity: 0; }
to { transform: scale(1); opacity: 1; }
}

#welcomePopup .popup-content h2 {
color: var(--secondary);
margin-top: 0;
font-size: 1.8rem;
}

#welcomePopup .popup-content .close {
position: absolute;
top: 15px;
right: 20px;
cursor: pointer;
font-weight: bold;
color: var(--accent);
font-size: 24px;
transition: transform 0.3s;
}

#welcomePopup .popup-content .close:hover {
transform: rotate(90deg);
}

/* ŸÅÿ±ŸàŸπ ÿ¥ŸàŸπÿ± ⁄Ø€åŸÖ ⁄©€í ŸÑ€å€í ÿßÿ∂ÿßŸÅ€å ÿ≥Ÿπÿßÿ¶ŸÑÿ≤ */
#fruitGame {
display: none;
}

.shoot-area {
position: relative;
height: 400px;
border: 3px dashed var(--primary);
border-radius: 15px;
background-color: #222;
overflow: hidden;
margin-top: 20px;
box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
}

.fruit {
position: absolute;
font-size: 3.5em;
cursor: pointer;
user-select: none;
pointer-events: auto;
transition: transform 0.1s;
z-index: 10;
}

.fruit:hover {
transform: scale(1.1);
}

#fruitTargetDisplay {
font-size: 1.5em;
margin: 15px 0;
color: var(--light);
padding: 10px;
background-color: rgba(0, 0, 0, 0.5);
border-radius: 8px;
display: inline-block;
}

#fruitScoreDisplay {
margin-top: 15px;
font-size: 1.3em;
font-weight: bold;
}

#fruitCountdown {
font-size: 1.4em;
margin-top: 15px;
color: var(--primary);
font-weight: bold;
}

/* Tic Tac Toe Styles */
#tictactoeGame {
display: none;
}

.tic-tac-toe-board {
display: grid;
grid-template-columns: repeat(3, 1fr);
grid-template-rows: repeat(3, 1fr);
gap: 8px;
width: 320px;
height: 320px;
margin: 25px auto;
background-color: rgba(255, 215, 0, 0.1);
padding: 15px;
border-radius: 15px;
}

.tic-tac-toe-cell {
background-color: #222;
border: 2px solid var(--primary);
display: flex;
align-items: center;
justify-content: center;
font-size: 3.5rem;
cursor: pointer;
transition: all 0.3s;
color: var(--primary);
}

.tic-tac-toe-cell:hover {
background-color: #333;
transform: scale(1.05);
}

.tic-tac-toe-cell.x {
color: var(--secondary);
text-shadow: 0 0 10px var(--secondary);
}

.tic-tac-toe-cell.o {
color: var(--accent);
text-shadow: 0 0 10px var(--accent);
}

#tictactoeResult {
margin-top: 20px;
font-size: 1.3rem;
color: var(--light);
padding: 10px;
background-color: rgba(0, 0, 0, 0.5);
border-radius: 8px;
}

#tictactoeCountdown {
font-size: 1.4rem;
color: var(--primary);
font-weight: bold;
}

/* Find Ace Game Styles */
#findAceGame {
display: none;
}

#findAceCountdown {
font-size: 1.5rem;
margin: 15px 0;
color: var(--primary);
font-weight: bold;
}

#findAceResult {
margin-top: 20px;
font-size: 1.3rem;
color: var(--light);
padding: 10px;
background-color: rgba(0, 0, 0, 0.5);
border-radius: 8px;
}

/* Archery Game Styles */
#archeryGame {
display: none;
}

.archery-container {
display: flex;
flex-direction: column;
align-items: center;
gap: 20px;
}

.archery-canvas-container {
position: relative;
width: 360px;
height: 360px;
max-width: 100%;
margin: 0 auto;
}

#archeryCanvas {
background: transparent;
border-radius: 12px;
display: block;
max-width: 100%;
height: auto;
border: 2px solid var(--primary);
}

.archery-controls {
display: flex;
flex-direction: column;
gap: 15px;
width: 100%;
max-width: 520px;
}

.archery-bets {
display: flex;
justify-content: center;
flex-wrap: wrap;
gap: 10px;
}

.archery-score-row {
display: flex;
justify-content: center;
gap: 10px;
}

.archery-score-box {
width: 48px;
height: 48px;
border-radius: 8px;
background: linear-gradient(145deg, #222, #111);
border: 2px solid var(--primary);
display: flex;
align-items: center;
justify-content: center;
font-weight: 800;
color: var(--primary);
}

#archeryStatus {
font-size: 1.1rem;
color: var(--light);
text-align: center;
padding: 10px;
background-color: rgba(0, 0, 0, 0.5);
border-radius: 8px;
}

/* Impossible Tower Game Styles */
#impossibleTowerGame {
display: none;
}

.tower-container {
width: 300px;
height: 400px;
margin: 0 auto;
position: relative;
border: 2px solid var(--primary);
border-radius: 10px;
overflow: hidden;
background: linear-gradient(to bottom, #1a1a2e, #16213e);
}

.tower-block {
position: absolute;
background: linear-gradient(145deg, var(--primary), #e6c200);
border-radius: 4px;
transition: all 0.3s ease;
}

#towerScore {
font-size: 1.3rem;
margin: 15px 0;
color: var(--primary);
font-weight: bold;
}

#towerCountdown {
font-size: 1.5rem;
margin: 15px 0;
color: var(--primary);
font-weight: bold;
}

/* Auth Modal Styles */
.auth-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.85);
z-index: 1000;
align-items: center;
justify-content: center;
}

.auth-content {
background-color: var(--dark);
border: 2px solid var(--primary);
padding: 30px;
border-radius: 15px;
width: 90%;
max-width: 400px;
color: var(--light);
box-shadow: 0 0 30px var(--primary);
animation: modalFadeIn 0.4s ease-out;
}

@keyframes modalFadeIn {
from { opacity: 0; transform: translateY(-20px); }
to { opacity: 1; transform: translateY(0); }
}

.auth-tabs {
display: flex;
margin-bottom: 25px;
border-bottom: 2px solid var(--primary);
}

.auth-tab {
flex: 1;
padding: 12px;
text-align: center;
cursor: pointer;
border-bottom: 3px solid transparent;
font-weight: bold;
transition: all 0.3s;
}

.auth-tab.active {
border-bottom: 3px solid var(--secondary);
color: var(--secondary);
}

.auth-tab:hover {
background-color: rgba(255, 215, 0, 0.1);
}

.auth-form {
display: none;
}

.auth-form.active {
display: block;
}

.auth-form input {
width: 100%;
padding: 12px;
margin-bottom: 18px;
border-radius: 8px;
border: 1px solid #444;
background-color: #222;
color: var(--light);
font-size: 1rem;
transition: all 0.3s;
}

.auth-form input:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 10px var(--primary);
}

.auth-form button {
width: 100%;
padding: 12px;
background: linear-gradient(145deg, var(--primary), #e6c200);
color: var(--dark);
border: none;
border-radius: 8px;
font-weight: bold;
cursor: pointer;
font-size: 1.1rem;
transition: all 0.3s;
margin-top: 10px;
}

.auth-form button:hover {
background: linear-gradient(145deg, #ffdf00, var(--primary));
transform: translateY(-3px);
box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
}

.auth-form button:disabled {
background: #444;
cursor: not-allowed;
transform: none;
box-shadow: none;
}

.forgot-password {
text-align: right;
margin-top: -15px;
margin-bottom: 20px;
font-size: 0.9rem;
color: var(--secondary);
cursor: pointer;
transition: color 0.3s;
}

.forgot-password:hover {
color: var(--primary);
text-decoration: underline;
}

/* Balance and User Info Styles */
.user-info {
display: flex;
align-items: center;
justify-content: center;
gap: 20px;
margin: 20px 0;
flex-wrap: wrap;
}

.balance-container {
display: flex;
align-items: center;
gap: 10px;
background-color: rgba(0, 0, 0, 0.5);
padding: 12px 20px;
border-radius: 30px;
border: 1px solid var(--primary);
box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
}

#balanceAmount {
font-weight: bold;
font-size: 1.2rem;
color: var(--primary);
}

.refresh-balance {
cursor: pointer;
color: var(--primary);
font-size: 1.3rem;
transition: transform 0.3s;
}

.refresh-balance:hover {
transform: rotate(180deg);
color: var(--secondary);
}

#userDisplay {
display: flex;
align-items: center;
background-color: rgba(0, 0, 0, 0.5);
padding: 10px 20px;
border-radius: 30px;
border: 1px solid var(--secondary);
box-shadow: 0 0 15px rgba(30, 144, 255, 0.2);
gap: 10px;
}

#usernameDisplay {
font-weight: bold;
color: var(--secondary);
font-size: 0.84rem; /* 40% smaller */
}

#phoneDisplay {
font-weight: bold;
color: var(--primary);
font-size: 0.84rem; /* 40% smaller */
}

.country-flag {
width: 24px;
height: 16px;
border-radius: 2px;
box-shadow: 0 0 5px rgba(0,0,0,0.3);
}

.verified-badge {
color: var(--secondary);
margin-left: 5px;
font-size: 0.84rem; /* 40% smaller */
}

/* Deposit/Withdraw Styles */
#depositSection, #withdrawSection, #moreSection, #vipSection, #watchAndEarnSection {
display: none;
}

.form-group {
margin-bottom: 20px;
text-align: left;
}

.form-group label {
display: block;
margin-bottom: 8px;
color: var(--primary);
font-weight: bold;
}

.form-group input, .form-group select {
width: 100%;
padding: 12px;
border-radius: 8px;
border: 1px solid #444;
background-color: #222;
color: var(--light);
font-size: 1rem;
transition: all 0.3s;
}

.form-group input:focus, .form-group select:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 10px var(--primary);
}

.submit-btn {
background: linear-gradient(145deg, var(--primary), #e6c200);
color: var(--dark);
border: none;
padding: 12px 25px;
border-radius: 8px;
font-weight: bold;
cursor: pointer;
margin-top: 15px;
font-size: 1.1rem;
transition: all 0.3s;
display: inline-block;
}

.submit-btn:hover {
background: linear-gradient(145deg, #ffdf00, var(--primary));
transform: translateY(-3px);
box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
}

.transaction-history {
margin-top: 30px;
max-height: 400px;
overflow-y: auto;
padding: 15px;
background-color: rgba(0, 0, 0, 0.3);
border-radius: 10px;
border: 1px solid rgba(255, 215, 0, 0.3);
}

.transaction-item {
background-color: rgba(30, 30, 30, 0.8);
padding: 15px;
margin-bottom: 15px;
border-radius: 8px;
border-left: 4px solid var(--primary);
transition: transform 0.3s;
}

.transaction-item:hover {
transform: translateX(5px);
}

.transaction-amount {
font-weight: bold;
font-size: 1.1rem;
}

.transaction-approved {
color: lime;
}

.transaction-pending {
color: var(--primary);
}

.transaction-rejected {
color: var(--accent);
}

/* VIP Section Styles */
.referral-code {
background-color: rgba(0, 0, 0, 0.5);
padding: 15px;
border-radius: 8px;
font-family: monospace;
margin: 15px 0;
word-break: break-all;
border: 1px solid var(--primary);
font-size: 1.2rem;
color: var(--primary);
position: relative;
}

.referral-code-copy {
position: absolute;
right: 10px;
top: 10px;
color: var(--secondary);
cursor: pointer;
font-size: 1rem;
}

.referral-stats {
display: flex;
justify-content: space-around;
margin: 25px 0;
flex-wrap: wrap;
gap: 15px;
}

.stat-box {
background-color: rgba(0, 0, 0, 0.5);
padding: 20px;
border-radius: 10px;
border: 1px solid var(--primary);
min-width: 120px;
flex: 1;
transition: transform 0.3s;
}

.stat-box:hover {
transform: translateY(-5px);
box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
}

.stat-label {
color: var(--light);
margin-bottom: 10px;
font-size: 0.9rem;
}

.stat-value {
font-size: 1.8rem;
font-weight: bold;
color: var(--primary);
}

/* Announcement Bar */
.announcement-bar {
position: relative;
background: linear-gradient(90deg, transparent, rgba(30, 144, 255, 0.2), transparent);
color: var(--light);
padding: 12px 0;
overflow: hidden;
margin: 0 auto;
width: 100%;
border-top: 1px solid var(--secondary);
border-bottom: 1px solid var(--secondary);
}

.announcement-content {
display: inline-block;
white-space: nowrap;
padding-left: 100%;
animation: scroll 20s linear infinite;
font-size: 1.1rem;
text-shadow: 0 0 5px var(--secondary);
}

.announcement-content span {
color: var(--secondary);
font-weight: bold;
}

@keyframes scroll {
0% { transform: translateX(0); }
100% { transform: translateX(-100%); }
}

/* Toast notification */
.toast {
position: fixed;
top: 20px;
left: 50%;
transform: translateX(-50%);
background-color: rgba(0, 0, 0, 0.8);
color: white;
padding: 15px 25px;
border-radius: 8px;
z-index: 10000;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
border-left: 4px solid var(--primary);
opacity: 0;
transition: opacity 0.3s;
}

.toast.show {
opacity: 1;
}

/* Side Menu */
.side-menu {
position: fixed;
top: 10px;
right: 10px;
z-index: 1000;
}

.menu-btn {
background: linear-gradient(145deg, var(--primary), #e6c200);
color: var(--dark);
width: 40px;
height: 40px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-size: 1.2rem;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.menu-content {
position: absolute;
top: 50px;
right: 0;
background: var(--dark);
border: 2px solid var(--primary);
border-radius: 10px;
width: 250px;
box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
display: none;
}

.menu-content a {
display: block;
padding: 12px 20px;
color: var(--primary);
text-decoration: none;
border-bottom: 1px solid rgba(255, 215, 0, 0.2);
}

.menu-content a:hover {
background-color: rgba(255, 215, 0, 0.1);
}

.menu-content a:last-child {
border-bottom: none;
}

/* Terms and Conditions Modal */
.terms-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.9);
z-index: 10000;
align-items: center;
justify-content: center;
}

.terms-content {
background: var(--dark);
border: 2px solid var(--primary);
padding: 30px;
border-radius: 15px;
max-width: 600px;
max-height: 80vh;
overflow-y: auto;
color: var(--light);
text-align: left;
position: relative;
box-shadow: 0 0 30px var(--primary);
}

.terms-content h2 {
color: var(--secondary);
text-align: center;
margin-bottom: 20px;
}

.terms-content p {
margin-bottom: 15px;
line-height: 1.6;
}

.terms-content ul {
margin-left: 20px;
margin-bottom: 20px;
}

.terms-content li {
margin-bottom: 10px;
}

/* Watch and Earn Section */
.ads-container {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 15px;
margin: 20px 0;
}

.ad-item {
background-color: rgba(0, 0, 0, 0.5);
border: 1px solid var(--primary);
border-radius: 10px;
padding: 15px;
text-align: center;
cursor: pointer;
transition: all 0.3s;
}

.ad-item:hover {
transform: translateY(-5px);
box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
}

.ad-item img {
max-width: 100%;
border-radius: 8px;
margin-bottom: 10px;
}

.ad-item .ad-status {
font-size: 0.9rem;
color: var(--secondary);
margin-top: 10px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
h1 {
font-size: 2.2rem;
}

.game-options {
grid-template-columns: 1fr;
}

.game-options .gold-box {
width: 100%;
height: 140px;
font-size: 1.2rem;
}

.tic-tac-toe-board {
width: 280px;
height: 280px;
}

.archery-canvas-container {
width: 100%;
height: auto;
}

.nav a {
padding: 6px 10px;
font-size: 0.9rem;
}

.section {
padding: 20px;
}

.user-info {
flex-direction: column;
gap: 10px;
}

.ads-container {
grid-template-columns: 1fr;
}
}

@media (max-width: 480px) {
h1 {
font-size: 1.8rem;
}

.game-options .gold-box {
width: 100%;
height: 120px;
font-size: 1rem;
}

.game-options .gold-box i {
font-size: 2rem;
}

.tic-tac-toe-board {
width: 240px;
height: 240px;
}

.card {
width: 70px;
height: 90px;
font-size: 1.8rem;
}
}
</style>
</head>
<body>
<div id="particles-js"></div>
<div id="toast" class="toast"></div>

<!-- Side Menu -->
<div class="side-menu">
<div class="menu-btn" onclick="toggleMenu()">
<i class="fas fa-ellipsis-h"></i>
</div>
<div class="menu-content" id="menuContent">
<a href="#" onclick="showSection('more')"><i class="fas fa-history"></i> Game History</a>
<a href="#" onclick="contactSupport()"><i class="fas fa-headset"></i> Customer Service</a>
<a href="#" onclick="showAnnouncements()"><i class="fas fa-bullhorn"></i> Announcements</a>
<a href="#" onclick="showSocialMedia()"><i class="fas fa-share-alt"></i> Social Media</a>
<a href="#" onclick="showTerms()"><i class="fas fa-file-alt"></i> Terms & Conditions</a>
</div>
</div>

<!-- Announcement Bar -->
<div class="announcement-bar">
<div class="announcement-content">
<span>üì¢ For deposits contact VIP users, We are working on deposit methods soon we will update you guys thanks for your patience</span>
</div>
</div>

<!-- Terms and Conditions Modal -->
<div id="termsModal" class="terms-modal">
<div class="terms-content">
<div class="close" onclick="hideTerms()">√ó</div>
<h2>Terms and Conditions</h2>
<p>By using USCash, you agree to the following terms and conditions:</p>
<ul>
<li>You must be at least 18 years old to use this platform.</li>
<li>All games are for entertainment purposes only.</li>
<li>You are solely responsible for your account security.</li>
<li>We reserve the right to suspend accounts that violate our terms.</li>
<li>If a user leaves their account inactive for more than 15 days, the platform reserves the right not to return the deposited money.</li>
<li>All decisions regarding deposits and withdrawals are final.</li>
<li>We are not responsible for any financial losses incurred while using our platform.</li>
</ul>
<p>By clicking "I Accept", you acknowledge that you have read and agree to these terms.</p>
<div style="text-align: center; margin-top: 20px;">
<button class="gold-box" onclick="acceptTerms()">I Accept</button>
<button class="gold-box" onclick="hideTerms()" style="background: #444; margin-left: 10px;">Cancel</button>
</div>
</div>
</div>

<!-- Welcome Popup (shown after login) -->
<div id="welcomePopup">
<div class="popup-content">
<div class="close" onclick="document.getElementById('welcomePopup').style.display='none'">√ó</div>
<h2>Welcome to USCash! üéÆ</h2>
<p>Experience the thrill of gaming with real rewards. We're constantly improving our platform to bring you the best gaming experience.</p>
<p>New games and features are coming soon - stay tuned!</p>
<button class="gold-box" onclick="document.getElementById('welcomePopup').style.display='none'" style="margin-top: 20px;">
Let's Play!
</button>
</div>
</div>

<!-- Auth Modals -->
<div id="authModal" class="auth-modal">
<div class="auth-content">
<div class="auth-tabs">
<div class="auth-tab active" onclick="switchAuthTab('login')">Login</div>
<div class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</div>
</div>

<div id="loginForm" class="auth-form active">
<input type="email" id="loginEmail" placeholder="Email" required />
<input type="password" id="loginPassword" placeholder="Password" required />
<div class="forgot-password" onclick="showForgotPassword()">Forgot Password?</div>
<button onclick="loginUser()">Login</button>
</div>

<div id="signupForm" class="auth-form">
<input type="text" id="signupName" placeholder="Full Name" required />
<input type="tel" id="signupPhone" placeholder="Phone Number" required />
<input type="email" id="signupEmail" placeholder="Email" required />
<input type="password" id="signupPassword" placeholder="Password (6+ characters)" required minlength="6" />
<input type="password" id="signupConfirmPassword" placeholder="Confirm Password" required minlength="6" />
<input type="text" id="referralCode" placeholder="Referral Code (Optional)" />
<button onclick="signupUser()">Sign Up</button>
</div>

<div id="forgotPasswordForm" class="auth-form">
<input type="email" id="forgotEmail" placeholder="Enter your email" required />
<button onclick="resetPassword()">Reset Password</button>
<button onclick="backToLogin()" style="margin-top: 10px; background-color: #444;">Back to Login</button>
</div>
</div>
</div>

<h1>USCash üéÆ</h1>

<div class="user-info">
<div id="userDisplay" style="display:none;">
<img src="https://flagcdn.com/w20/pk.png" class="country-flag" alt="Country Flag" id="countryFlag">
<span id="usernameDisplay"></span>
<span id="phoneDisplay"></span>
<i class="fas fa-check-circle verified-badge" id="verifiedBadge" style="display:none;"></i>
</div>
<div class="balance-container">
<span>Balance: Rs. <span id="balanceAmount">0</span></span>
<i class="fas fa-sync-alt refresh-balance" onclick="refreshBalance()"></i>
</div>
<div id="authButtons">
<button class="gold-box" onclick="showAuthModal('login')">Login</button>
<button class="gold-box" onclick="showAuthModal('signup')">Sign Up</button>
</div>
<div id="logoutButton" style="display:none;">
<button class="gold-box" onclick="logoutUser()">Logout</button>
</div>
</div>

<div class="nav">
<a href="#" onclick="showSection('home')"><i class="fas fa-home"></i> Home</a>
<a href="#" onclick="showSection('deposit')"><i class="fas fa-money-bill-wave"></i> Deposit</a>
<a href="#" onclick="showSection('withdraw')"><i class="fas fa-wallet"></i> Withdraw</a>
<a href="#" onclick="showSection('watchAndEarn')"><i class="fas fa-eye"></i> Watch & Earn</a>
<a href="#" onclick="showSection('vip')"><i class="fas fa-crown"></i> VIP</a>
</div>

<!-- Home Section -->
<div class="section" id="homeSection">
<h2>Select Game</h2>
<div class="game-options">
<div class="gold-box scratch-thumbnail" onclick="startCardGame()">
<i class="fas fa-scroll"></i>
Scratch Match
</div>
<div class="gold-box fruit-thumbnail" onclick="startFruitGame()">
<i class="fas fa-apple-alt"></i>
Fruit Shooting
</div>
<div class="gold-box tictactoe-thumbnail" onclick="startTicTacToeGame()">
<i class="fas fa-times"></i>
Tic Tac Toe
</div>
<div class="gold-box findace-thumbnail" onclick="startFindAceGame()">
<i class="fas fa-search"></i>
Find Ace
</div>
<div class="gold-box archery-thumbnail" onclick="startArcheryGame()">
<i class="fas fa-bullseye"></i>
Archery Challenge
</div>
<div class="gold-box impossible-tower-thumbnail" onclick="startImpossibleTowerGame()">
<i class="fas fa-layer-group"></i>
Impossible Tower
</div>
</div>
</div>

<!-- Scratch Game -->
<div class="section" id="scratchGame" style="display:none;">
<h2><i class="fas fa-scroll"></i> Scratch & Match</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="selectBet(20)">20</div>
<div class="gold-box" onclick="selectBet(50)">50</div>
<div class="gold-box" onclick="selectBet(70)">70</div>
<div class="gold-box" onclick="selectBet(100)">100</div>
<div class="gold-box" onclick="selectBet(150)">150</div>
<div class="gold-box" onclick="selectBet(180)">180</div>
<div class="gold-box" onclick="selectBet(200)">200</div>
<div class="gold-box" onclick="selectBet(300)">300</div>
</div>
<div class="card-grid" id="cardGrid"></div>
<div id="result"></div>
</div>

<!-- Fruit Game -->
<div class="section" id="fruitGame" style="display:none;">
<h2><i class="fas fa-apple-alt"></i> Fruit Shooting</h2>
<div id="fruitTargetDisplay">Target: Shoot the <b style="color:red;">RED</b> Apple üçé!</div>
<div class="bet-amounts">
<div class="gold-box" onclick="startFruitRound(20)">Rs. 20</div>
<div class="gold-box" onclick="startFruitRound(50)">Rs. 50</div>
<div class="gold-box" onclick="startFruitRound(70)">Rs. 70</div>
<div class="gold-box" onclick="startFruitRound(100)">Rs. 100</div>
<div class="gold-box" onclick="startFruitRound(150)">Rs. 150</div>
<div class="gold-box" onclick="startFruitRound(180)">Rs. 180</div>
<div class="gold-box" onclick="startFruitRound(200)">Rs. 200</div>
<div class="gold-box" onclick="startFruitRound(300)">Rs. 300</div>
</div>
<div id="fruitCountdown">Time: 0s</div>
<div class="shoot-area" id="shootArea"></div>
<div id="fruitScoreDisplay"></div>
</div>

<!-- Tic Tac Toe Game -->
<div class="section" id="tictactoeGame" style="display:none;">
<h2><i class="fas fa-times"></i> Tic Tac Toe</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="selectTicTacToeBet(20)">Rs. 20</div>
<div class="gold-box" onclick="selectTicTacToeBet(50)">Rs. 50</div>
<div class="gold-box" onclick="selectTicTacToeBet(70)">Rs. 70</div>
<div class="gold-box" onclick="selectTicTacToeBet(100)">Rs. 100</div>
<div class="gold-box" onclick="selectTicTacToeBet(150)">Rs. 150</div>
<div class="gold-box" onclick="selectTicTacToeBet(180)">Rs. 180</div>
<div class="gold-box" onclick="selectTicTacToeBet(200)">Rs. 200</div>
<div class="gold-box" onclick="selectTicTacToeBet(300)">Rs. 300</div>
</div>
<div id="tictactoeCountdown">Time: 30s</div>
<div class="tic-tac-toe-board" id="ticTacToeBoard"></div>
<div id="tictactoeResult"></div>
</div>

<!-- Find Ace Game -->
<div class="section" id="findAceGame" style="display:none;">
<h2><i class="fas fa-search"></i> Find Ace</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="startFindAceRound(20)">Rs. 20</div>
<div class="gold-box" onclick="startFindAceRound(50)">Rs. 50</div>
<div class="gold-box" onclick="startFindAceRound(70)">Rs. 70</div>
<div class="gold-box" onclick="startFindAceRound(100)">Rs. 100</div>
<div class="gold-box" onclick="startFindAceRound(150)">Rs. 150</div>
<div class="gold-box" onclick="startFindAceRound(180)">Rs. 180</div>
<div class="gold-box" onclick="startFindAceRound(200)">Rs. 200</div>
<div class="gold-box" onclick="startFindAceRound(300)">Rs. 300</div>
</div>
<div id="findAceCountdown">Time: 15s</div>
<div class="card-grid" id="findAceGrid"></div>
<div id="findAceResult"></div>
</div>

<!-- Archery Game -->
<div class="section" id="archeryGame" style="display:none;">
<h2><i class="fas fa-bullseye"></i> Archery Challenge</h2>
<div class="archery-container">
<div class="archery-canvas-container">
<canvas id="archeryCanvas" width="520" height="520"></canvas>
</div>

<div class="archery-controls">
<div class="bet-amounts">
<div class="gold-box" onclick="selectArcheryBet(20)">Rs. 20</div>
<div class="gold-box" onclick="selectArcheryBet(50)">Rs. 50</div>
<div class="gold-box" onclick="selectArcheryBet(70)">Rs. 70</div>
<div class="gold-box" onclick="selectArcheryBet(100)">Rs. 100</div>
<div class="gold-box" onclick="selectArcheryBet(150)">Rs. 150</div>
<div class="gold-box" onclick="selectArcheryBet(180)">Rs. 180</div>
<div class="gold-box" onclick="selectArcheryBet(200)">Rs. 200</div>
<div class="gold-box" onclick="selectArcheryBet(300)">Rs. 300</div>
</div>

<div class="archery-score-row" id="archeryScoreRow">
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
</div>

<div id="archeryStatus">Pick a bet to start</div>

<div style="display: flex; justify-content: center; gap: 10px;">
<button class="gold-box" onclick="resetArcheryGame()">Reset</button>
<button class="gold-box" onclick="toggleArcheryAuto()" id="archeryAutoBtn">Auto: OFF</button>
</div>
</div>
</div>
</div>

<!-- Impossible Tower Game -->
<div class="section" id="impossibleTowerGame" style="display:none;">
<h2><i class="fas fa-layer-group"></i> Impossible Tower</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="startTowerGame(20)">Rs. 20</div>
<div class="gold-box" onclick="startTowerGame(50)">Rs. 50</div>
<div class="gold-box" onclick="startTowerGame(70)">Rs. 70</div>
<div class="gold-box" onclick="startTowerGame(100)">Rs. 100</div>
<div class="gold-box" onclick="startTowerGame(150)">Rs. 150</div>
<div class="gold-box" onclick="startTowerGame(180)">Rs. 180</div>
<div class="gold-box" onclick="startTowerGame(200)">Rs. 200</div>
<div class="gold-box" onclick="startTowerGame(300)">Rs. 300</div>
</div>
<div id="towerCountdown">Time: 0s</div>
<div id="towerScore">Score: 0</div>
<div class="tower-container" id="towerContainer"></div>
<div id="towerResult"></div>
</div>

<!-- Deposit Section -->
<div class="section" id="depositSection" style="display:none;">
<h2><i class="fas fa-money-bill-wave"></i> Deposit</h2>
<p style="color: var(--secondary);">Minimum deposit amount is Rs. 150. To deposit, please contact VIP users (verified with blue tick) or WhatsApp us at USCash WhatsApp channel</p>
<div class="form-group">
<label for="depositAmount">Amount (Rs.)</label>
<input type="number" id="depositAmount" min="150" placeholder="Minimum 150" />
</div>
<div class="form-group">
<label for="depositMethod">Payment Method</label>
<select id="depositMethod">
<option value="easypaisa">EasyPaisa</option>
<option value="jazzcash">JazzCash</option>
<option value="bank">Bank Transfer</option>
</select>
</div>
<div class="form-group">
<label for="transactionId">Transaction ID</label>
<input type="text" id="transactionId" placeholder="Enter transaction reference" />
</div>
<button class="submit-btn" onclick="submitDeposit()">Submit Deposit Request</button>

<div class="transaction-history" id="depositHistory">
<h3><i class="fas fa-history"></i> Deposit History</h3>
<!-- Will be populated by JavaScript -->
</div>
</div>

<!-- Withdraw Section -->
<div class="section" id="withdrawSection" style="display:none;">
<h2><i class="fas fa-wallet"></i> Withdraw</h2>
<p style="color: var(--secondary);">Minimum withdrawal amount is Rs. 300. You can only submit one request every 4 hours.</p>
<div class="form-group">
<label for="withdrawAmount">Amount (Rs.)</label>
<input type="number" id="withdrawAmount" min="300" placeholder="Minimum 300" />
</div>
<div class="form-group">
<label for="withdrawMethod">Payment Method</label>
<select id="withdrawMethod">
<option value="easypaisa">EasyPaisa</option>
<option value="jazzcash">JazzCash</option>
<option value="bank">Bank Transfer</option>
</select>
</div>
<div class="form-group">
<label for="accountNumber">Account Number</label>
<input type="text" id="accountNumber" placeholder="Enter your account number" />
</div>
<div class="form-group">
<label for="accountName">Account Name</label>
<input type="text" id="accountName" placeholder="Enter account holder name" />
</div>
<button class="submit-btn" onclick="submitWithdraw()">Submit Withdrawal Request</button>

<div class="transaction-history" id="withdrawHistory">
<h3><i class="fas fa-history"></i> Withdrawal History</h3>
<!-- Will be populated by JavaScript -->
</div>
</div>

<!-- Watch and Earn Section -->
<div class="section" id="watchAndEarnSection" style="display:none;">
<h2><i class="fas fa-eye"></i> Watch & Earn</h2>
<p style="color: var(--secondary);">Pay Rs. 150 to unlock this section and watch ads to earn money. Each ad pays Rs. 1.25 after watching completely.</p>

<div id="watchAndEarnStatus">
<p>You need to pay Rs. 150 to unlock this section.</p>
<button class="submit-btn" onclick="unlockWatchAndEarn()">Unlock for Rs. 150</button>
</div>

<div id="watchAndEarnContent" style="display:none;">
<div class="ads-container" id="adsContainer">
<!-- Ads will be populated here -->
</div>
<div id="watchEarnings">Total Earnings: Rs. 0</div>
</div>
</div>

<!-- VIP Section -->
<div class="section" id="vipSection" style="display:none;">
<h2><i class="fas fa-crown"></i> VIP Program</h2>
<p style="color: var(--secondary);">Earn money by referring friends! When a user refers someone, the referral must make their first deposit. Only then will the referring user receive 5% of the referral's next withdrawal amount.</p>

<div class="referral-stats">
<div class="stat-box">
<div class="stat-label">Total Referrals</div>
<div class="stat-value" id="referralCount">0</div>
</div>
<div class="stat-box">
<div class="stat-label">Your Earnings</div>
<div class="stat-value" id="referralEarnings">Rs. 0</div>
</div>
<div class="stat-box">
<div class="stat-label">VIP Status</div>
<div class="stat-value" id="vipStatus">Basic</div>
</div>
</div>

<h3><i class="fas fa-user-plus"></i> Your Referral Code</h3>
<div class="referral-code" id="userReferralCode">
Login to see your code
<i class="far fa-copy referral-code-copy" onclick="copyReferralCode()" title="Copy to clipboard" style="display:none;"></i>
</div>

<h3><i class="fas fa-info-circle"></i> How It Works</h3>
<ol style="text-align: left; padding-left: 20px;">
<li>Share your unique referral code with friends</li>
<li>They sign up using your code and make their first deposit</li>
<li>You earn <b>5% of their next withdrawal amount</b></li>
<li>Withdraw your earnings anytime</li>
<li>Reach higher VIP levels for more benefits</li>
</ol>

<button class="submit-btn" onclick="shareReferralCode()" style="margin-top: 20px;">
<i class="fas fa-share-alt"></i> Share Your Referral Code
</button>
</div>

<!-- More Section -->
<div class="section" id="moreSection" style="display:none;">
<h2><i class="fas fa-ellipsis-h"></i> More</h2>

<h3><i class="fas fa-clock"></i> Withdrawal Request Status</h3>
<div class="transaction-history" id="withdrawStatus">
<!-- Will be populated by JavaScript -->
</div>

<h3><i class="fas fa-exchange-alt"></i> Transaction History</h3>
<div class="transaction-history" id="fullTransactionHistory">
<!-- Will be populated by JavaScript -->
</div>

<button class="submit-btn" onclick="refreshAllData()" style="margin-top: 20px;">
<i class="fas fa-sync-alt"></i> Refresh All Data
</button>
</div>

<audio id="bgMusic" loop>
<source src="https://cdn.pixabay.com/audio/2023/03/16/audio_98b541c254.mp3" type="audio/mp3">
</audio>
<audio id="flipSound">
<source src="https://cdn.pixabay.com/download/audio/2022/10/03/audio_07d4930c1c.mp3" type="audio/mp3">
</audio>
<audio id="winSound">
<source src="https://cdn.pixabay.com/download/audio/2022/03/21/audio_5a9f1d8e6b.mp3" type="audio/mp3">
</audio>
<audio id="loseSound">
<source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_0d8d2a5c8a.mp3" type="audio/mp3">
</audio>
<audio id="shotSound">
<source src="https://cdn.pixabay.com/download/audio/2023/08/19/audio_5a9f1d8e6b.mp3" type="audio/mp3">
</audio>
<audio id="placeSound">
<source src="https://cdn.pixabay.com/download/audio/2022/10/25/audio_450f3cbc2b.mp3" type="audio/mp3">
</audio>

<!-- Firebase SDK -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, where, getDocs, orderBy, limit, onSnapshot, increment } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBM7DY6i11IPk8DAvVA6tsgmz7Epi5bJh0",
    authDomain: "pakcashplay.firebaseapp.com",
    projectId: "pakcashplay",
    storageBucket: "pakcashplay.firebasestorage.app",
    messagingSenderId: "551195851632",
    appId: "1:551195851632:web:4dcf6a8fb36d82e6a6adb5"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore();

  // Game variables
  let balance = 0;
  let selectedBet = null;
  let gameStarted = false;
  let currentUser = null;
  let lastWithdrawRequestTime = 0;

  // Initialize games when DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    checkAuthState();
    setupGames();
    showTerms(); // Show terms and conditions on first load

    // Show welcome popup on first visit
    if (!localStorage.getItem('welcomeShown')) {
      document.getElementById('welcomePopup').style.display = 'flex';
      localStorage.setItem('welcomeShown', 'true');
    }
  });

  // Authentication functions
  function checkAuthState() {
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        document.getElementById('authButtons').style.display = 'none';
        document.getElementById('logoutButton').style.display = 'block';
        document.getElementById('userDisplay').style.display = 'flex';
        loadUserData();
      } else {
        currentUser = null;
        document.getElementById('authButtons').style.display = 'flex';
        document.getElementById('logoutButton').style.display = 'none';
        document.getElementById('userDisplay').style.display = 'none';
        showSection('home');
        // Reset balance display when logged out
        document.getElementById('balanceAmount').textContent = '0';
      }
    });
  }

  function showAuthModal(tab) {
    document.getElementById('authModal').style.display = 'flex';
    switchAuthTab(tab);
  }

  function hideAuthModal() {
    document.getElementById('authModal').style.display = 'none';
  }

  function switchAuthTab(tab) {
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));

    if (tab === 'login') {
      document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
      document.getElementById('loginForm').classList.add('active');
    } else if (tab === 'signup') {
      document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
      document.getElementById('signupForm').classList.add('active');
    }
  }

  function showForgotPassword() {
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
    document.getElementById('forgotPasswordForm').classList.add('active');
  }

  function backToLogin() {
    switchAuthTab('login');
  }

  function loginUser() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    if (!email || !password) {
      showToast('Please enter both email and password', 'error');
      return;
    }

    // Show loading state
    const loginBtn = document.querySelector('#loginForm button');
    loginBtn.disabled = true;
    loginBtn.textContent = 'Logging in...';

    signInWithEmailAndPassword(auth, email, password)
      .then(() => {
        hideAuthModal();
        showToast('Login successful! Welcome back.', 'success');

        // Update last login time
        if (currentUser) {
          updateDoc(doc(db, 'users', currentUser.uid), {
            lastLogin: new Date()
          });
        }
      })
      .catch(error => {
        let errorMessage = 'Login failed. ';
        switch(error.code) {
          case 'auth/user-not-found':
            errorMessage += 'No account found with this email.';
            break;
          case 'auth/wrong-password':
            errorMessage += 'Incorrect password.';
            break;
          case 'auth/invalid-email':
            errorMessage += 'The email address is invalid.';
            break;
          default:
            errorMessage += error.message;
        }
        showToast(errorMessage, 'error');
      })
      .finally(() => {
        // Reset button state
        loginBtn.disabled = false;
        loginBtn.textContent = 'Login';
      });
  }

  function signupUser() {
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('signupConfirmPassword').value;
    const name = document.getElementById('signupName').value;
    const phone = document.getElementById('signupPhone').value;
    const referralCode = document.getElementById('referralCode').value;

    // Validate all required fields
    if (!email || !password || !name || !phone) {
      showToast('Please fill in all required fields', 'error');
      return;
    }

    // Validate password match
    if (password !== confirmPassword) {
      showToast('Passwords do not match', 'error');
      return;
    }

    // Validate email format
    if (!validateEmail(email)) {
      showToast('Please enter a valid email address', 'error');
      return;
    }

    // Validate password length
    if (password.length < 6) {
      showToast('Password should be at least 6 characters', 'error');
      return;
    }

    // Show loading state
    const signupBtn = document.querySelector('#signupForm button');
    signupBtn.disabled = true;
    signupBtn.textContent = 'Creating account...';

    // Create user with Firebase Auth
    createUserWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        // Create user document in Firestore
        return setDoc(doc(db, 'users', userCredential.user.uid), {
          name: name,
          phone: phone,
          email: email,
          balance: 0, // No welcome bonus
          referralCode: generateReferralCode(),
          referredBy: referralCode || null,
          referralCount: 0,
          referralEarnings: 0,
          createdAt: new Date(),
          lastLogin: new Date(),
          depositCount: 0,
          watchAndEarnUnlocked: false,
          watchAndEarnEarnings: 0,
          termsAccepted: false
        });
      })
      .then(() => {
        // If referral code was provided, update the referrer's stats
        if (referralCode) {
          const usersRef = collection(db, 'users');
          const q = query(usersRef, where('referralCode', '==', referralCode));
          return getDocs(q)
            .then(querySnapshot => {
              if (!querySnapshot.empty) {
                const referrerId = querySnapshot.docs[0].id;
                return updateDoc(doc(db, 'users', referrerId), {
                  referralCount: increment(1)
                });
              }
            });
        }
      })
      .then(() => {
        // Success - hide modal and show welcome message
        hideAuthModal();
        showToast('Signup successful! Welcome to USCash.', 'success');

        // Reset form
        document.getElementById('signupForm').reset();
      })
      .catch(error => {
        // Handle specific errors
        let errorMessage = 'Signup failed. ';
        switch(error.code) {
          case 'auth/email-already-in-use':
            errorMessage += 'This email is already registered.';
            break;
          case 'auth/invalid-email':
            errorMessage += 'The email address is invalid.';
            break;
          case 'auth/weak-password':
            errorMessage += 'The password is too weak.';
            break;
          default:
            errorMessage += error.message;
        }
        showToast(errorMessage, 'error');
      })
      .finally(() => {
        // Reset button state
        signupBtn.disabled = false;
        signupBtn.textContent = 'Sign Up';
      });
  }

  // Helper function to validate email
  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  function resetPassword() {
    const email = document.getElementById('forgotEmail').value;

    if (!email) {
      showToast('Please enter your email', 'error');
      return;
    }

    sendPasswordResetEmail(auth, email)
      .then(() => {
        showToast('Password reset email sent! Please check your inbox.', 'success');
        backToLogin();
      })
      .catch(error => {
        showToast('Error sending reset email: ' + error.message, 'error');
      });
  }

  function logoutUser() {
    signOut(auth).then(() => {
      showSection('home');
      showToast('Logged out successfully', 'success');
      // Reset balance to zero when logging out
      balance = 0;
      document.getElementById('balanceAmount').textContent = '0';
    });
  }

  function generateReferralCode() {
    return Math.random().toString(36).substring(2, 8).toUpperCase();
  }

  function copyReferralCode() {
    const referralCode = document.getElementById('userReferralCode').textContent;
    navigator.clipboard.writeText(referralCode)
      .then(() => {
        showToast('Referral code copied to clipboard!', 'success');
      })
      .catch(err => {
        console.error('Failed to copy: ', err);
      });
  }

  function shareReferralCode() {
    const referralCode = document.getElementById('userReferralCode').textContent;
    const shareText = `Join USCash and use my referral code: ${referralCode} to get bonus rewards!`;

    if (navigator.share) {
      navigator.share({
        title: 'USCash Referral',
        text: shareText,
        url: window.location.href
      })
      .catch(err => {
        console.error('Error sharing:', err);
        fallbackShare(referralCode, shareText);
      });
    } else {
      fallbackShare(referralCode, shareText);
    }
  }

  function fallbackShare(referralCode, shareText) {
    prompt('Copy your referral code to share:', shareText);
  }

  // User data functions
  function loadUserData() {
    if (!currentUser) return;

    const unsubscribe = onSnapshot(doc(db, 'users', currentUser.uid), (doc) => {
      if (doc.exists()) {
        const userData = doc.data();
        balance = userData.balance || 0;
        updateBalanceDisplay();

        // Update user display
        document.getElementById('usernameDisplay').textContent = userData.name || userData.email || 'User';
        document.getElementById('phoneDisplay').textContent = userData.phone || '';

        // Check if user is verified (cptanil1995@gmail.com or auk5562@gmail.com)
        if (userData.email === 'cptanil1995@gmail.com' || userData.email === 'auk5562@gmail.com' || userData.email === 'kafe2999@gmail.com') {
          document.getElementById('verifiedBadge').style.display = 'inline-block';
        }

        // Update VIP section if visible
        if (document.getElementById('vipSection').style.display === 'block') {
          document.getElementById('userReferralCode').textContent = userData.referralCode || 'N/A';
          document.getElementById('referralCount').textContent = userData.referralCount || 0;
          document.getElementById('referralEarnings').textContent = 'Rs. ' + (userData.referralEarnings || 0);

          // Show copy button if referral code exists
          if (userData.referralCode) {
            document.querySelector('.referral-code-copy').style.display = 'block';
          }

          // Set VIP status
          const referrals = userData.referralCount || 0;
          let vipStatus = 'Basic';
          if (referrals >= 25) vipStatus = 'VIP 5';
          else if (referrals >= 15) vipStatus = 'VIP 4';
          else if (referrals >= 10) vipStatus = 'VIP 3';
          else if (referrals >= 5) vipStatus = 'VIP 2';
          document.getElementById('vipStatus').textContent = vipStatus;
        }

        // Update Watch and Earn section
        if (userData.watchAndEarnUnlocked) {
          document.getElementById('watchAndEarnStatus').style.display = 'none';
          document.getElementById('watchAndEarnContent').style.display = 'block';
          document.getElementById('watchEarnings').textContent = 'Total Earnings: Rs. ' + (userData.watchAndEarnEarnings || 0);
          loadWatchAndEarnAds();
        }
      }
    });

    // Load transaction history
    loadTransactionHistory();
  }

  function refreshBalance() {
    if (currentUser) {
      getDoc(doc(db, 'users', currentUser.uid))
        .then(doc => {
          if (doc.exists()) {
            balance = doc.data().balance || 0;
            updateBalanceDisplay();
            showToast('Balance refreshed!', 'success');
          }
        });
    }
  }

  function refreshAllData() {
    refreshBalance();
    loadTransactionHistory();
    showToast('All data refreshed!', 'success');
  }

  function updateBalanceDisplay() {
    document.getElementById('balanceAmount').textContent = Math.floor(balance);
  }

  // Toast notification function
  function showToast(message, type = 'info') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = 'toast';
    toast.classList.add('show');
    toast.style.borderLeftColor = type === 'success' ? 'lime' : type === 'error' ? 'red' : 'var(--primary)';
    
    setTimeout(() => {
      toast.classList.remove('show');
    }, 3000);
  }

  // Transaction functions
  function submitDeposit() {
    if (!currentUser) {
      showToast('Please login to deposit', 'error');
      return;
    }

    const amount = parseFloat(document.getElementById('depositAmount').value);
    const method = document.getElementById('depositMethod').value;
    const transactionId = document.getElementById('transactionId').value;

    if (isNaN(amount) || amount < 150) {
      showToast('Minimum deposit amount is Rs. 150', 'error');
      return;
    }

    if (!transactionId) {
      showToast('Please enter transaction ID', 'error');
      return;
    }

    // Add deposit request
    addDoc(collection(db, 'deposit_requests'), {
      userId: currentUser.uid,
      amount: amount,
      method: method,
      transactionId: transactionId,
      status: 'pending',
      createdAt: new Date()
    })
      .then(() => {
        // Update user balance
        return updateDoc(doc(db, 'users', currentUser.uid), {
          balance: increment(amount),
          depositCount: increment(1)
        });
      })
      .then(() => {
        // Check if user was referred by someone and update their earnings (5% of first 5 deposits)
        return getDoc(doc(db, 'users', currentUser.uid))
          .then(doc => {
            const userData = doc.data();
            if (userData.referredBy && userData.depositCount <= 5) {
              const usersRef = collection(db, 'users');
              const q = query(usersRef, where('referralCode', '==', userData.referredBy));
              return getDocs(q)
                .then(querySnapshot => {
                  if (!querySnapshot.empty) {
                    const referrerId = querySnapshot.docs[0].id;
                    const referralEarnings = amount * 0.05; // 5% of deposit
                    return updateDoc(doc(db, 'users', referrerId), {
                      referralEarnings: increment(referralEarnings)
                    });
                  }
                });
            }
          });
      })
      .then(() => {
        showToast('Deposit request submitted successfully! Rs. ' + amount + ' added to your balance.', 'success');
        document.getElementById('depositAmount').value = '';
        document.getElementById('transactionId').value = '';
        loadTransactionHistory();
      })
      .catch(error => {
        showToast('Error submitting deposit: ' + error.message, 'error');
      });
  }

  function submitWithdraw() {
    if (!currentUser) {
      showToast('Please login to withdraw', 'error');
      return;
    }

    const amount = parseFloat(document.getElementById('withdrawAmount').value);
    const method = document.getElementById('withdrawMethod').value;
    const accountNumber = document.getElementById('accountNumber').value;
    const accountName = document.getElementById('accountName').value;

    if (isNaN(amount) || amount < 300) {
      showToast('Minimum withdrawal amount is Rs. 300', 'error');
      return;
    }

    if (amount > balance) {
      showToast('Insufficient balance', 'error');
      return;
    }

    if (!accountNumber || !accountName) {
      showToast('Please enter account details', 'error');
      return;
    }

    // Check if 4 hours have passed since last request
    const now = Date.now();
    if (now - lastWithdrawRequestTime < 4 * 60 * 60 * 1000) {
      const hoursLeft = Math.ceil((4 * 60 * 60 * 1000 - (now - lastWithdrawRequestTime)) / (60 * 60 * 1000));
      showToast(`You can only submit one withdrawal request every 4 hours. Please wait ${hoursLeft.toFixed(1)} more hours.`, 'error');
      return;
    }

    // Deduct amount from balance immediately
    updateDoc(doc(db, 'users', currentUser.uid), {
      balance: increment(-amount)
    })
      .then(() => {
        // Add withdrawal request
        return addDoc(collection(db, 'withdraw_requests'), {
          userId: currentUser.uid,
          amount: amount,
          method: method,
          accountNumber: accountNumber,
          accountName: accountName,
          status: 'pending',
          createdAt: new Date()
        });
      })
      .then(() => {
        lastWithdrawRequestTime = Date.now();
        showToast('Withdrawal request submitted successfully! It will be processed within 24 hours.', 'success');
        document.getElementById('withdrawAmount').value = '';
        document.getElementById('accountNumber').value = '';
        document.getElementById('accountName').value = '';
        loadTransactionHistory();

        // Check if user was referred by someone and give 5% of withdrawal to referrer
        return getDoc(doc(db, 'users', currentUser.uid))
          .then(doc => {
            const userData = doc.data();
            if (userData.referredBy) {
              const usersRef = collection(db, 'users');
              const q = query(usersRef, where('referralCode', '==', userData.referredBy));
              return getDocs(q)
                .then(querySnapshot => {
                  if (!querySnapshot.empty) {
                    const referrerId = querySnapshot.docs[0].id;
                    const referralEarnings = amount * 0.05; // 5% of withdrawal
                    return updateDoc(doc(db, 'users', referrerId), {
                      referralEarnings: increment(referralEarnings)
                    });
                  }
                });
            }
          });
      })
      .catch(error => {
        showToast('Error submitting withdrawal: ' + error.message, 'error');
      });
  }

  function loadTransactionHistory() {
    if (!currentUser) return;

    // Load deposit history
    const depositQuery = query(
      collection(db, 'deposit_requests'),
      where('userId', '==', currentUser.uid),
      orderBy('createdAt', 'desc'),
      limit(10)
    );

    getDocs(depositQuery)
      .then(querySnapshot => {
        const depositHistory = document.getElementById('depositHistory');
        depositHistory.innerHTML = '<h3><i class="fas fa-history"></i> Deposit History</h3>';

        if (querySnapshot.empty) {
          depositHistory.innerHTML += '<p>No deposit history found</p>';
          return;
        }

        querySnapshot.forEach(doc => {
          const data = doc.data();
          const item = document.createElement('div');
          item.className = 'transaction-item';

          let statusClass = 'transaction-pending';
          if (data.status === 'approved') statusClass = 'transaction-approved';
          if (data.status === 'rejected') statusClass = 'transaction-rejected';

          item.innerHTML = `
            <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
            <div>Method: ${data.method}</div>
            <div>Status: <span class="${statusClass}">${data.status}</span></div>
            <div>Date: ${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
          `;

          depositHistory.appendChild(item);
        });
      });

    // Load withdrawal history
    const withdrawQuery = query(
      collection(db, 'withdraw_requests'),
      where('userId', '==', currentUser.uid),
      orderBy('createdAt', 'desc'),
      limit(10)
    );

    getDocs(withdrawQuery)
      .then(querySnapshot => {
        const withdrawHistory = document.getElementById('withdrawHistory');
        withdrawHistory.innerHTML = '<h3><i class="fas fa-history"></i> Withdrawal History</h3>';

        if (querySnapshot.empty) {
          withdrawHistory.innerHTML += '<p>No withdrawal history found</p>';
          return;
        }

        querySnapshot.forEach(doc => {
          const data = doc.data();
          const item = document.createElement('div');
          item.className = 'transaction-item';

          let statusClass = 'transaction-pending';
          if (data.status === 'approved') statusClass = 'transaction-approved';
          if (data.status === 'rejected') statusClass = 'transaction-rejected';

          item.innerHTML = `
            <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
            <div>Method: ${data.method}</div>
            <div>Status: <span class="${statusClass}">${data.status}</span></div>
            <div>Date: ${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
          `;

          withdrawHistory.appendChild(item);
        });
      });

    // Load withdrawal status for "More" section
    getDocs(withdrawQuery)
      .then(querySnapshot => {
        const withdrawStatus = document.getElementById('withdrawStatus');
        withdrawStatus.innerHTML = '';

        if (querySnapshot.empty) {
          withdrawStatus.innerHTML = '<p>No withdrawal requests found</p>';
          return;
        }

        querySnapshot.forEach(doc => {
          const data = doc.data();
          const item = document.createElement('div');
          item.className = 'transaction-item';

          let statusClass = 'transaction-pending';
          if (data.status === 'approved') statusClass = 'transaction-approved';
          if (data.status === 'rejected') statusClass = 'transaction-rejected';

          item.innerHTML = `
            <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
            <div>Status: <span class="${statusClass}">${data.status}</span></div>
            <div>Date: ${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
          `;

          withdrawStatus.appendChild(item);
        });
      });

    // Load full transaction history
    const fullHistory = document.getElementById('fullTransactionHistory');
    fullHistory.innerHTML = '';

    // Combine deposits and withdrawals for full history
    Promise.all([
      getDocs(depositQuery),
      getDocs(withdrawQuery)
    ])
      .then(([deposits, withdrawals]) => {
        const allTransactions = [];

        deposits.forEach(doc => {
          const data = doc.data();
          allTransactions.push({
            type: 'deposit',
            amount: data.amount,
            status: data.status,
            date: data.createdAt,
            method: data.method
          });
        });

        withdrawals.forEach(doc => {
          const data = doc.data();
          allTransactions.push({
            type: 'withdrawal',
            amount: data.amount,
            status: data.status,
            date: data.createdAt,
            method: data.method
          });
        });

        // Sort by date
        allTransactions.sort((a, b) => (b.date?.seconds || 0) - (a.date?.seconds || 0));

        if (allTransactions.length === 0) {
          fullHistory.innerHTML = '<p>No transaction history found</p>';
          return;
        }

        allTransactions.forEach(trans => {
          const item = document.createElement('div');
          item.className = 'transaction-item';

          let statusClass = 'transaction-pending';
          if (trans.status === 'approved') statusClass = 'transaction-approved';
          if (trans.status === 'rejected') statusClass = 'transaction-rejected';

          item.innerHTML = `
            <div>Type: ${trans.type === 'deposit' ? 'Deposit' : 'Withdrawal'}</div>
            <div>Amount: <span class="transaction-amount">Rs. ${trans.amount}</span></div>
            <div>Method: ${trans.method}</div>
            <div>Status: <span class="${statusClass}">${trans.status}</span></div>
            <div>Date: ${trans.date?.toDate().toLocaleString() || 'N/A'}</div>
          `;

          fullHistory.appendChild(item);
        });
      });
  }

  // Watch and Earn functions
  function unlockWatchAndEarn() {
    if (!currentUser) {
      showToast('Please login first', 'error');
      return;
    }

    if (balance < 150) {
      showToast('Insufficient balance to unlock Watch & Earn', 'error');
      return;
    }

    // Deduct 150 from balance
    updateDoc(doc(db, 'users', currentUser.uid), {
      balance: increment(-150),
      watchAndEarnUnlocked: true,
      watchAndEarnUnlockDate: new Date()
    })
      .then(() => {
        showToast('Watch & Earn unlocked successfully!', 'success');
        document.getElementById('watchAndEarnStatus').style.display = 'none';
        document.getElementById('watchAndEarnContent').style.display = 'block';
        loadWatchAndEarnAds();
      })
      .catch(error => {
        showToast('Error unlocking Watch & Earn: ' + error.message, 'error');
      });
  }

  function loadWatchAndEarnAds() {
    if (!currentUser) return;

    getDoc(doc(db, 'users', currentUser.uid))
      .then(doc => {
        if (doc.exists()) {
          const userData = doc.data();
          if (!userData.watchAndEarnUnlocked) return;

          const adsContainer = document.getElementById('adsContainer');
          adsContainer.innerHTML = '';

          // Create 10 ads
          for (let i = 1; i <= 10; i++) {
            const adItem = document.createElement('div');
            adItem.className = 'ad-item';
            adItem.innerHTML = `
              <img src="https://placehold.co/300x200/222/fff?text=Ad+${i}" alt="Ad ${i}">
              <h4>Advertisement ${i}</h4>
              <p>Watch this ad to earn Rs. 1.25</p>
              <div class="ad-status" id="adStatus${i}">Click to watch</div>
            `;
            adItem.onclick = () => watchAd(i);
            adsContainer.appendChild(adItem);
          }
        }
      });
  }

  function watchAd(adId) {
    if (!currentUser) return;

    // Check if ad is already watched
    const adStatus = document.getElementById(`adStatus${adId}`);
    if (adStatus.textContent === 'Completed') {
      showToast('You have already watched this ad', 'info');
      return;
    }

    // Show ad watching process
    adStatus.textContent = 'Watching...';
    
    // Simulate ad watching (5 seconds)
    setTimeout(() => {
      // Add earnings
      updateDoc(doc(db, 'users', currentUser.uid), {
        watchAndEarnEarnings: increment(1.25),
        balance: increment(1.25)
      })
        .then(() => {
          adStatus.textContent = 'Completed';
          showToast('Ad watched successfully! Rs. 1.25 added to your balance.', 'success');
          refreshBalance();
        })
        .catch(error => {
          adStatus.textContent = 'Click to watch';
          showToast('Error watching ad: ' + error.message, 'error');
        });
    }, 5000);
  }

  // Navigation functions
  function showSection(section) {
    document.querySelectorAll('.section').forEach(sec => {
      sec.style.display = 'none';
    });

    switch(section) {
      case 'home':
        document.getElementById('homeSection').style.display = 'block';
        break;
      case 'deposit':
        if (!currentUser) {
          showAuthModal('login');
          return;
        }
        document.getElementById('depositSection').style.display = 'block';
        break;
      case 'withdraw':
        if (!currentUser) {
          showAuthModal('login');
          return;
        }
        document.getElementById('withdrawSection').style.display = 'block';
        break;
      case 'watchAndEarn':
        if (!currentUser) {
          showAuthModal('login');
          return;
        }
        document.getElementById('watchAndEarnSection').style.display = 'block';
        break;
      case 'vip':
        if (!currentUser) {
          showAuthModal('login');
          return;
        }
        document.getElementById('vipSection').style.display = 'block';
        // Load VIP data if not already loaded
        if (document.getElementById('userReferralCode').textContent === 'Login to see your code') {
          loadUserData();
        }
        break;
      case 'more':
        if (!currentUser) {
          showAuthModal('login');
          return;
        }
        document.getElementById('moreSection').style.display = 'block';
        loadTransactionHistory();
        break;
    }
  }

  // Side menu functions
  function toggleMenu() {
    const menuContent = document.getElementById('menuContent');
    menuContent.style.display = menuContent.style.display === 'block' ? 'none' : 'block';
  }

  function contactSupport() {
    window.open('mailto:uscash4@gmail.com', '_blank');
    toggleMenu();
  }

  function showAnnouncements() {
    showToast('No new announcements', 'info');
    toggleMenu();
  }

  function showSocialMedia() {
    showToast('Social media links coming soon', 'info');
    toggleMenu();
  }

  function showTerms() {
    document.getElementById('termsModal').style.display = 'flex';
  }

  function hideTerms() {
    document.getElementById('termsModal').style.display = 'none';
  }

  function acceptTerms() {
    if (!currentUser) {
      showToast('Please login first', 'error');
      return;
    }

    updateDoc(doc(db, 'users', currentUser.uid), {
      termsAccepted: true
    })
      .then(() => {
        hideTerms();
        showToast('Terms accepted successfully', 'success');
      })
      .catch(error => {
        showToast('Error accepting terms: ' + error.message, 'error');
      });
  }

  // Game setup
  function setupGames() {
    setupScratchGame();
    setupFruitGame();
    setupTicTacToeGame();
    setupFindAceGame();
    setupArcheryGame();
    setupImpossibleTowerGame();
  }

  // Scratch Game
  let icons = ['üêÑ', 'üêî', 'üê±', 'üê∂', 'üê≠'];
  let cardData = [];
  let flippedCards = [];
  let scratchChances = 4;

  function setupScratchGame() {
    icons = ['üêÑ', 'üêî', 'üê±', 'üê∂', 'üê≠'];
    cardData = [];
    flippedCards = [];
    scratchChances = 4;
  }

  function startCardGame() {
    if (!currentUser) {
      showAuthModal('login');
      return;
    }
    document.getElementById('scratchGame').style.display = 'block';
    document.getElementById('fruitGame').style.display = 'none';
    document.getElementById('tictactoeGame').style.display = 'none';
    document.getElementById('findAceGame').style.display = 'none';
    document.getElementById('archeryGame').style.display = 'none';
    document.getElementById('impossibleTowerGame').style.display = 'none';
    bgMusic.play().catch(() => {});
    setupCards();
  }

  function setupCards() {
    flippedCards = [];
    cardData = [];
    gameStarted = false;
    const grid = document.getElementById('cardGrid');
    grid.classList.remove('shake', 'glow');
    grid.innerHTML = '';
    document.getElementById("particles-js").style.display = "none";
    document.getElementById("result").innerText = '';

    // 9 cards with 3 sets of identical icons
    let allIcons = [];
    for (let i = 0; i < 3; i++) {
      // Select 3 random icons
      const randomIcons = [...icons].sort(() => 0.5 - Math.random()).slice(0, 3);
      randomIcons.forEach(icon => allIcons.push(icon));
    }

    allIcons.forEach((icon) => {
      const card = document.createElement('div');
      card.classList.add('card');
      card.dataset.icon = icon;
      grid.appendChild(card);
      cardData.push({ element: card, icon: icon });
    });
  }

  function selectBet(amount) {
    if (gameStarted) return;
    selectedBet = amount;
    document.querySelectorAll('#scratchGame .bet-amounts .gold-box').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    // Deduct bet amount immediately
    if (balance < amount) {
      showToast('Insufficient balance! Please deposit more to play.', 'error');
      return;
    }
    balance -= amount;
    updateUserBalance(balance);
    updateBalanceDisplay();
    revealAndShuffleCards();
  }

  function revealAndShuffleCards() {
    const grid = document.getElementById('cardGrid');
    setupCards();

    cardData.forEach(data => {
      data.element.innerText = data.icon;
      data.element.classList.add('flipped');
    });

    setTimeout(() => {
      // Shuffle
      cardData.sort(() => Math.random() - 0.5);
      grid.innerHTML = '';
      cardData.forEach(data => {
        data.element.innerText = '';
        data.element.classList.remove('flipped');
        data.element.onclick = () => flipCard(data.element);
        grid.appendChild(data.element);
      });
    }, 2000);
  }

  function flipCard(card) {
    if (!selectedBet) {
      showToast("Please select a bet amount before starting!", 'error');
      return;
    }
    if (flippedCards.includes(card) || flippedCards.length >= scratchChances) return;
    if (!gameStarted) gameStarted = true;

    card.classList.add('flipped');
    card.innerText = card.dataset.icon;
    flipSound.currentTime = 0;
    flipSound.play().catch(() => {});
    flippedCards.push(card);

    if (flippedCards.length === scratchChances) {
      setTimeout(checkWin, 1000);
    }
  }

  function checkWin() {
    const iconsPicked = flippedCards.map(c => c.dataset.icon);
    const counts = {};
    iconsPicked.forEach(icon => counts[icon] = (counts[icon] || 0) + 1);

    // Need 3 matching icons to win (20% chance)
    const won = Math.random() < 0.2;
    const result = document.getElementById('result');
    const grid = document.getElementById('cardGrid');

    if (won) {
      const winAmount = selectedBet * 2;
      balance += winAmount;
      updateUserBalance(balance);
      result.innerText = `üéâ You won! Rs. ${winAmount} added.`;
      grid.classList.add('glow');
      document.getElementById("particles-js").style.display = "block";
      document.getElementById('winSound').play().catch(() => {});
      setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
    } else {
      result.innerText = `‚ùå You lost! Rs. ${selectedBet} deducted.`;
      grid.classList.add('shake');
      document.getElementById('loseSound').play().catch(() => {});
    }

    updateBalanceDisplay();

    setTimeout(() => {
      result.innerText = '';
      setupCards();
      if (balance <= 0) {
        showToast("Your balance is too low. Please deposit to play again.", 'error');
        document.getElementById('scratchGame').style.display = 'none';
      }
    }, 2500);
  }

  function updateUserBalance(newBalance) {
    if (!currentUser) return;

    updateDoc(doc(db, 'users', currentUser.uid), {
      balance: newBalance
    })
      .catch(error => {
        console.error('Error updating balance:', error);
      });
  }

  // Fruit Game
  const colors = ["red", "green", "yellow", "blue", "purple"];
  const fruits = {
    red: "üçé",
    green: "üçè",
    yellow: "üçã",
    blue: "üçá",
    purple: "üçÜ"
  };
  const durations = {
    20: 8000,
    50: 15000,
    70: 20000,
    100: 30000,
    150: 45000,
    180: 50000,
    200: 60000,
    300: 80000
  };

  let targetColor = "";
  let fruitScore = 0;
  let fruitGameInterval, fruitGameTimer, fruitCountdownInterval;
  let fruitGameStarted = false;
  let fruitSelectedBet = 0;

  function setupFruitGame() {
    setNewFruitTarget();
  }

  function startFruitGame() {
    if (!currentUser) {
      showAuthModal('login');
      return;
    }
    document.getElementById('scratchGame').style.display = 'none';
    document.getElementById('fruitGame').style.display = 'block';
    document.getElementById('tictactoeGame').style.display = 'none';
    document.getElementById('findAceGame').style.display = 'none';
    document.getElementById('archeryGame').style.display = 'none';
    document.getElementById('impossibleTowerGame').style.display = 'none';
    setNewFruitTarget();
  }

  function setNewFruitTarget() {
    targetColor = colors[Math.floor(Math.random() * colors.length)];
    document.getElementById("fruitTargetDisplay").innerHTML = `Target: Shoot the <b style="color:${targetColor};">${targetColor.toUpperCase()}</b> Fruit ${fruits[targetColor]}`;
  }

  function spawnFruit() {
    const shootArea = document.getElementById("shootArea");
    if (shootArea.childElementCount >= 10) return;

    const fruit = document.createElement("div");
    fruit.classList.add("fruit");

    const isTarget = Math.random() < 0.40;
    const color = isTarget ? targetColor : colors[Math.floor(Math.random() * colors.length)];
    fruit.style.color = color;
    fruit.innerText = fruits[color];

    const size = Math.random() * 30 + 20;
    fruit.style.fontSize = `${size}px`;

    const x = Math.random() * (shootArea.clientWidth - 40);
    fruit.style.left = `${x}px`;
    fruit.style.top = "-30px";

    fruit.addEventListener("click", () => {
      if (!fruitGameStarted || fruit.clicked) return;
      fruit.clicked = true;

      if (color === targetColor) {
        fruitScore++;
      } else {
        fruitScore = Math.max(0, fruitScore - 2);
      }
      document.getElementById("fruitScoreDisplay").textContent = `Score: ${fruitScore}`;
      fruit.remove();
    });

    shootArea.appendChild(fruit);

    let top = -30;
    const fallSpeed = setInterval(() => {
      top += 15;
      fruit.style.top = `${top}px`;
      if (top > shootArea.clientHeight) {
        clearInterval(fallSpeed);
        fruit.remove();
      }
    }, 50);
  }

  function startFruitRound(amount) {
    if (fruitGameStarted || balance < amount) {
      if (balance < amount) {
        showToast("Insufficient balance! Please deposit more to play.", 'error');
      }
      return;
    }

    balance -= amount;
    updateUserBalance(balance);
    updateBalanceDisplay();

    document.getElementById("shootArea").innerHTML = "";
    clearInterval(fruitGameInterval);
    clearInterval(fruitCountdownInterval);
    clearTimeout(fruitGameTimer);
    fruitScore = 0;
    document.getElementById("fruitScoreDisplay").innerText = "Score: 0";
    setNewFruitTarget();

    fruitSelectedBet = amount;
    fruitGameStarted = true;

    document.querySelectorAll('#fruitGame .bet-amounts .gold-box').forEach(btn => {
      btn.style.pointerEvents = "none";
      btn.style.opacity = "0.4";
    });

    let timeLeft = durations[amount] / 1000;
    document.getElementById("fruitCountdown").innerText = `Time: ${timeLeft}s`;

    fruitCountdownInterval = setInterval(() => {
      timeLeft--;
      document.getElementById("fruitCountdown").innerText = `Time: ${timeLeft}s`;
      if (timeLeft <= 0) clearInterval(fruitCountdownInterval);
    }, 1000);

    fruitGameInterval = setInterval(spawnFruit, 200);

    fruitGameTimer = setTimeout(() => {
      clearInterval(fruitGameInterval);
      clearInterval(fruitCountdownInterval);
      fruitGameStarted = false;

      let winAmount = 0;
      // 20% chance to win
      if (Math.random() < 0.2) {
        winAmount = fruitSelectedBet * 2;
        balance += winAmount;
        updateUserBalance(balance);
        showToast(`üéâ Congratulations! You scored ${fruitScore} points.\nYou won Rs. ${winAmount}!`, 'success');
        document.getElementById('winSound').play().catch(() => {});
      } else {
        showToast(`‚ùå Game Over! You scored ${fruitScore} points.\nYou lost your bet of Rs. ${fruitSelectedBet}.`, 'error');
        document.getElementById('loseSound').play().catch(() => {});
      }

      updateBalanceDisplay();

      document.querySelectorAll('#fruitGame .bet-amounts .gold-box').forEach(btn => {
        btn.style.pointerEvents = "auto";
        btn.style.opacity = "1";
      });

      document.getElementById("shootArea").innerHTML = "";
      document.getElementById("fruitScoreDisplay").innerText = "";
      document.getElementById("fruitCountdown").innerText = "Time: 0s";
      setNewFruitTarget();

    }, durations[amount]);
  }

  // Tic Tac Toe Game
  let ticTacToeBoard = ['', '', '', '', '', '', '', '', ''];
  let currentPlayer = 'X';
  let ticTacToeGameActive = false;
  let ticTacToeBetAmount = 0;
  let ticTacToeCountdown = 30;
  let ticTacToeTimer;
  let computerMoveCount = 0;

  function setupTicTacToeGame() {
    ticTacToeBoard = ['', '', '', '', '', '', '', '', ''];
    currentPlayer = 'X';
    computerMoveCount = 0;
  }

  function startTicTacToeGame() {
    if (!currentUser) {
      showAuthModal('login');
      return;
    }
    document.getElementById('scratchGame').style.display = 'none';
    document.getElementById('fruitGame').style.display = 'none';
    document.getElementById('tictactoeGame').style.display = 'block';
    document.getElementById('findAceGame').style.display = 'none';
    document.getElementById('archeryGame').style.display = 'none';
    document.getElementById('impossibleTowerGame').style.display = 'none';
    setupTicTacToeGame();
    renderTicTacToeBoard();
  }

  function selectTicTacToeBet(amount) {
    if (ticTacToeGameActive) return;

    if (balance < amount) {
      showToast("Insufficient balance! Please deposit more to play.", 'error');
      return;
    }

    ticTacToeBetAmount = amount;
    document.querySelectorAll('#tictactoeGame .bet-amounts .gold-box').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');

    startTicTacToeRound();
  }

  function startTicTacToeRound() {
    ticTacToeGameActive = true;
    currentPlayer = 'X';
    ticTacToeBoard = ['', '', '', '', '', '', '', '', ''];
    ticTacToeCountdown = 30;
    computerMoveCount = 0;

    balance -= ticTacToeBetAmount;
    updateUserBalance(balance);
    updateBalanceDisplay();

    document.getElementById('tictactoeCountdown').textContent = `Time: ${ticTacToeCountdown}s`;
    ticTacToeTimer = setInterval(() => {
      ticTacToeCountdown--;
      document.getElementById('tictactoeCountdown').textContent = `Time: ${ticTacToeCountdown}s`;

      if (ticTacToeCountdown <= 0) {
        clearInterval(ticTacToeTimer);
        endTicTacToeGame(false, "Time's up! Game ended in a draw.");
      }
    }, 1000);

    renderTicTacToeBoard();
    document.getElementById('tictactoeResult').textContent = "Your turn (X)";
  }

  function renderTicTacToeBoard() {
    const boardElement = document.getElementById('ticTacToeBoard');
    boardElement.innerHTML = '';

    for (let i = 0; i < 9; i++) {
      const cell = document.createElement('div');
      cell.className = 'tic-tac-toe-cell';
      cell.textContent = ticTacToeBoard[i];
      cell.onclick = () => makeTicTacToeMove(i);
      boardElement.appendChild(cell);
    }
  }

  function makeTicTacToeMove(index) {
    if (!ticTacToeGameActive || ticTacToeBoard[index] !== '' || currentPlayer !== 'X') return;

    ticTacToeBoard[index] = 'X';
    renderTicTacToeBoard();

    if (checkTicTacToeWin('X')) {
      endTicTacToeGame(true, "You won! Rs. " + (ticTacToeBetAmount * 2) + " added to your balance.");
      return;
    }

    if (!ticTacToeBoard.includes('')) {
      endTicTacToeGame(false, "Game ended in a draw. You lost 25% of your bet.");
      return;
    }

    document.getElementById('tictactoeResult').textContent = "Computer thinking...";

    setTimeout(() => {
      // Make computer move harder
      let move = findWinningMove('O');
      if (move === -1) {
        move = findWinningMove('X');
        if (move === -1) {
          const emptyCells = [];
          for (let i = 0; i < 9; i++) {
            if (ticTacToeBoard[i] === '') emptyCells.push(i);
          }

          // Make computer play optimally
          const corners = [0, 2, 6, 8];
          const edges = [1, 3, 5, 7];
          const center = 4;

          // Always take center if available
          if (ticTacToeBoard[center] === '') {
            move = center;
          } else {
            // Take corners first, then edges
            const availableCorners = corners.filter(cell => ticTacToeBoard[cell] === '');
            if (availableCorners.length > 0) {
              move = availableCorners[Math.floor(Math.random() * availableCorners.length)];
            } else {
              move = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            }
          }
        }
      }

      ticTacToeBoard[move] = 'O';
      computerMoveCount++;
      renderTicTacToeBoard();

      if (checkTicTacToeWin('O')) {
        endTicTacToeGame(false, "Computer won! You lost your bet.");
        return;
      }

      if (!ticTacToeBoard.includes('')) {
        endTicTacToeGame(false, "Game ended in a draw. You lost 25% of your bet.");
        return;
      }

      document.getElementById('tictactoeResult').textContent = "Your turn (X)";
    }, 1000);
  }

  function findWinningMove(player) {
    const winPatterns = [
      [0, 1, 2], [3, 4, 5], [6, 7, 8],
      [0, 3, 6], [1, 4, 7], [2, 5, 8],
      [0, 4, 8], [2, 4, 6]
    ];

    for (const pattern of winPatterns) {
      const [a, b, c] = pattern;
      if (ticTacToeBoard[a] === player && ticTacToeBoard[b] === player && ticTacToeBoard[c] === '') return c;
      if (ticTacToeBoard[a] === player && ticTacToeBoard[c] === player && ticTacToeBoard[b] === '') return b;
      if (ticTacToeBoard[b] === player && ticTacToeBoard[c] === player && ticTacToeBoard[a] === '') return a;
    }

    return -1;
  }

  function checkTicTacToeWin(player) {
    const winPatterns = [
      [0, 1, 2], [3, 4, 5], [6, 7, 8],
      [0, 3, 6], [1, 4, 7], [2, 5, 8],
      [0, 4, 8], [2, 4, 6]
    ];

    return winPatterns.some(pattern => {
      return pattern.every(index => ticTacToeBoard[index] === player);
    });
  }

  function endTicTacToeGame(playerWon, message) {
    clearInterval(ticTacToeTimer);
    ticTacToeGameActive = false;

    if (playerWon) {
      const winAmount = ticTacToeBetAmount * 2;
      balance += winAmount;
      document.getElementById('winSound').play().catch(() => {});
    } else {
      const deduction = ticTacToeBetAmount * 0.25;
      balance -= deduction;
      document.getElementById('loseSound').play().catch(() => {});
    }

    updateUserBalance(balance);
    updateBalanceDisplay();

    document.getElementById('tictactoeResult').textContent = message;
    document.querySelectorAll('#tictactoeGame .bet-amounts .gold-box').forEach(btn => {
      btn.classList.remove('active');
    });

    if (playerWon) {
      document.getElementById("particles-js").style.display = "block";
      setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
    }
  }

  // Find Ace Game
  let findAceCards = ['K', 'Q', 'A'];
  let findAceFlippedCards = [];
  let findAceGameActive = false;
  let findAceBetAmount = 0;
  let findAceTimer;
  let findAceCountdown = 15;
  let findAceShuffling = false;

  function setupFindAceGame() {
    findAceCards = ['K', 'Q', 'A'];
  }

  function startFindAceGame() {
    if (!currentUser) {
      showAuthModal('login');
      return;
    }
    document.getElementById('scratchGame').style.display = 'none';
    document.getElementById('fruitGame').style.display = 'none';
    document.getElementById('tictactoeGame').style.display = 'none';
    document.getElementById('findAceGame').style.display = 'block';
    document.getElementById('archeryGame').style.display = 'none';
    document.getElementById('impossibleTowerGame').style.display = 'none';
    setupFindAceGame();
  }

  function startFindAceRound(amount) {
    if (findAceGameActive || balance < amount) {
      if (balance < amount) {
        showToast("Insufficient balance! Please deposit more to play.", 'error');
      }
      return;
    }

    findAceBetAmount = amount;
    findAceGameActive = true;
    findAceFlippedCards = [];

    balance -= amount;
    updateUserBalance(balance);
    updateBalanceDisplay();

    document.getElementById('findAceResult').textContent = '';
    document.getElementById('findAceGrid').innerHTML = '';

    const cardsToShow = shuffleArray([...findAceCards]);
    const grid = document.getElementById('findAceGrid');

    cardsToShow.forEach((card, index) => {
      const cardElement = document.createElement('div');
      cardElement.className = 'card';
      cardElement.dataset.value = card;
      cardElement.style.order = index;
      grid.appendChild(cardElement);
    });

    findAceCountdown = 15;
    document.getElementById('findAceCountdown').textContent = `Time: ${findAceCountdown}s`;

    // Show cards briefly
    setTimeout(() => {
      document.querySelectorAll('#findAceGrid .card').forEach(card => {
        card.textContent = card.dataset.value;
        card.classList.add('flipped');
      });

      // Start shuffling animation
      setTimeout(() => {
        document.querySelectorAll('#findAceGrid .card').forEach(card => {
          card.textContent = '';
          card.classList.remove('flipped');
        });

        findAceShuffling = true;
        let shuffleCount = 0;
        const shuffleInterval = setInterval(() => {
          const cards = Array.from(document.querySelectorAll('#findAceGrid .card'));
          cards.forEach(card => {
            const randomIndex = Math.floor(Math.random() * cards.length);
            const temp = card.style.order;
            card.style.order = cards[randomIndex].style.order;
            cards[randomIndex].style.order = temp;
          });

          shuffleCount++;
          if (shuffleCount >= 30) {
            clearInterval(shuffleInterval);
            findAceShuffling = false;

            document.querySelectorAll('#findAceGrid .card').forEach(card => {
              card.onclick = () => flipFindAceCard(card);
            });
          }
        }, 100);
      }, 2000);
    }, 1000);

    const countdownInterval = setInterval(() => {
      findAceCountdown--;
      document.getElementById('findAceCountdown').textContent = `Time: ${findAceCountdown}s`;

      if (findAceCountdown <= 0) {
        clearInterval(countdownInterval);
        endFindAceRound(false, "Time's up! You lost your bet.");
      }
    }, 1000);
  }

  function flipFindAceCard(card) {
    if (!findAceGameActive || card.classList.contains('flipped') || findAceShuffling) return;

    card.classList.add('flipped');
    card.textContent = card.dataset.value;
    flipSound.currentTime = 0;
    flipSound.play().catch(() => {});

    // 20% chance to win
    if (Math.random() < 0.2) {
      endFindAceRound(true, "üéâ You found the Ace! You win double your bet.");
    } else {
      endFindAceRound(false, "‚ùå Wrong card! You lost your bet.");
    }
  }

  function endFindAceRound(won, message) {
    findAceGameActive = false;

    if (won) {
      const winAmount = findAceBetAmount * 2;
      balance += winAmount;
      document.getElementById('winSound').play().catch(() => {});
    } else {
      document.getElementById('loseSound').play().catch(() => {});
    }

    updateUserBalance(balance);
    updateBalanceDisplay();

    document.getElementById('findAceResult').textContent = message;

    if (won) {
      document.getElementById("particles-js").style.display = "block";
      setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
    }
  }

  // Archery Game
  let archeryBet = 0;
  let archeryShots = [];
  let archeryAutoMode = false;
  let archeryGameActive = false;

  function setupArcheryGame() {
    const canvas = document.getElementById('archeryCanvas');
    const ctx = canvas.getContext('2d');

    let DPR = window.devicePixelRatio || 1;
    function fixCanvas() {
      const cssW = canvas.clientWidth || canvas.width;
      const cssH = canvas.clientHeight || canvas.height;
      canvas.width = Math.round(cssW * DPR);
      canvas.height = Math.round(cssH * DPR);
      canvas.style.width = cssW + 'px';
      canvas.style.height = cssH + 'px';
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    fixCanvas();
    window.addEventListener('resize', () => { fixCanvas(); drawArchery(); });

    const W = canvas.width / DPR;
    const H = canvas.height / DPR;
    const cx = W/2;
    const cy = H/2;

    let boardRadius = Math.min(W,H) * 0.35; // Reduced to 35% as requested

    const ringDefs = [
      {score:10, colorInner:'#ffdd66', colorOuter:'#ffcc00', radiusRatio:0.06},
      {score:8, colorInner:'#ffb76b', colorOuter:'#ff8f2e', radiusRatio:0.16},
      {score:7, colorInner:'#ff6b6b', colorOuter:'#d6453b', radiusRatio:0.28},
      {score:5, colorInner:'#3aa0ff', colorOuter:'#1475c7', radiusRatio:0.45},
      {score:2, colorInner:'#2e3136', colorOuter:'#0f1112', radiusRatio:0.70},
      {score:1, colorInner:'#f6f6f6', colorOuter:'#e9e9e9', radiusRatio:1.00}
    ];

    const ringRadii = ringDefs.map(r => boardRadius * r.radiusRatio);

    let sight = {
      x: W - 8,
      y: cy,
      radius: 14,
      movingLeft: true,
      speed: 6.0,
      active: false,
      auto: false,
      _lastCross: false
    };

    function drawBoard(){
      const woodR = boardRadius * 1.08;
      const g = ctx.createLinearGradient(cx, cy-woodR, cx, cy+woodR);
      g.addColorStop(0,'#7a5232'); g.addColorStop(0.5,'#a8764f'); g.addColorStop(1,'#5b391f');
      ctx.beginPath();
      ctx.arc(cx, cy, woodR, 0, Math.PI*2);
      ctx.fillStyle = g; ctx.fill();

      ctx.beginPath();
      ctx.arc(cx, cy, boardRadius + 6, 0, Math.PI*2);
      ctx.fillStyle = '#f8f5ee'; ctx.fill();

      for(let i = ringDefs.length-1; i >= 0; i--){
        const rd = ringRadii[i];
        const def = ringDefs[i];
        const grad = ctx.createRadialGradient(cx, cy, rd*0.1, cx, cy, rd);
        grad.addColorStop(0, def.colorInner);
        grad.addColorStop(1, def.colorOuter);
        ctx.beginPath();
        ctx.arc(cx, cy, rd, 0, Math.PI*2);
        ctx.fillStyle = grad;
        ctx.fill();

        ctx.beginPath();
        ctx.arc(cx, cy, rd, 0, Math.PI*2);
        ctx.lineWidth = 1;
        ctx.strokeStyle = 'rgba(0,0,0,0.18)';
        ctx.stroke();
      }

      ctx.beginPath();
      ctx.arc(cx, cy, 2.2, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(255,255,255,0.06)';
      ctx.fill();
    }

    function drawSight(){
      if(!sight.active) return;
      ctx.save();
      ctx.translate(sight.x, sight.y);
      ctx.beginPath();
      ctx.arc(0,0, sight.radius+6, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(30,220,120,0.04)';
      ctx.fill();
      ctx.beginPath();
      ctx.arc(0,0, sight.radius, 0, Math.PI*2);
      ctx.lineWidth = 2;
      ctx.strokeStyle = 'rgba(180,255,200,0.95)';
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(-14,0); ctx.lineTo(-6,0);
      ctx.moveTo(6,0); ctx.lineTo(14,0);
      ctx.moveTo(0,-14); ctx.lineTo(0,-6);
      ctx.moveTo(0,6); ctx.lineTo(0,14);
      ctx.strokeStyle = 'rgba(180,255,200,0.9)';
      ctx.lineWidth = 1.6;
      ctx.stroke();
      ctx.restore();
    }

    function updateSight(){
      if(!sight.active) return;
      if(sight.movingLeft){
        sight.x -= sight.speed;
        if(sight.x <= 8){
          sight.x = 8;
          sight.movingLeft = false;
        }
      } else {
        sight.x += sight.speed;
        if(sight.x >= W - 8){
          sight.x = W - 8;
          sight.movingLeft = true;
        }
      }

      if(sight.auto){
        const centerBand = 8;
        if(!sight._lastCross && Math.abs(sight.x - cx) <= centerBand){
          sight._lastCross = true;
          performShot();
        } else if(Math.abs(sight.x - cx) > centerBand){
          sight._lastCross = false;
        }
      }
    }

    function computeScore(px, py){
      const dx = px - cx;
      const dy = py - cy;
      const dist = Math.sqrt(dx*dx + dy*dy);
      for(let i=0;i<ringRadii.length;i++){
        if(dist <= ringRadii[i]) {
          return ringDefs[i].score;
        }
      }
      return 0;
    }

    function performShot(){
      if(!sight.active) return;
      if(archeryBet === 0){
        document.getElementById('archeryStatus').textContent = 'You must select a bet first.';
        return;
      }
      if(archeryShots.length >= 5) return;

      const score = computeScore(sight.x, sight.y);
      archeryShots.push(score);
      refreshScoreBoxes();

      document.getElementById('archeryStatus').textContent = `Shot ${archeryShots.length} ‚Üí ${score} points`;
      document.getElementById('shotSound').play().catch(() => {});

      if(archeryShots.length === 5){
        sight.active = false;
        let allTen = archeryShots.every(s=> s === 10);
        // 20% chance to win
        if (Math.random() < 0.2) {
          balance += archeryBet;
          document.getElementById('archeryStatus').textContent = `üéâ PERFECT! All 5 are bullseyes. You doubled your bet to ‚Ç®${archeryBet*2}`;
          document.getElementById('winSound').play().catch(() => {});
          document.getElementById("particles-js").style.display = "block";
          setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
        } else {
          balance -= archeryBet;
          if(balance < 0) balance = 0;
          document.getElementById('archeryStatus').textContent = `‚úñ You lost the bet of ‚Ç®${archeryBet}.`;
          document.getElementById('loseSound').play().catch(() => {});
        }
        updateUserBalance(balance);
        updateBalanceDisplay();
      }
    }

    function refreshScoreBoxes(){
      const scoreBoxes = document.querySelectorAll('#archeryScoreRow .archery-score-box');
      for(let i=0;i<5;i++){
        scoreBoxes[i].textContent = archeryShots[i] !== undefined ? archeryShots[i] : '';
      }
    }

    canvas.addEventListener('click', ()=> {
      performShot();
    });

    function drawArchery(){
      ctx.clearRect(0,0,W,H);
      drawBoard();
      drawSight();
    }

    function loop(){
      updateSight();
      drawArchery();
      requestAnimationFrame(loop);
    }
    loop();

    window.selectArcheryBet = function(amount){
      if (archeryGameActive) return;

      if (balance < amount) {
        showToast("Insufficient balance! Please deposit more to play.", 'error');
        return;
      }

      archeryBet = amount;
      archeryShots = [];
      const scoreBoxes = document.querySelectorAll('#archeryScoreRow .archery-score-box');
      for(let b of scoreBoxes) b.textContent = '';
      sight.x = W - 8;
      sight.y = cy;
      sight.movingLeft = true;
      sight.active = true;
      archeryGameActive = true;

      balance -= amount;
      updateUserBalance(balance);
      updateBalanceDisplay();

      document.getElementById('archeryStatus').textContent = `Bet ‚Ç® ${archeryBet} placed ‚Äî 5 shots. Click canvas to shoot when sight passes.`;
    };

    window.resetArcheryGame = function(){
      archeryBet = 0;
      archeryShots = [];
      const scoreBoxes = document.querySelectorAll('#archeryScoreRow .archery-score-box');
      for(let b of scoreBoxes) b.textContent = '';
      sight.active = false;
      archeryGameActive = false;
      document.getElementById('archeryStatus').textContent = 'Pick a bet to start';
    };

    window.toggleArcheryAuto = function(){
      archeryAutoMode = !archeryAutoMode;
      document.getElementById('archeryAutoBtn').textContent = 'Auto: ' + (archeryAutoMode ? 'ON' : 'OFF');
      sight.auto = archeryAutoMode;
    };
  }

  function startArcheryGame() {
    if (!currentUser) {
      showAuthModal('login');
      return;
    }
    document.getElementById('scratchGame').style.display = 'none';
    document.getElementById('fruitGame').style.display = 'none';
    document.getElementById('tictactoeGame').style.display = 'none';
    document.getElementById('findAceGame').style.display = 'none';
    document.getElementById('archeryGame').style.display = 'block';
    document.getElementById('impossibleTowerGame').style.display = 'none';
  }

  // Impossible Tower Game
  let towerBlocks = [];
  let towerScore = 0;
  let towerGameActive = false;
  let towerBetAmount = 0;
  let towerCountdown = 0;
  let towerTimer;
  let currentBlock = null;
  let towerDirection = 1;
  let towerSpeed = 2;

  function setupImpossibleTowerGame() {
    towerBlocks = [];
    towerScore = 0;
    towerGameActive = false;
    towerBetAmount = 0;
    towerCountdown = 0;
    currentBlock = null;
    towerDirection = 1;
    towerSpeed = 2;
  }

  function startImpossibleTowerGame() {
    if (!currentUser) {
      showAuthModal('login');
      return;
    }
    document.getElementById('scratchGame').style.display = 'none';
    document.getElementById('fruitGame').style.display = 'none';
    document.getElementById('tictactoeGame').style.display = 'none';
    document.getElementById('findAceGame').style.display = 'none';
    document.getElementById('archeryGame').style.display = 'none';
    document.getElementById('impossibleTowerGame').style.display = 'block';
    setupImpossibleTowerGame();
  }

  function startTowerGame(amount) {
    if (towerGameActive || balance < amount) {
      if (balance < amount) {
        showToast("Insufficient balance! Please deposit more to play.", 'error');
      }
      return;
    }

    towerBetAmount = amount;
    towerGameActive = true;
    towerScore = 0;
    towerBlocks = [];
    towerDirection = 1;
    towerSpeed = 2;

    balance -= amount;
    updateUserBalance(balance);
    updateBalanceDisplay();

    document.getElementById('towerScore').textContent = 'Score: 0';
    document.getElementById('towerResult').textContent = '';
    document.getElementById('towerContainer').innerHTML = '';

    towerCountdown = 60;
    document.getElementById('towerCountdown').textContent = `Time: ${towerCountdown}s`;

    towerTimer = setInterval(() => {
      towerCountdown--;
      document.getElementById('towerCountdown').textContent = `Time: ${towerCountdown}s`;

      if (towerCountdown <= 0) {
        clearInterval(towerTimer);
        endTowerGame(false, "Time's up! You lost your bet.");
      }
    }, 1000);

    createNewBlock();
  }

  function createNewBlock() {
    if (!towerGameActive) return;

    const container = document.getElementById('towerContainer');
    const block = document.createElement('div');
    block.className = 'tower-block';

    if (towerBlocks.length === 0) {
      // First block
      block.style.width = '100px';
      block.style.height = '20px';
      block.style.left = '100px';
      block.style.bottom = '0px';
    } else {
      // Subsequent blocks
      const lastBlock = towerBlocks[towerBlocks.length - 1];
      block.style.width = '100px';
      block.style.height = '20px';
      block.style.left = '100px';
      block.style.bottom = (parseInt(lastBlock.style.bottom) + 20) + 'px';

      // Start moving the block
      moveBlock(block);
    }

    container.appendChild(block);
    currentBlock = block;
    towerBlocks.push(block);
  }

  function moveBlock(block) {
    if (!towerGameActive) return;

    let position = 100;
    const moveInterval = setInterval(() => {
      if (!towerGameActive) {
        clearInterval(moveInterval);
        return;
      }

      position += towerDirection * towerSpeed;
      if (position <= 0 || position >= 200) {
        towerDirection *= -1;
      }

      block.style.left = position + 'px';
    }, 20);
  }

  function placeBlock() {
    if (!towerGameActive || !currentBlock) return;

    const container = document.getElementById('towerContainer');
    const block = currentBlock;

    // Stop moving the block
    block.style.left = block.style.left;

    // Check if the block is placed correctly
    if (towerBlocks.length > 1) {
      const lastBlock = towerBlocks[towerBlocks.length - 2];
      const lastLeft = parseInt(lastBlock.style.left);
      const currentLeft = parseInt(block.style.left);

      if (Math.abs(lastLeft - currentLeft) > 30) {
        // Block is not placed correctly
        endTowerGame(false, "Tower collapsed! You lost your bet.");
        return;
      }
    }

    towerScore++;
    document.getElementById('towerScore').textContent = 'Score: ' + towerScore;

    // Increase speed for next block
    towerSpeed += 0.5;

    // Check if player won (20% chance after 10 blocks)
    if (towerScore >= 10 && Math.random() < 0.2) {
      endTowerGame(true, "üéâ You built a tower of " + towerScore + " blocks! You win double your bet.");
      return;
    }

    // Create new block after a delay
    setTimeout(() => {
      createNewBlock();
    }, 1000);
  }

  function endTowerGame(won, message) {
    clearInterval(towerTimer);
    towerGameActive = false;

    if (won) {
      const winAmount = towerBetAmount * 2;
      balance += winAmount;
      document.getElementById('winSound').play().catch(() => {});
    } else {
      document.getElementById('loseSound').play().catch(() => {});
    }

    updateUserBalance(balance);
    updateBalanceDisplay();

    document.getElementById('towerResult').textContent = message;

    if (won) {
      document.getElementById("particles-js").style.display = "block";
      setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
    }
  }

  // Add click event to place blocks
  document.getElementById('towerContainer').addEventListener('click', () => {
    if (towerGameActive && currentBlock) {
      placeBlock();
      document.getElementById('placeSound').play().catch(() => {});
    }
  });

  // Helper function to shuffle array
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Particles effect
  particlesJS("particles-js", {
    "particles": {
      "number": { "value": 100 },
      "color": { "value": "#FFD700" },
      "shape": { "type": "star" },
      "opacity": { "value": 0.8 },
      "size": { "value": 5 },
      "move": { "enable": true, "speed": 8 }
    },
    "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false } } },
    "retina_detect": true
  });
</script>
</body>
</html>
