<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>USCash üéÆ</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
:root {
  --primary: #FFD700;
  --secondary: #1E90FF;
  --dark: #0A0A0A;
  --light: #FFFFFF;
  --accent: #FF6347;
}

body {
  font-family: 'Poppins', sans-serif;
  background-color: var(--dark);
  color: var(--primary);
  text-align: center;
  margin: 0;
  padding: 0;
  background-image:
    radial-gradient(circle at 10% 20%, rgba(255, 215, 0, 0.05) 0%, transparent 20%),
    radial-gradient(circle at 90% 80%, rgba(30, 144, 255, 0.05) 0%, transparent 20%);
}

h1 {
  font-size: 2.8rem;
  background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
  margin: 20px 0;
  letter-spacing: 2px;
  position: relative;
  display: inline-block;
}

h1::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 0;
  width: 100%;
  height: 3px;
  background: linear-gradient(90deg, transparent, var(--primary), transparent);
}

.nav {
  background: linear-gradient(90deg, var(--dark), var(--primary), var(--dark));
  color: var(--dark);
  padding: 12px;
  display: flex;
  justify-content: space-around;
  flex-wrap: wrap;
  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
  position: relative;
  z-index: 100;
}

.nav a {
  color: var(--dark);
  text-decoration: none;
  font-weight: bold;
  padding: 8px 15px;
  border-radius: 20px;
  transition: all 0.3s;
  font-size: 1.1rem;
}

.nav a:hover {
  background-color: var(--dark);
  color: var(--primary);
  transform: translateY(-3px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.section {
  margin: 30px auto;
  padding: 25px;
  max-width: 900px;
  border: 2px solid var(--primary);
  border-radius: 15px;
  box-sizing: border-box;
  background-color: rgba(10, 10, 10, 0.8);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
  position: relative;
  overflow: hidden;
}

.section::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border: 2px solid transparent;
  border-image: linear-gradient(45deg, var(--primary), var(--secondary)) 1;
  z-index: -1;
  animation: borderRotate 8s linear infinite;
}

@keyframes borderRotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.gold-box {
  display: inline-block;
  background: linear-gradient(145deg, var(--primary), #e6c200);
  color: var(--dark);
  margin: 8px;
  padding: 12px 20px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1.1rem;
  font-weight: bold;
  transition: all 0.3s;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  border: none;
}

.gold-box:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(255, 215, 0, 0.3);
  background: linear-gradient(145deg, #ffdf00, var(--primary));
}

.gold-box.active {
  background: var(--dark);
  color: var(--primary);
  border: 2px solid var(--primary);
  box-shadow: 0 0 15px var(--primary);
}

.game-options {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  align-items: center;
  justify-content: center;
  padding: 20px 0;
}

.game-options .gold-box {
  width: 220px;
  height: 180px;
  font-size: 1.4rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--primary);
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  background-size: cover;
  background-position: center;
  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
}

.game-options .gold-box::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 0;
}

.game-options .gold-box > * {
  position: relative;
  z-index: 1;
}

.game-options .gold-box:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px var(--primary);
}

.game-options .gold-box i {
  font-size: 3rem;
  margin-bottom: 15px;
  color: var(--primary);
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
}

/* Game specific thumbnails */
.scratch-thumbnail {
  background-image: url('https://images.unsplash.com/photo-1586281380117-5a60ae2050cc?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80');
}

.fruit-thumbnail {
  background-image: url('https://images.unsplash.com/photo-1568702846914-96b305d2aaeb?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80');
}

.tictactoe-thumbnail {
  background-image: url('https://images.unsplash.com/photo-1542751371-adc38448a05e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80');
}

.findace-thumbnail {
  background-image: url('https://images.unsplash.com/photo-1581388655277-9fc7e7f1e1d3?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80');
}

.archery-thumbnail {
  background-image: url('https://images.unsplash.com/photo-1600861195091-690c92f1d2cc?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80');
}

.card-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  margin: 20px auto;
  max-width: 450px;
}

.card {
  width: 90px;
  height: 110px;
  background-color: #222;
  color: black;
  font-size: 2.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--primary);
  border-radius: 10px;
  cursor: pointer;
  transition: transform 0.4s, background-color 0.3s;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  background-image: url('https://images.unsplash.com/photo-1581388655277-9fc7e7f1e1d3?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80');
  background-size: cover;
  background-position: center;
}

.card.flipped {
  background: linear-gradient(145deg, var(--primary), #e6c200);
  color: var(--dark);
  transform: rotateY(180deg);
  box-shadow: 0 0 15px var(--primary);
}

.bet-amounts {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}

#result {
  margin-top: 20px;
  font-size: 1.3rem;
  color: var(--light);
  padding: 10px;
  border-radius: 8px;
  background-color: rgba(0, 0, 0, 0.5);
}

.shake {
  animation: shake 0.5s;
}

.glow {
  animation: glow 1s infinite alternate;
}

@keyframes shake {
  0% { transform: translate(1px, 1px) rotate(0deg); }
  20% { transform: translate(-3px, 0px) rotate(-2deg); }
  40% { transform: translate(3px, 2px) rotate(2deg); }
  60% { transform: translate(-2px, 1px) rotate(0deg); }
  80% { transform: translate(2px, -1px) rotate(2deg); }
  100% { transform: translate(1px, 1px) rotate(0deg); }
}

@keyframes glow {
  from { box-shadow: 0 0 10px var(--primary); }
  to { box-shadow: 0 0 20px var(--light); }
}

#particles-js {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 999;
  display: none;
}

#welcomePopup {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

#welcomePopup .popup-content {
  background: var(--dark);
  border: 2px solid var(--primary);
  padding: 30px;
  border-radius: 15px;
  max-width: 450px;
  color: var(--primary);
  text-align: center;
  position: relative;
  box-shadow: 0 0 30px var(--primary);
  animation: popupEnter 0.5s ease-out;
}

@keyframes popupEnter {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

#welcomePopup .popup-content h2 {
  color: var(--secondary);
  margin-top: 0;
  font-size: 1.8rem;
}

#welcomePopup .popup-content .close {
  position: absolute;
  top: 15px;
  right: 20px;
  cursor: pointer;
  font-weight: bold;
  color: var(--accent);
  font-size: 24px;
  transition: transform 0.3s;
}

#welcomePopup .popup-content .close:hover {
  transform: rotate(90deg);
}

/* ŸÅÿ±ŸàŸπ ÿ¥ŸàŸπÿ± ⁄Ø€åŸÖ ⁄©€í ŸÑ€å€í ÿßÿ∂ÿßŸÅ€å ÿ≥Ÿπÿßÿ¶ŸÑÿ≤ */
#fruitGame {
  display: none;
}

.shoot-area {
  position: relative;
  height: 400px;
  border: 3px dashed var(--primary);
  border-radius: 15px;
  background-color: #222;
  overflow: hidden;
  margin-top: 20px;
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
}

.fruit {
  position: absolute;
  font-size: 3.5em;
  cursor: pointer;
  user-select: none;
  pointer-events: auto;
  transition: transform 0.1s;
  z-index: 10;
}

.fruit:hover {
  transform: scale(1.1);
}

#fruitTargetDisplay {
  font-size: 1.5em;
  margin: 15px 0;
  color: var(--light);
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
  display: inline-block;
}

#fruitScoreDisplay {
  margin-top: 15px;
  font-size: 1.3em;
  font-weight: bold;
}

#fruitCountdown {
  font-size: 1.4em;
  margin-top: 15px;
  color: var(--primary);
  font-weight: bold;
}

/* Tic Tac Toe Styles */
#tictactoeGame {
  display: none;
}

.tic-tac-toe-board {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 8px;
  width: 320px;
  height: 320px;
  margin: 25px auto;
  background-color: rgba(255, 215, 0, 0.1);
  padding: 15px;
  border-radius: 15px;
}

.tic-tac-toe-cell {
  background-color: #222;
  border: 2px solid var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3.5rem;
  cursor: pointer;
  transition: all 0.3s;
  color: var(--primary);
}

.tic-tac-toe-cell:hover {
  background-color: #333;
  transform: scale(1.05);
}

.tic-tac-toe-cell.x {
  color: var(--secondary);
  text-shadow: 0 0 10px var(--secondary);
}

.tic-tac-toe-cell.o {
  color: var(--accent);
  text-shadow: 0 0 10px var(--accent);
}

#tictactoeResult {
  margin-top: 20px;
  font-size: 1.3rem;
  color: var(--light);
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
}

#tictactoeCountdown {
  font-size: 1.4rem;
  color: var(--primary);
  font-weight: bold;
}

/* Find Ace Game Styles */
#findAceGame {
  display: none;
}

#findAceCountdown {
  font-size: 1.5rem;
  margin: 15px 0;
  color: var(--primary);
  font-weight: bold;
}

#findAceResult {
  margin-top: 20px;
  font-size: 1.3rem;
  color: var(--light);
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
}

/* Archery Game Styles */
#archeryGame {
  display: none;
}

.archery-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.archery-canvas-container {
  position: relative;
  width: 520px;
  height: 520px;
  max-width: 100%;
  margin: 0 auto;
}

#archeryCanvas {
  background: transparent;
  border-radius: 12px;
  display: block;
  max-width: 100%;
  height: auto;
  border: 2px solid var(--primary);
}

.archery-controls {
  display: flex;
  flex-direction: column;
  gap: 15px;
  width: 100%;
  max-width: 520px;
}

.archery-bets {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
}

.archery-score-row {
  display: flex;
  justify-content: center;
  gap: 10px;
}

.archery-score-box {
  width: 48px;
  height: 48px;
  border-radius: 8px;
  background: linear-gradient(145deg, #222, #111);
  border: 2px solid var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  color: var(--primary);
}

#archeryStatus {
  font-size: 1.1rem;
  color: var(--light);
  text-align: center;
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 8px;
}

/* Auth Modal Styles */
.auth-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.85);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.auth-content {
  background-color: var(--dark);
  border: 2px solid var(--primary);
  padding: 30px;
  border-radius: 15px;
  width: 90%;
  max-width: 400px;
  color: var(--light);
  box-shadow: 0 0 30px var(--primary);
  animation: modalFadeIn 0.4s ease-out;
}

@keyframes modalFadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.auth-tabs {
  display: flex;
  margin-bottom: 25px;
  border-bottom: 2px solid var(--primary);
}

.auth-tab {
  flex: 1;
  padding: 12px;
  text-align: center;
  cursor: pointer;
  border-bottom: 3px solid transparent;
  font-weight: bold;
  transition: all 0.3s;
}

.auth-tab.active {
  border-bottom: 3px solid var(--secondary);
  color: var(--secondary);
}

.auth-tab:hover {
  background-color: rgba(255, 215, 0, 0.1);
}

.auth-form {
  display: none;
}

.auth-form.active {
  display: block;
}

.auth-form input {
  width: 100%;
  padding: 12px;
  margin-bottom: 18px;
  border-radius: 8px;
  border: 1px solid #444;
  background-color: #222;
  color: var(--light);
  font-size: 1rem;
  transition: all 0.3s;
}

.auth-form input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 10px var(--primary);
}

.auth-form button {
  width: 100%;
  padding: 12px;
  background: linear-gradient(145deg, var(--primary), #e6c200);
  color: var(--dark);
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  font-size: 1.1rem;
  transition: all 0.3s;
  margin-top: 10px;
}

.auth-form button:hover {
  background: linear-gradient(145deg, #ffdf00, var(--primary));
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
}

.auth-form button:disabled {
  background: #444;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.forgot-password {
  text-align: right;
  margin-top: -15px;
  margin-bottom: 20px;
  font-size: 0.9rem;
  color: var(--secondary);
  cursor: pointer;
  transition: color 0.3s;
}

.forgot-password:hover {
  color: var(--primary);
  text-decoration: underline;
}

/* Balance and User Info Styles */
.user-info {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  margin: 20px 0;
  flex-wrap: wrap;
}

.balance-container {
  display: flex;
  align-items: center;
  gap: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  padding: 12px 20px;
  border-radius: 30px;
  border: 1px solid var(--primary);
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
}

#balanceAmount {
  font-weight: bold;
  font-size: 1.2rem;
  color: var(--primary);
}

.refresh-balance {
  cursor: pointer;
  color: var(--primary);
  font-size: 1.3rem;
  transition: transform 0.3s;
}

.refresh-balance:hover {
  transform: rotate(180deg);
  color: var(--secondary);
}

#userDisplay {
  display: flex;
  align-items: center;
  background-color: rgba(0, 0, 0, 0.5);
  padding: 10px 20px;
  border-radius: 30px;
  border: 1px solid var(--secondary);
  box-shadow: 0 0 15px rgba(30, 144, 255, 0.2);
  gap: 10px;
}

#usernameDisplay {
  font-weight: bold;
  color: var(--secondary);
}

#phoneDisplay {
  font-weight: bold;
  color: var(--primary);
}

.country-flag {
  width: 24px;
  height: 16px;
  border-radius: 2px;
  box-shadow: 0 0 5px rgba(0,0,0,0.3);
}

.verified-badge {
  color: var(--secondary);
  margin-left: 5px;
}

/* Deposit/Withdraw Styles */
#depositSection, #withdrawSection, #moreSection, #vipSection {
  display: none;
}

.form-group {
  margin-bottom: 20px;
  text-align: left;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: var(--primary);
  font-weight: bold;
}

.form-group input, .form-group select {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #444;
  background-color: #222;
  color: var(--light);
  font-size: 1rem;
  transition: all 0.3s;
}

.form-group input:focus, .form-group select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 10px var(--primary);
}

.submit-btn {
  background: linear-gradient(145deg, var(--primary), #e6c200);
  color: var(--dark);
  border: none;
  padding: 12px 25px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  margin-top: 15px;
  font-size: 1.1rem;
  transition: all 0.3s;
  display: inline-block;
}

.submit-btn:hover {
  background: linear-gradient(145deg, #ffdf00, var(--primary));
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
}

.transaction-history {
  margin-top: 30px;
  max-height: 400px;
  overflow-y: auto;
  padding: 15px;
  background-color: rgba(0, 0, 0, 0.3);
  border-radius: 10px;
  border: 1px solid rgba(255, 215, 0, 0.3);
}

.transaction-item {
  background-color: rgba(30, 30, 30, 0.8);
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 8px;
  border-left: 4px solid var(--primary);
  transition: transform 0.3s;
}

.transaction-item:hover {
  transform: translateX(5px);
}

.transaction-amount {
  font-weight: bold;
  font-size: 1.1rem;
}

.transaction-approved {
  color: lime;
}

.transaction-pending {
  color: var(--primary);
}

.transaction-rejected {
  color: var(--accent);
}

/* VIP Section Styles */
.referral-code {
  background-color: rgba(0, 0, 0, 0.5);
  padding: 15px;
  border-radius: 8px;
  font-family: monospace;
  margin: 15px 0;
  word-break: break-all;
  border: 1px solid var(--primary);
  font-size: 1.2rem;
  color: var(--primary);
  position: relative;
}

.referral-code-copy {
  position: absolute;
  right: 10px;
  top: 10px;
  color: var(--secondary);
  cursor: pointer;
  font-size: 1rem;
}

.referral-stats {
  display: flex;
  justify-content: space-around;
  margin: 25px 0;
  flex-wrap: wrap;
  gap: 15px;
}

.stat-box {
  background-color: rgba(0, 0, 0, 0.5);
  padding: 20px;
  border-radius: 10px;
  border: 1px solid var(--primary);
  min-width: 120px;
  flex: 1;
  transition: transform 0.3s;
}

.stat-box:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
}

.stat-label {
  color: var(--light);
  margin-bottom: 10px;
  font-size: 0.9rem;
}

.stat-value {
  font-size: 1.8rem;
  font-weight: bold;
  color: var(--primary);
}

/* Announcement Bar */
.announcement-bar {
  position: relative;
  background: linear-gradient(90deg, transparent, rgba(30, 144, 255, 0.2), transparent);
  color: var(--light);
  padding: 12px 0;
  overflow: hidden;
  margin: 0 auto;
  width: 100%;
  border-top: 1px solid var(--secondary);
  border-bottom: 1px solid var(--secondary);
}

.announcement-content {
  display: inline-block;
  white-space: nowrap;
  padding-left: 100%;
  animation: scroll 20s linear infinite;
  font-size: 1.1rem;
  text-shadow: 0 0 5px var(--secondary);
}

.announcement-content span {
  color: var(--secondary);
  font-weight: bold;
}

@keyframes scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

/* Responsive adjustments */
@media (max-width: 768px) {
  h1 {
    font-size: 2.2rem;
  }

  .game-options .gold-box {
    width: 160px;
    height: 140px;
    font-size: 1.2rem;
  }

  .tic-tac-toe-board {
    width: 280px;
    height: 280px;
  }

  .archery-canvas-container {
    width: 100%;
    height: auto;
  }

  .nav a {
    padding: 6px 10px;
    font-size: 0.9rem;
  }

  .section {
    padding: 20px;
  }
  
  .user-info {
    flex-direction: column;
    gap: 10px;
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 1.8rem;
  }

  .game-options .gold-box {
    width: 140px;
    height: 120px;
    font-size: 1rem;
  }

  .game-options .gold-box i {
    font-size: 2rem;
  }

  .tic-tac-toe-board {
    width: 240px;
    height: 240px;
  }

  .card {
    width: 70px;
    height: 90px;
    font-size: 1.8rem;
  }
}
</style>
</head>
<body>
<div id="particles-js"></div>

<!-- Announcement Bar -->
<div class="announcement-bar">
<div class="announcement-content">
<span>üì¢ Stay connected with us!</span> For deposits, contact VIP users (verified with blue tick) or WhatsApp us at USCash WhatsApp channel
</div>
</div>

<div id="welcomePopup">
<div class="popup-content">
<div class="close" onclick="document.getElementById('welcomePopup').style.display='none'">√ó</div>
<h2>Welcome to USCash! üéÆ</h2>
<p>Experience the thrill of gaming with real rewards. We're constantly improving our platform to bring you the best gaming experience.</p>
<p>New games and features are coming soon - stay tuned!</p>
<button class="gold-box" onclick="document.getElementById('welcomePopup').style.display='none'" style="margin-top: 20px;">
Let's Play!
</button>
</div>
</div>

<!-- Auth Modals -->
<div id="authModal" class="auth-modal">
<div class="auth-content">
<div class="auth-tabs">
<div class="auth-tab active" onclick="switchAuthTab('login')">Login</div>
<div class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</div>
</div>

<div id="loginForm" class="auth-form active">
<input type="email" id="loginEmail" placeholder="Email" required />
<input type="password" id="loginPassword" placeholder="Password" required />
<div class="forgot-password" onclick="showForgotPassword()">Forgot Password?</div>
<button onclick="loginUser()">Login</button>
</div>

<div id="signupForm" class="auth-form">
<input type="text" id="signupName" placeholder="Full Name" required />
<input type="tel" id="signupPhone" placeholder="Phone Number" required />
<input type="email" id="signupEmail" placeholder="Email" required />
<input type="password" id="signupPassword" placeholder="Password (6+ characters)" required minlength="6" />
<input type="text" id="referralCode" placeholder="Referral Code (Optional)" />
<button onclick="signupUser()">Sign Up</button>
</div>

<div id="forgotPasswordForm" class="auth-form">
<input type="email" id="forgotEmail" placeholder="Enter your email" required />
<button onclick="resetPassword()">Reset Password</button>
<button onclick="backToLogin()" style="margin-top: 10px; background-color: #444;">Back to Login</button>
</div>
</div>
</div>

<h1>USCash üéÆ</h1>

<div class="user-info">
<div id="userDisplay" style="display:none;">
<img src="https://flagcdn.com/w20/pk.png" class="country-flag" alt="Country Flag" id="countryFlag">
<span id="usernameDisplay"></span>
<span id="phoneDisplay"></span>
<i class="fas fa-check-circle verified-badge" id="verifiedBadge" style="display:none;"></i>
</div>
<div class="balance-container">
<span>Balance: Rs. <span id="balanceAmount">0</span></span>
<i class="fas fa-sync-alt refresh-balance" onclick="refreshBalance()"></i>
</div>
<div id="authButtons">
<button class="gold-box" onclick="showAuthModal('login')">Login</button>
<button class="gold-box" onclick="showAuthModal('signup')">Sign Up</button>
</div>
<div id="logoutButton" style="display:none;">
<button class="gold-box" onclick="logoutUser()">Logout</button>
</div>
</div>

<div class="nav">
<a href="#" onclick="showSection('home')"><i class="fas fa-home"></i> Home</a>
<a href="#" onclick="showSection('deposit')"><i class="fas fa-money-bill-wave"></i> Deposit</a>
<a href="#" onclick="showSection('withdraw')"><i class="fas fa-wallet"></i> Withdraw</a>
<a href="#" onclick="showSection('vip')"><i class="fas fa-crown"></i> VIP</a>
<a href="#" onclick="showSection('more')"><i class="fas fa-ellipsis-h"></i> More</a>
</div>

<!-- Home Section -->
<div class="section" id="homeSection">
<h2>Select Game</h2>
<div class="game-options">
<div class="gold-box scratch-thumbnail" onclick="startCardGame()">
<i class="fas fa-scroll"></i>
Scratch Match
</div>
<div class="gold-box fruit-thumbnail" onclick="startFruitGame()">
<i class="fas fa-apple-alt"></i>
Fruit Shooting
</div>
<div class="gold-box tictactoe-thumbnail" onclick="startTicTacToeGame()">
<i class="fas fa-times"></i>
Tic Tac Toe
</div>
<div class="gold-box findace-thumbnail" onclick="startFindAceGame()">
<i class="fas fa-search"></i>
Find Ace
</div>
<div class="gold-box archery-thumbnail" onclick="startArcheryGame()">
<i class="fas fa-bullseye"></i>
Archery Challenge
</div>
</div>
</div>

<!-- Scratch Game -->
<div class="section" id="scratchGame" style="display:none;">
<h2><i class="fas fa-scroll"></i> Scratch & Match</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="selectBet(20)">20</div>
<div class="gold-box" onclick="selectBet(50)">50</div>
<div class="gold-box" onclick="selectBet(100)">100</div>
<div class="gold-box" onclick="selectBet(150)">150</div>
<div class="gold-box" onclick="selectBet(200)">200</div>
<div class="gold-box" onclick="selectBet(300)">300</div>
</div>
<div class="card-grid" id="cardGrid"></div>
<div id="result"></div>
</div>

<!-- Fruit Game -->
<div class="section" id="fruitGame" style="display:none;">
<h2><i class="fas fa-apple-alt"></i> Fruit Shooting</h2>
<div id="fruitTargetDisplay">Target: Shoot the <b style="color:red;">RED</b> Apple üçé!</div>
<div class="bet-amounts">
<div class="gold-box" onclick="startFruitRound(20)">Rs. 20</div>
<div class="gold-box" onclick="startFruitRound(50)">Rs. 50</div>
<div class="gold-box" onclick="startFruitRound(100)">Rs. 100</div>
<div class="gold-box" onclick="startFruitRound(150)">Rs. 150</div>
<div class="gold-box" onclick="startFruitRound(200)">Rs. 200</div>
</div>
<div id="fruitCountdown">Time: 0s</div>
<div class="shoot-area" id="shootArea"></div>
<div id="fruitScoreDisplay"></div>
</div>

<!-- Tic Tac Toe Game -->
<div class="section" id="tictactoeGame" style="display:none;">
<h2><i class="fas fa-times"></i> Tic Tac Toe</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="selectTicTacToeBet(50)">Rs. 50</div>
<div class="gold-box" onclick="selectTicTacToeBet(100)">Rs. 100</div>
<div class="gold-box" onclick="selectTicTacToeBet(200)">Rs. 200</div>
<div class="gold-box" onclick="selectTicTacToeBet(300)">Rs. 300</div>
</div>
<div id="tictactoeCountdown">Time: 30s</div>
<div class="tic-tac-toe-board" id="ticTacToeBoard"></div>
<div id="tictactoeResult"></div>
</div>

<!-- Find Ace Game -->
<div class="section" id="findAceGame" style="display:none;">
<h2><i class="fas fa-search"></i> Find Ace</h2>
<div class="bet-amounts">
<div class="gold-box" onclick="startFindAceRound(50)">Rs. 50</div>
<div class="gold-box" onclick="startFindAceRound(100)">Rs. 100</div>
<div class="gold-box" onclick="startFindAceRound(200)">Rs. 200</div>
<div class="gold-box" onclick="startFindAceRound(300)">Rs. 300</div>
</div>
<div id="findAceCountdown">Time: 15s</div>
<div class="card-grid" id="findAceGrid"></div>
<div id="findAceResult"></div>
</div>

<!-- Archery Game -->
<div class="section" id="archeryGame" style="display:none;">
<h2><i class="fas fa-bullseye"></i> Archery Challenge</h2>
<div class="archery-container">
<div class="archery-canvas-container">
<canvas id="archeryCanvas" width="520" height="520"></canvas>
</div>

<div class="archery-controls">
<div class="bet-amounts">
<div class="gold-box" onclick="selectArcheryBet(20)">Rs. 20</div>
<div class="gold-box" onclick="selectArcheryBet(50)">Rs. 50</div>
<div class="gold-box" onclick="selectArcheryBet(100)">Rs. 100</div>
<div class="gold-box" onclick="selectArcheryBet(150)">Rs. 150</div>
<div class="gold-box" onclick="selectArcheryBet(200)">Rs. 200</div>
</div>

<div class="archery-score-row" id="archeryScoreRow">
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
<div class="archery-score-box"></div>
</div>

<div id="archeryStatus">Pick a bet to start</div>

<div style="display: flex; justify-content: center; gap: 10px;">
<button class="gold-box" onclick="resetArcheryGame()">Reset</button>
<button class="gold-box" onclick="toggleArcheryAuto()" id="archeryAutoBtn">Auto: OFF</button>
</div>
</div>
</div>
</div>

<!-- Deposit Section -->
<div class="section" id="depositSection" style="display:none;">
<h2><i class="fas fa-money-bill-wave"></i> Deposit</h2>
<p style="color: var(--secondary);">Minimum deposit amount is Rs. 150. To deposit, please contact VIP users (verified with blue tick) or WhatsApp us at USCash WhatsApp channel</p>
<div class="form-group">
<label for="depositAmount">Amount (Rs.)</label>
<input type="number" id="depositAmount" min="150" placeholder="Minimum 150" />
</div>
<div class="form-group">
<label for="depositMethod">Payment Method</label>
<select id="depositMethod">
<option value="easypaisa">EasyPaisa</option>
<option value="jazzcash">JazzCash</option>
<option value="bank">Bank Transfer</option>
</select>
</div>
<div class="form-group">
<label for="transactionId">Transaction ID</label>
<input type="text" id="transactionId" placeholder="Enter transaction reference" />
</div>
<button class="submit-btn" onclick="submitDeposit()">Submit Deposit Request</button>

<div class="transaction-history" id="depositHistory">
<h3><i class="fas fa-history"></i> Deposit History</h3>
<!-- Will be populated by JavaScript -->
</div>
</div>

<!-- Withdraw Section -->
<div class="section" id="withdrawSection" style="display:none;">
<h2><i class="fas fa-wallet"></i> Withdraw</h2>
<p style="color: var(--secondary);">Minimum withdrawal amount is Rs. 300. You can only submit one request every 4 hours.</p>
<div class="form-group">
<label for="withdrawAmount">Amount (Rs.)</label>
<input type="number" id="withdrawAmount" min="300" placeholder="Minimum 300" />
</div>
<div class="form-group">
<label for="withdrawMethod">Payment Method</label>
<select id="withdrawMethod">
<option value="easypaisa">EasyPaisa</option>
<option value="jazzcash">JazzCash</option>
<option value="bank">Bank Transfer</option>
</select>
</div>
<div class="form-group">
<label for="accountNumber">Account Number</label>
<input type="text" id="accountNumber" placeholder="Enter your account number" />
</div>
<div class="form-group">
<label for="accountName">Account Name</label>
<input type="text" id="accountName" placeholder="Enter account holder name" />
</div>
<button class="submit-btn" onclick="submitWithdraw()">Submit Withdrawal Request</button>

<div class="transaction-history" id="withdrawHistory">
<h3><i class="fas fa-history"></i> Withdrawal History</h3>
<!-- Will be populated by JavaScript -->
</div>
</div>

<!-- VIP Section -->
<div class="section" id="vipSection" style="display:none;">
<h2><i class="fas fa-crown"></i> VIP Program</h2>
<p style="color: var(--secondary);">Earn money by referring friends! When a user refers someone, the referral must make their first deposit. Only then will the referring user receive 5% of the referral's next withdrawal amount.</p>

<div class="referral-stats">
<div class="stat-box">
<div class="stat-label">Total Referrals</div>
<div class="stat-value" id="referralCount">0</div>
</div>
<div class="stat-box">
<div class="stat-label">Your Earnings</div>
<div class="stat-value" id="referralEarnings">Rs. 0</div>
</div>
<div class="stat-box">
<div class="stat-label">VIP Status</div>
<div class="stat-value" id="vipStatus">Basic</div>
</div>
</div>

<h3><i class="fas fa-user-plus"></i> Your Referral Code</h3>
<div class="referral-code" id="userReferralCode">
Login to see your code
<i class="far fa-copy referral-code-copy" onclick="copyReferralCode()" title="Copy to clipboard" style="display:none;"></i>
</div>

<h3><i class="fas fa-info-circle"></i> How It Works</h3>
<ol style="text-align: left; padding-left: 20px;">
<li>Share your unique referral code with friends</li>
<li>They sign up using your code and make their first deposit</li>
<li>You earn <b>5% of their next withdrawal amount</b></li>
<li>Withdraw your earnings anytime</li>
<li>Reach higher VIP levels for more benefits</li>
</ol>

<button class="submit-btn" onclick="shareReferralCode()" style="margin-top: 20px;">
<i class="fas fa-share-alt"></i> Share Your Referral Code
</button>
</div>

<!-- More Section -->
<div class="section" id="moreSection" style="display:none;">
<h2><i class="fas fa-ellipsis-h"></i> More</h2>

<h3><i class="fas fa-clock"></i> Withdrawal Request Status</h3>
<div class="transaction-history" id="withdrawStatus">
<!-- Will be populated by JavaScript -->
</div>

<h3><i class="fas fa-exchange-alt"></i> Transaction History</h3>
<div class="transaction-history" id="fullTransactionHistory">
<!-- Will be populated by JavaScript -->
</div>

<button class="submit-btn" onclick="refreshAllData()" style="margin-top: 20px;">
<i class="fas fa-sync-alt"></i> Refresh All Data
</button>
</div>

<audio id="bgMusic" loop>
<source src="https://cdn.pixabay.com/audio/2023/03/16/audio_98b541c254.mp3" type="audio/mp3">
</audio>
<audio id="flipSound">
<source src="https://cdn.pixabay.com/download/audio/2022/10/03/audio_07d4930c1c.mp3" type="audio/mp3">
</audio>
<audio id="winSound">
<source src="https://cdn.pixabay.com/download/audio/2022/03/21/audio_5a9f1d8e6b.mp3" type="audio/mp3">
</audio>
<audio id="loseSound">
<source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_0d8d2a5c8a.mp3" type="audio/mp3">
</audio>
<audio id="shotSound">
<source src="https://cdn.pixabay.com/download/audio/2023/08/19/audio_5a9f1d8e6b.mp3" type="audio/mp3">
</audio>

<!-- Firebase SDK -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBM7DY6i11IPk8DAvVA6tsgmz7Epi5bJh0",
  authDomain: "pakcashplay.firebaseapp.com",
  projectId: "pakcashplay",
  storageBucket: "pakcashplay.appspot.com",
  messagingSenderId: "551195851632",
  appId: "1:551195851632:web:4dcf6a8fb36d82e6a6adb5"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Game variables
let balance = 0;
let selectedBet = null;
let gameStarted = false;
let currentUser = null;
let lastWithdrawRequestTime = 0;

// Initialize games when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  checkAuthState();
  setupGames();

  // Show welcome popup on first visit
  if (!localStorage.getItem('welcomeShown')) {
    document.getElementById('welcomePopup').style.display = 'flex';
    localStorage.setItem('welcomeShown', 'true');
  }
});

// Authentication functions
function checkAuthState() {
  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      document.getElementById('authButtons').style.display = 'none';
      document.getElementById('logoutButton').style.display = 'block';
      document.getElementById('userDisplay').style.display = 'flex';
      loadUserData();
    } else {
      currentUser = null;
      document.getElementById('authButtons').style.display = 'flex';
      document.getElementById('logoutButton').style.display = 'none';
      document.getElementById('userDisplay').style.display = 'none';
      showSection('home');
      // Reset balance display when logged out
      document.getElementById('balanceAmount').textContent = '0';
    }
  });
}

function showAuthModal(tab) {
  document.getElementById('authModal').style.display = 'flex';
  switchAuthTab(tab);
}

function hideAuthModal() {
  document.getElementById('authModal').style.display = 'none';
}

function switchAuthTab(tab) {
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));

  if (tab === 'login') {
    document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
    document.getElementById('loginForm').classList.add('active');
  } else if (tab === 'signup') {
    document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
    document.getElementById('signupForm').classList.add('active');
  }
}

function showForgotPassword() {
  document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
  document.getElementById('forgotPasswordForm').classList.add('active');
}

function backToLogin() {
  switchAuthTab('login');
}

function loginUser() {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;

  if (!email || !password) {
    alert('Please enter both email and password');
    return;
  }

  // Show loading state
  const loginBtn = document.querySelector('#loginForm button');
  loginBtn.disabled = true;
  loginBtn.textContent = 'Logging in...';

  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      hideAuthModal();
      alert('Login successful! Welcome back.');

      // Update last login time
      if (currentUser) {
        db.collection('users').doc(currentUser.uid).update({
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
    })
    .catch(error => {
      let errorMessage = 'Login failed. ';
      switch(error.code) {
        case 'auth/user-not-found':
          errorMessage += 'No account found with this email.';
          break;
        case 'auth/wrong-password':
          errorMessage += 'Incorrect password.';
          break;
        case 'auth/invalid-email':
          errorMessage += 'The email address is invalid.';
          break;
        default:
          errorMessage += error.message;
      }
      alert(errorMessage);
    })
    .finally(() => {
      // Reset button state
      loginBtn.disabled = false;
      loginBtn.textContent = 'Login';
    });
}

function signupUser() {
  const email = document.getElementById('signupEmail').value;
  const password = document.getElementById('signupPassword').value;
  const name = document.getElementById('signupName').value;
  const phone = document.getElementById('signupPhone').value;
  const referralCode = document.getElementById('referralCode').value;

  // Validate all required fields
  if (!email || !password || !name || !phone) {
    alert('Please fill in all required fields');
    return;
  }

  // Validate email format
  if (!validateEmail(email)) {
    alert('Please enter a valid email address');
    return;
  }

  // Validate password length
  if (password.length < 6) {
    alert('Password should be at least 6 characters');
    return;
  }

  // Show loading state
  const signupBtn = document.querySelector('#signupForm button');
  signupBtn.disabled = true;
  signupBtn.textContent = 'Creating account...';

  // Create user with Firebase Auth
  auth.createUserWithEmailAndPassword(email, password)
    .then((userCredential) => {
      // Create user document in Firestore
      return db.collection('users').doc(userCredential.user.uid).set({
        name: name,
        phone: phone,
        email: email,
        balance: 0, // No welcome bonus
        referralCode: generateReferralCode(),
        referredBy: referralCode || null,
        referralCount: 0,
        referralEarnings: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
        depositCount: 0
      });
    })
    .then(() => {
      // If referral code was provided, update the referrer's stats
      if (referralCode) {
        return db.collection('users').where('referralCode', '==', referralCode).get()
          .then(querySnapshot => {
            if (!querySnapshot.empty) {
              const referrerId = querySnapshot.docs[0].id;
              return db.collection('users').doc(referrerId).update({
                referralCount: firebase.firestore.FieldValue.increment(1)
              });
            }
          });
      }
    })
    .then(() => {
      // Success - hide modal and show welcome message
      hideAuthModal();
      alert('Signup successful! Welcome to USCash.');

      // Reset form
      document.getElementById('signupForm').reset();
    })
    .catch(error => {
      // Handle specific errors
      let errorMessage = 'Signup failed. ';
      switch(error.code) {
        case 'auth/email-already-in-use':
          errorMessage += 'This email is already registered.';
          break;
        case 'auth/invalid-email':
          errorMessage += 'The email address is invalid.';
          break;
        case 'auth/weak-password':
          errorMessage += 'The password is too weak.';
          break;
        default:
          errorMessage += error.message;
      }
      alert(errorMessage);
    })
    .finally(() => {
      // Reset button state
      signupBtn.disabled = false;
      signupBtn.textContent = 'Sign Up';
    });
}

// Helper function to validate email
function validateEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

function resetPassword() {
  const email = document.getElementById('forgotEmail').value;

  if (!email) {
    alert('Please enter your email');
    return;
  }

  auth.sendPasswordResetEmail(email)
    .then(() => {
      alert('Password reset email sent! Please check your inbox.');
      backToLogin();
    })
    .catch(error => {
      alert('Error sending reset email: ' + error.message);
    });
}

function logoutUser() {
  auth.signOut().then(() => {
    showSection('home');
    alert('Logged out successfully');
    // Reset balance to zero when logging out
    balance = 0;
    document.getElementById('balanceAmount').textContent = '0';
  });
}

function generateReferralCode() {
  return Math.random().toString(36).substring(2, 8).toUpperCase();
}

function copyReferralCode() {
  const referralCode = document.getElementById('userReferralCode').textContent;
  navigator.clipboard.writeText(referralCode)
    .then(() => {
      alert('Referral code copied to clipboard!');
    })
    .catch(err => {
      console.error('Failed to copy: ', err);
    });
}

function shareReferralCode() {
  const referralCode = document.getElementById('userReferralCode').textContent;
  const shareText = `Join USCash and use my referral code: ${referralCode} to get bonus rewards!`;

  if (navigator.share) {
    navigator.share({
      title: 'USCash Referral',
      text: shareText,
      url: window.location.href
    })
    .catch(err => {
      console.error('Error sharing:', err);
      fallbackShare(referralCode, shareText);
    });
  } else {
    fallbackShare(referralCode, shareText);
  }
}

function fallbackShare(referralCode, shareText) {
  prompt('Copy your referral code to share:', shareText);
}

// User data functions
function loadUserData() {
  if (!currentUser) return;

  db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
    if (doc.exists) {
      const userData = doc.data();
      balance = userData.balance || 0;
      updateBalanceDisplay();

      // Update user display
      document.getElementById('usernameDisplay').textContent = userData.name || userData.email || 'User';
      document.getElementById('phoneDisplay').textContent = userData.phone || '';
      
      // Check if user is verified (cptanil1995@gmail.com or auk5562@gmail.com)
      if (userData.email === 'cptanil1995@gmail.com' || userData.email === 'auk5562@gmail.com') {
        document.getElementById('verifiedBadge').style.display = 'inline-block';
      }

      // Update VIP section if visible
      if (document.getElementById('vipSection').style.display === 'block') {
        document.getElementById('userReferralCode').textContent = userData.referralCode || 'N/A';
        document.getElementById('referralCount').textContent = userData.referralCount || 0;
        document.getElementById('referralEarnings').textContent = 'Rs. ' + (userData.referralEarnings || 0);

        // Show copy button if referral code exists
        if (userData.referralCode) {
          document.querySelector('.referral-code-copy').style.display = 'block';
        }

        // Set VIP status
        const earnings = userData.referralEarnings || 0;
        let vipStatus = 'Basic';
        if (earnings >= 5000) vipStatus = 'Gold';
        else if (earnings >= 1000) vipStatus = 'Silver';
        document.getElementById('vipStatus').textContent = vipStatus;
      }
    }
  });

  // Load transaction history
  loadTransactionHistory();
}

function refreshBalance() {
  if (currentUser) {
    db.collection('users').doc(currentUser.uid).get()
      .then(doc => {
        if (doc.exists) {
          balance = doc.data().balance || 0;
          updateBalanceDisplay();
          alert('Balance refreshed!');
        }
      });
  }
}

function refreshAllData() {
  refreshBalance();
  loadTransactionHistory();
  alert('All data refreshed!');
}

function updateBalanceDisplay() {
  document.getElementById('balanceAmount').textContent = Math.floor(balance);
}

// Transaction functions
function submitDeposit() {
  if (!currentUser) {
    alert('Please login to deposit');
    return;
  }

  const amount = parseFloat(document.getElementById('depositAmount').value);
  const method = document.getElementById('depositMethod').value;
  const transactionId = document.getElementById('transactionId').value;

  if (isNaN(amount) || amount < 150) {
    alert('Minimum deposit amount is Rs. 150');
    return;
  }

  if (!transactionId) {
    alert('Please enter transaction ID');
    return;
  }

  // Add deposit request
  db.collection('deposit_requests').add({
    userId: currentUser.uid,
    amount: amount,
    method: method,
    transactionId: transactionId,
    status: 'pending',
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    // Update user balance
    return db.collection('users').doc(currentUser.uid).update({
      balance: firebase.firestore.FieldValue.increment(amount),
      depositCount: firebase.firestore.FieldValue.increment(1)
    });
  })
  .then(() => {
    // Check if user was referred by someone and update their earnings (5% of first 5 deposits)
    return db.collection('users').doc(currentUser.uid).get()
      .then(doc => {
        const userData = doc.data();
        if (userData.referredBy && userData.depositCount <= 5) {
          return db.collection('users').where('referralCode', '==', userData.referredBy).get()
            .then(querySnapshot => {
              if (!querySnapshot.empty) {
                const referrerId = querySnapshot.docs[0].id;
                const referralEarnings = amount * 0.05; // 5% of deposit
                return db.collection('users').doc(referrerId).update({
                  referralEarnings: firebase.firestore.FieldValue.increment(referralEarnings)
                });
              }
            });
        }
      });
  })
  .then(() => {
    alert('Deposit request submitted successfully! Rs. ' + amount + ' added to your balance.');
    document.getElementById('depositAmount').value = '';
    document.getElementById('transactionId').value = '';
    loadTransactionHistory();
  })
  .catch(error => {
    alert('Error submitting deposit: ' + error.message);
  });
}

function submitWithdraw() {
  if (!currentUser) {
    alert('Please login to withdraw');
    return;
  }

  const amount = parseFloat(document.getElementById('withdrawAmount').value);
  const method = document.getElementById('withdrawMethod').value;
  const accountNumber = document.getElementById('accountNumber').value;
  const accountName = document.getElementById('accountName').value;

  if (isNaN(amount) || amount < 300) {
    alert('Minimum withdrawal amount is Rs. 300');
    return;
  }

  if (amount > balance) {
    alert('Insufficient balance');
    return;
  }

  if (!accountNumber || !accountName) {
    alert('Please enter account details');
    return;
  }

  // Check if 4 hours have passed since last request
  const now = Date.now();
  if (now - lastWithdrawRequestTime < 4 * 60 * 60 * 1000) {
    const hoursLeft = Math.ceil((4 * 60 * 60 * 1000 - (now - lastWithdrawRequestTime)) / (60 * 60 * 1000));
    alert(`You can only submit one withdrawal request every 4 hours. Please wait ${hoursLeft.toFixed(1)} more hours.`);
    return;
  }

  // Deduct amount from balance immediately
  db.collection('users').doc(currentUser.uid).update({
    balance: firebase.firestore.FieldValue.increment(-amount)
  })
  .then(() => {
    // Add withdrawal request
    return db.collection('withdraw_requests').add({
      userId: currentUser.uid,
      amount: amount,
      method: method,
      accountNumber: accountNumber,
      accountName: accountName,
      status: 'pending',
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
  })
  .then(() => {
    lastWithdrawRequestTime = Date.now();
    alert('Withdrawal request submitted successfully! It will be processed within 24 hours.');
    document.getElementById('withdrawAmount').value = '';
    document.getElementById('accountNumber').value = '';
    document.getElementById('accountName').value = '';
    loadTransactionHistory();
    
    // Check if user was referred by someone and give 5% of withdrawal to referrer
    return db.collection('users').doc(currentUser.uid).get()
      .then(doc => {
        const userData = doc.data();
        if (userData.referredBy) {
          return db.collection('users').where('referralCode', '==', userData.referredBy).get()
            .then(querySnapshot => {
              if (!querySnapshot.empty) {
                const referrerId = querySnapshot.docs[0].id;
                const referralEarnings = amount * 0.05; // 5% of withdrawal
                return db.collection('users').doc(referrerId).update({
                  referralEarnings: firebase.firestore.FieldValue.increment(referralEarnings)
                });
              }
            });
        }
      });
  })
  .catch(error => {
    alert('Error submitting withdrawal: ' + error.message);
  });
}

function loadTransactionHistory() {
  if (!currentUser) return;

  // Load deposit history
  db.collection('deposit_requests')
    .where('userId', '==', currentUser.uid)
    .orderBy('createdAt', 'desc')
    .limit(10)
    .get()
    .then(querySnapshot => {
      const depositHistory = document.getElementById('depositHistory');
      depositHistory.innerHTML = '<h3><i class="fas fa-history"></i> Deposit History</h3>';

      if (querySnapshot.empty) {
        depositHistory.innerHTML += '<p>No deposit history found</p>';
        return;
      }

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const item = document.createElement('div');
        item.className = 'transaction-item';

        let statusClass = 'transaction-pending';
        if (data.status === 'approved') statusClass = 'transaction-approved';
        if (data.status === 'rejected') statusClass = 'transaction-rejected';

        item.innerHTML = `
          <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
          <div>Method: ${data.method}</div>
          <div>Status: <span class="${statusClass}">${data.status}</span></div>
          <div>Date: ${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
        `;

        depositHistory.appendChild(item);
      });
    });

  // Load withdrawal history
  db.collection('withdraw_requests')
    .where('userId', '==', currentUser.uid)
    .orderBy('createdAt', 'desc')
    .limit(10)
    .get()
    .then(querySnapshot => {
      const withdrawHistory = document.getElementById('withdrawHistory');
      withdrawHistory.innerHTML = '<h3><i class="fas fa-history"></i> Withdrawal History</h3>';

      if (querySnapshot.empty) {
        withdrawHistory.innerHTML += '<p>No withdrawal history found</p>';
        return;
      }

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const item = document.createElement('div');
        item.className = 'transaction-item';

        let statusClass = 'transaction-pending';
        if (data.status === 'approved') statusClass = 'transaction-approved';
        if (data.status === 'rejected') statusClass = 'transaction-rejected';

        item.innerHTML = `
          <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
          <div>Method: ${data.method}</div>
          <div>Status: <span class="${statusClass}">${data.status}</span></div>
          <div>Date: ${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
        `;

        withdrawHistory.appendChild(item);
      });
    });

  // Load withdrawal status for "More" section
  db.collection('withdraw_requests')
    .where('userId', '==', currentUser.uid)
    .orderBy('createdAt', 'desc')
    .limit(5)
    .get()
    .then(querySnapshot => {
      const withdrawStatus = document.getElementById('withdrawStatus');
      withdrawStatus.innerHTML = '';

      if (querySnapshot.empty) {
        withdrawStatus.innerHTML = '<p>No withdrawal requests found</p>';
        return;
      }

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const item = document.createElement('div');
        item.className = 'transaction-item';

        let statusClass = 'transaction-pending';
        if (data.status === 'approved') statusClass = 'transaction-approved';
        if (data.status === 'rejected') statusClass = 'transaction-rejected';

        item.innerHTML = `
          <div>Amount: <span class="transaction-amount">Rs. ${data.amount}</span></div>
          <div>Status: <span class="${statusClass}">${data.status}</span></div>
          <div>Date: ${data.createdAt?.toDate().toLocaleString() || 'N/A'}</div>
        `;

        withdrawStatus.appendChild(item);
      });
    });

  // Load full transaction history
  const fullHistory = document.getElementById('fullTransactionHistory');
  fullHistory.innerHTML = '';

  // Combine deposits and withdrawals for full history
  Promise.all([
    db.collection('deposit_requests')
      .where('userId', '==', currentUser.uid)
      .orderBy('createdAt', 'desc')
      .limit(10)
      .get(),
    db.collection('withdraw_requests')
      .where('userId', '==', currentUser.uid)
      .orderBy('createdAt', 'desc')
      .limit(10)
      .get()
  ])
  .then(([deposits, withdrawals]) => {
    const allTransactions = [];

    deposits.forEach(doc => {
      const data = doc.data();
      allTransactions.push({
        type: 'deposit',
        amount: data.amount,
        status: data.status,
        date: data.createdAt,
        method: data.method
      });
    });

    withdrawals.forEach(doc => {
      const data = doc.data();
      allTransactions.push({
        type: 'withdrawal',
        amount: data.amount,
        status: data.status,
        date: data.createdAt,
        method: data.method
      });
    });

    // Sort by date
    allTransactions.sort((a, b) => (b.date?.seconds || 0) - (a.date?.seconds || 0));

    if (allTransactions.length === 0) {
      fullHistory.innerHTML = '<p>No transaction history found</p>';
      return;
    }

    allTransactions.forEach(trans => {
      const item = document.createElement('div');
      item.className = 'transaction-item';

      let statusClass = 'transaction-pending';
      if (trans.status === 'approved') statusClass = 'transaction-approved';
      if (trans.status === 'rejected') statusClass = 'transaction-rejected';

      item.innerHTML = `
        <div>Type: ${trans.type === 'deposit' ? 'Deposit' : 'Withdrawal'}</div>
        <div>Amount: <span class="transaction-amount">Rs. ${trans.amount}</span></div>
        <div>Method: ${trans.method}</div>
        <div>Status: <span class="${statusClass}">${trans.status}</span></div>
        <div>Date: ${trans.date?.toDate().toLocaleString() || 'N/A'}</div>
      `;

      fullHistory.appendChild(item);
    });
  });
}

// Navigation functions
function showSection(section) {
  document.querySelectorAll('.section').forEach(sec => {
    sec.style.display = 'none';
  });

  switch(section) {
    case 'home':
      document.getElementById('homeSection').style.display = 'block';
      break;
    case 'deposit':
      if (!currentUser) {
        showAuthModal('login');
        return;
      }
      document.getElementById('depositSection').style.display = 'block';
      break;
    case 'withdraw':
      if (!currentUser) {
        showAuthModal('login');
        return;
      }
      document.getElementById('withdrawSection').style.display = 'block';
      break;
    case 'vip':
      if (!currentUser) {
        showAuthModal('login');
        return;
      }
      document.getElementById('vipSection').style.display = 'block';
      // Load VIP data if not already loaded
      if (document.getElementById('userReferralCode').textContent === 'Login to see your code') {
        loadUserData();
      }
      break;
    case 'more':
      if (!currentUser) {
        showAuthModal('login');
        return;
      }
      document.getElementById('moreSection').style.display = 'block';
      loadTransactionHistory();
      break;
  }
}

// Game setup
function setupGames() {
  setupScratchGame();
  setupFruitGame();
  setupTicTacToeGame();
  setupFindAceGame();
  setupArcheryGame();
}

// Scratch Game
let icons = ['üêÑ', 'üêî', 'üê±', 'üê∂', 'üê≠'];
let cardData = [];
let flippedCards = [];

function setupScratchGame() {
  icons = ['üêÑ', 'üêî', 'üê±', 'üê∂', 'üê≠'];
  cardData = [];
  flippedCards = [];
}

function startCardGame() {
  document.getElementById('scratchGame').style.display = 'block';
  document.getElementById('fruitGame').style.display = 'none';
  document.getElementById('tictactoeGame').style.display = 'none';
  document.getElementById('findAceGame').style.display = 'none';
  document.getElementById('archeryGame').style.display = 'none';
  bgMusic.play().catch(() => {});
  setupCards();
}

function setupCards() {
  flippedCards = [];
  cardData = [];
  gameStarted = false;
  const grid = document.getElementById('cardGrid');
  grid.classList.remove('shake', 'glow');
  grid.innerHTML = '';
  document.getElementById("particles-js").style.display = "none";
  document.getElementById("result").innerText = '';

  // Only 9 cards with 3 sets of identical icons
  let allIcons = [];
  for (let i = 0; i < 3; i++) {
    // Select 3 random icons
    const randomIcons = [...icons].sort(() => 0.5 - Math.random()).slice(0, 3);
    randomIcons.forEach(icon => allIcons.push(icon));
  }

  allIcons.forEach((icon) => {
    const card = document.createElement('div');
    card.classList.add('card');
    card.dataset.icon = icon;
    grid.appendChild(card);
    cardData.push({ element: card, icon: icon });
  });
}

function selectBet(amount) {
  if (gameStarted) return;
  selectedBet = amount;
  document.querySelectorAll('#scratchGame .bet-amounts .gold-box').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  revealAndShuffleCards();
}

function revealAndShuffleCards() {
  const grid = document.getElementById('cardGrid');
  setupCards();

  cardData.forEach(data => {
    data.element.innerText = data.icon;
    data.element.classList.add('flipped');
  });

  setTimeout(() => {
    // Shuffle
    cardData.sort(() => Math.random() - 0.5);
    grid.innerHTML = '';
    cardData.forEach(data => {
      data.element.innerText = '';
      data.element.classList.remove('flipped');
      data.element.onclick = () => flipCard(data.element);
      grid.appendChild(data.element);
    });
  }, 2000);
}

function flipCard(card) {
  if (!selectedBet) {
    alert("Please select a bet amount before starting!");
    return;
  }
  if (flippedCards.includes(card) || flippedCards.length >= 3) return;
  if (!gameStarted) gameStarted = true;

  card.classList.add('flipped');
  card.innerText = card.dataset.icon;
  flipSound.currentTime = 0;
  flipSound.play().catch(() => {});
  flippedCards.push(card);

  if (flippedCards.length === 3) {
    setTimeout(checkWin, 1000);
  }
}

function checkWin() {
  const iconsPicked = flippedCards.map(c => c.dataset.icon);
  const counts = {};
  iconsPicked.forEach(icon => counts[icon] = (counts[icon] || 0) + 1);

  // Need 3 matching icons to win
  const won = Object.values(counts).some(count => count >= 3);
  const result = document.getElementById('result');
  const grid = document.getElementById('cardGrid');

  if (won) {
    const winAmount = selectedBet * 2;
    balance += winAmount;
    updateUserBalance(balance);
    result.innerText = `üéâ You won! Rs. ${winAmount} added.`;
    grid.classList.add('glow');
    document.getElementById("particles-js").style.display = "block";
    document.getElementById('winSound').play().catch(() => {});
    setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
  } else {
    // 15% loss on draw as requested
    const deduction = selectedBet * 0.15;
    if (balance - deduction < 0) {
      result.innerText = `üí∏ Insufficient balance! Please deposit more to continue.`;
    } else {
      balance -= deduction;
      updateUserBalance(balance);
      result.innerText = `‚ùå You lost! Rs. ${deduction} deducted.`;
    }
    grid.classList.add('shake');
    document.getElementById('loseSound').play().catch(() => {});
  }

  updateBalanceDisplay();

  setTimeout(() => {
    result.innerText = '';
    setupCards();
    if (balance <= 0) {
      alert("Your balance is too low. Please deposit to play again.");
      document.getElementById('scratchGame').style.display = 'none';
    }
  }, 2500);
}

function updateUserBalance(newBalance) {
  if (!currentUser) return;

  db.collection('users').doc(currentUser.uid).update({
    balance: newBalance
  })
  .catch(error => {
    console.error('Error updating balance:', error);
  });
}

// Fruit Game
const colors = ["red", "green", "yellow", "blue", "purple"];
const fruits = {
  red: "üçé",
  green: "üçè",
  yellow: "üçã",
  blue: "üçá",
  purple: "üçÜ"
};
const durations = {
  20: 8000,
  50: 15000,
  100: 30000,
  150: 45000,
  200: 60000
};

let targetColor = "";
let fruitScore = 0;
let fruitGameInterval, fruitGameTimer, fruitCountdownInterval;
let fruitGameStarted = false;
let fruitSelectedBet = 0;

function setupFruitGame() {
  setNewFruitTarget();
}

function startFruitGame() {
  document.getElementById('scratchGame').style.display = 'none';
  document.getElementById('fruitGame').style.display = 'block';
  document.getElementById('tictactoeGame').style.display = 'none';
  document.getElementById('findAceGame').style.display = 'none';
  document.getElementById('archeryGame').style.display = 'none';
  setNewFruitTarget();
}

function setNewFruitTarget() {
  targetColor = colors[Math.floor(Math.random() * colors.length)];
  document.getElementById("fruitTargetDisplay").innerHTML = `Target: Shoot the <b style="color:${targetColor};">${targetColor.toUpperCase()}</b> Fruit ${fruits[targetColor]}`;
}

function spawnFruit() {
  const shootArea = document.getElementById("shootArea");
  if (shootArea.childElementCount >= 10) return;

  const fruit = document.createElement("div");
  fruit.classList.add("fruit");

  const isTarget = Math.random() < 0.40;
  const color = isTarget ? targetColor : colors[Math.floor(Math.random() * colors.length)];
  fruit.style.color = color;
  fruit.innerText = fruits[color];

  const size = Math.random() * 30 + 20;
  fruit.style.fontSize = `${size}px`;

  const x = Math.random() * (shootArea.clientWidth - 40);
  fruit.style.left = `${x}px`;
  fruit.style.top = "-30px";

  fruit.addEventListener("click", () => {
    if (!fruitGameStarted || fruit.clicked) return;
    fruit.clicked = true;

    if (color === targetColor) {
      fruitScore++;
    } else {
      fruitScore = Math.max(0, fruitScore - 2);
    }
    document.getElementById("fruitScoreDisplay").textContent = `Score: ${fruitScore}`;
    fruit.remove();
  });

  shootArea.appendChild(fruit);

  let top = -30;
  const fallSpeed = setInterval(() => {
    top += 15;
    fruit.style.top = `${top}px`;
    if (top > shootArea.clientHeight) {
      clearInterval(fallSpeed);
      fruit.remove();
    }
  }, 50);
}

function startFruitRound(amount) {
  if (fruitGameStarted || balance < amount) {
    if (balance < amount) {
      alert("Insufficient balance! Please deposit more to play.");
    }
    return;
  }

  balance -= amount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  document.getElementById("shootArea").innerHTML = "";
  clearInterval(fruitGameInterval);
  clearInterval(fruitCountdownInterval);
  clearTimeout(fruitGameTimer);
  fruitScore = 0;
  document.getElementById("fruitScoreDisplay").innerText = "Score: 0";
  setNewFruitTarget();

  fruitSelectedBet = amount;
  fruitGameStarted = true;

  document.querySelectorAll('#fruitGame .bet-amounts .gold-box').forEach(btn => {
    btn.style.pointerEvents = "none";
    btn.style.opacity = "0.4";
  });

  let timeLeft = durations[amount] / 1000;
  document.getElementById("fruitCountdown").innerText = `Time: ${timeLeft}s`;

  fruitCountdownInterval = setInterval(() => {
    timeLeft--;
    document.getElementById("fruitCountdown").innerText = `Time: ${timeLeft}s`;
    if (timeLeft <= 0) clearInterval(fruitCountdownInterval);
  }, 1000);

  fruitGameInterval = setInterval(spawnFruit, 200);

  fruitGameTimer = setTimeout(() => {
    clearInterval(fruitGameInterval);
    clearInterval(fruitCountdownInterval);
    fruitGameStarted = false;

    let winAmount = 0;
    if (fruitScore >= Math.floor(fruitSelectedBet * 1.5)) {
      winAmount = fruitSelectedBet * 2;
      balance += winAmount;
      updateUserBalance(balance);
      alert(`üéâ Congratulations! You scored ${fruitScore} points (Target: ${Math.floor(fruitSelectedBet * 1.5)}).\nYou won Rs. ${winAmount}!\nNew Balance: Rs. ${balance}`);
      document.getElementById('winSound').play().catch(() => {});
    } else {
      alert(`‚ùå Game Over! You scored ${fruitScore} points (Target: ${Math.floor(fruitSelectedBet * 1.5)}).\nYou lost your bet of Rs. ${fruitSelectedBet}.\nNew Balance: Rs. ${balance}`);
      document.getElementById('loseSound').play().catch(() => {});
    }

    updateBalanceDisplay();

    document.querySelectorAll('#fruitGame .bet-amounts .gold-box').forEach(btn => {
      btn.style.pointerEvents = "auto";
      btn.style.opacity = "1";
    });

    document.getElementById("shootArea").innerHTML = "";
    document.getElementById("fruitScoreDisplay").innerText = "";
    document.getElementById("fruitCountdown").innerText = "Time: 0s";
    setNewFruitTarget();

  }, durations[amount]);
}

// Tic Tac Toe Game
let ticTacToeBoard = ['', '', '', '', '', '', '', '', ''];
let currentPlayer = 'X';
let ticTacToeGameActive = false;
let ticTacToeBetAmount = 0;
let ticTacToeCountdown = 30;
let ticTacToeTimer;

function setupTicTacToeGame() {
  ticTacToeBoard = ['', '', '', '', '', '', '', '', ''];
  currentPlayer = 'X';
}

function startTicTacToeGame() {
  document.getElementById('scratchGame').style.display = 'none';
  document.getElementById('fruitGame').style.display = 'none';
  document.getElementById('tictactoeGame').style.display = 'block';
  document.getElementById('findAceGame').style.display = 'none';
  document.getElementById('archeryGame').style.display = 'none';
  setupTicTacToeGame();
  renderTicTacToeBoard();
}

function selectTicTacToeBet(amount) {
  if (ticTacToeGameActive) return;

  if (balance < amount) {
    alert("Insufficient balance! Please deposit more to play.");
    return;
  }

  ticTacToeBetAmount = amount;
  document.querySelectorAll('#tictactoeGame .bet-amounts .gold-box').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');

  startTicTacToeRound();
}

function startTicTacToeRound() {
  ticTacToeGameActive = true;
  currentPlayer = 'X';
  ticTacToeBoard = ['', '', '', '', '', '', '', '', ''];
  ticTacToeCountdown = 30;

  balance -= ticTacToeBetAmount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  document.getElementById('tictactoeCountdown').textContent = `Time: ${ticTacToeCountdown}s`;
  ticTacToeTimer = setInterval(() => {
    ticTacToeCountdown--;
    document.getElementById('tictactoeCountdown').textContent = `Time: ${ticTacToeCountdown}s`;

    if (ticTacToeCountdown <= 0) {
      clearInterval(ticTacToeTimer);
      endTicTacToeGame(false, "Time's up! Game ended in a draw.");
    }
  }, 1000);

  renderTicTacToeBoard();
  document.getElementById('tictactoeResult').textContent = "Your turn (X)";
}

function renderTicTacToeBoard() {
  const boardElement = document.getElementById('ticTacToeBoard');
  boardElement.innerHTML = '';

  for (let i = 0; i < 9; i++) {
    const cell = document.createElement('div');
    cell.className = 'tic-tac-toe-cell';
    cell.textContent = ticTacToeBoard[i];
    cell.onclick = () => makeTicTacToeMove(i);
    boardElement.appendChild(cell);
  }
}

function makeTicTacToeMove(index) {
  if (!ticTacToeGameActive || ticTacToeBoard[index] !== '' || currentPlayer !== 'X') return;

  ticTacToeBoard[index] = 'X';
  renderTicTacToeBoard();

  if (checkTicTacToeWin('X')) {
    endTicTacToeGame(true, "You won! Rs. " + (ticTacToeBetAmount * 2) + " added to your balance.");
    return;
  }

  if (!ticTacToeBoard.includes('')) {
    endTicTacToeGame(false, "Game ended in a draw. You lost 25% of your bet.");
    return;
  }

  document.getElementById('tictactoeResult').textContent = "Computer thinking...";

  setTimeout(() => {
    let move = findWinningMove('O');
    if (move === -1) {
      move = findWinningMove('X');
      if (move === -1) {
        const emptyCells = [];
        for (let i = 0; i < 9; i++) {
          if (ticTacToeBoard[i] === '') emptyCells.push(i);
        }

        const smartMoves = [];
        const corners = [0, 2, 6, 8];
        for (const cell of emptyCells) {
          if (cell === 4) {
            move = cell;
            break;
          } else if (corners.includes(cell)) {
            smartMoves.push(cell);
          }
        }

        if (move === undefined && smartMoves.length > 0) {
          move = smartMoves[Math.floor(Math.random() * smartMoves.length)];
        } else if (move === undefined) {
          move = emptyCells[Math.floor(Math.random() * emptyCells.length)];
        }
      }
    }

    ticTacToeBoard[move] = 'O';
    renderTicTacToeBoard();

    if (checkTicTacToeWin('O')) {
      endTicTacToeGame(false, "Computer won! You lost your bet.");
      return;
    }

    if (!ticTacToeBoard.includes('')) {
      endTicTacToeGame(false, "Game ended in a draw. You lost 25% of your bet.");
      return;
    }

    document.getElementById('tictactoeResult').textContent = "Your turn (X)";
  }, 1000);
}

function findWinningMove(player) {
  const winPatterns = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8],
    [0, 3, 6], [1, 4, 7], [2, 5, 8],
    [0, 4, 8], [2, 4, 6]
  ];

  for (const pattern of winPatterns) {
    const [a, b, c] = pattern;
    if (ticTacToeBoard[a] === player && ticTacToeBoard[b] === player && ticTacToeBoard[c] === '') return c;
    if (ticTacToeBoard[a] === player && ticTacToeBoard[c] === player && ticTacToeBoard[b] === '') return b;
    if (ticTacToeBoard[b] === player && ticTacToeBoard[c] === player && ticTacToeBoard[a] === '') return a;
  }

  return -1;
}

function checkTicTacToeWin(player) {
  const winPatterns = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8],
    [0, 3, 6], [1, 4, 7], [2, 5, 8],
    [0, 4, 8], [2, 4, 6]
  ];

  return winPatterns.some(pattern => {
    return pattern.every(index => ticTacToeBoard[index] === player);
  });
}

function endTicTacToeGame(playerWon, message) {
  clearInterval(ticTacToeTimer);
  ticTacToeGameActive = false;

  if (playerWon) {
    const winAmount = ticTacToeBetAmount * 2;
    balance += winAmount;
    document.getElementById('winSound').play().catch(() => {});
  } else {
    const deduction = ticTacToeBetAmount * 0.25;
    balance -= deduction;
    document.getElementById('loseSound').play().catch(() => {});
  }

  updateUserBalance(balance);
  updateBalanceDisplay();

  document.getElementById('tictactoeResult').textContent = message;
  document.querySelectorAll('#tictactoeGame .bet-amounts .gold-box').forEach(btn => {
    btn.classList.remove('active');
  });

  if (playerWon) {
    document.getElementById("particles-js").style.display = "block";
    setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
  }
}

// Find Ace Game
let findAceCards = [];
let findAceFlippedCards = [];
let findAceGameActive = false;
let findAceBetAmount = 0;
let findAceTimer;
let findAceCountdown = 15;

function setupFindAceGame() {
  findAceCards = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
}

function startFindAceGame() {
  document.getElementById('scratchGame').style.display = 'none';
  document.getElementById('fruitGame').style.display = 'none';
  document.getElementById('tictactoeGame').style.display = 'none';
  document.getElementById('findAceGame').style.display = 'block';
  document.getElementById('archeryGame').style.display = 'none';
  setupFindAceGame();
}

function startFindAceRound(amount) {
  if (findAceGameActive || balance < amount) {
    if (balance < amount) {
      alert("Insufficient balance! Please deposit more to play.");
    }
    return;
  }

  findAceBetAmount = amount;
  findAceGameActive = true;
  findAceFlippedCards = [];

  balance -= amount;
  updateUserBalance(balance);
  updateBalanceDisplay();

  document.getElementById('findAceResult').textContent = '';
  document.getElementById('findAceGrid').innerHTML = '';

  const cardsToShow = shuffleArray([...findAceCards]).slice(0, 3);
  const grid = document.getElementById('findAceGrid');

  cardsToShow.forEach((card, index) => {
    const cardElement = document.createElement('div');
    cardElement.className = 'card flipped';
    cardElement.textContent = card;
    cardElement.dataset.value = card;
    grid.appendChild(cardElement);
  });

  findAceCountdown = 15;
  document.getElementById('findAceCountdown').textContent = `Time: ${findAceCountdown}s`;

  const countdownInterval = setInterval(() => {
    findAceCountdown--;
    document.getElementById('findAceCountdown').textContent = `Time: ${findAceCountdown}s`;

    if (findAceCountdown <= 0) {
      clearInterval(countdownInterval);
      endFindAceRound(false, "Time's up! You lost your bet.");
    }
  }, 1000);

  setTimeout(() => {
    document.querySelectorAll('#findAceGrid .card').forEach(card => {
      card.textContent = '';
      card.classList.remove('flipped');
    });

    let shuffleCount = 0;
    const shuffleInterval = setInterval(() => {
      const cards = Array.from(document.querySelectorAll('#findAceGrid .card'));
      cards.forEach(card => {
        const randomIndex = Math.floor(Math.random() * cards.length);
        const temp = card.style.order;
        card.style.order = cards[randomIndex].style.order;
        cards[randomIndex].style.order = temp;
      });

      shuffleCount++;
      if (shuffleCount >= 60) {
        clearInterval(shuffleInterval);

        document.querySelectorAll('#findAceGrid .card').forEach(card => {
          card.onclick = () => flipFindAceCard(card);
        });
      }
    }, 50);
  }, 3000);
}

function flipFindAceCard(card) {
  if (!findAceGameActive || card.classList.contains('flipped')) return;

  card.classList.add('flipped');
  card.textContent = card.dataset.value;
  flipSound.currentTime = 0;
  flipSound.play().catch(() => {});

  if (card.dataset.value === 'A') {
    endFindAceRound(true, "üéâ You found the Ace! You win double your bet.");
  } else {
    endFindAceRound(false, "‚ùå Wrong card! You lost your bet.");
  }
}

function endFindAceRound(won, message) {
  findAceGameActive = false;

  if (won) {
    const winAmount = findAceBetAmount * 2;
    balance += winAmount;
    document.getElementById('winSound').play().catch(() => {});
  } else {
    document.getElementById('loseSound').play().catch(() => {});
  }

  updateUserBalance(balance);
  updateBalanceDisplay();

  document.getElementById('findAceResult').textContent = message;

  if (won) {
    document.getElementById("particles-js").style.display = "block";
    setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
  }
}

// Archery Game
let archeryBet = 0;
let archeryShots = [];
let archeryAutoMode = false;
let archeryGameActive = false;

function setupArcheryGame() {
  const canvas = document.getElementById('archeryCanvas');
  const ctx = canvas.getContext('2d');

  let DPR = window.devicePixelRatio || 1;
  function fixCanvas() {
    const cssW = canvas.clientWidth || canvas.width;
    const cssH = canvas.clientHeight || canvas.height;
    canvas.width = Math.round(cssW * DPR);
    canvas.height = Math.round(cssH * DPR);
    canvas.style.width = cssW + 'px';
    canvas.style.height = cssH + 'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  fixCanvas();
  window.addEventListener('resize', () => { fixCanvas(); drawArchery(); });

  const W = canvas.width / DPR;
  const H = canvas.height / DPR;
  const cx = W/2;
  const cy = H/2;

  let boardRadius = Math.min(W,H) * 0.42;

  const ringDefs = [
    {score:10, colorInner:'#ffdd66', colorOuter:'#ffcc00', radiusRatio:0.06},
    {score:8, colorInner:'#ffb76b', colorOuter:'#ff8f2e', radiusRatio:0.16},
    {score:7, colorInner:'#ff6b6b', colorOuter:'#d6453b', radiusRatio:0.28},
    {score:5, colorInner:'#3aa0ff', colorOuter:'#1475c7', radiusRatio:0.45},
    {score:2, colorInner:'#2e3136', colorOuter:'#0f1112', radiusRatio:0.70},
    {score:1, colorInner:'#f6f6f6', colorOuter:'#e9e9e9', radiusRatio:1.00}
  ];

  const ringRadii = ringDefs.map(r => boardRadius * r.radiusRatio);

  let sight = {
    x: W - 8,
    y: cy,
    radius: 14, // Increased size by 2x as requested
    movingLeft: true,
    speed: 6.0,
    active: false,
    auto: false,
    _lastCross: false
  };

  function drawBoard(){
    const woodR = boardRadius * 1.08;
    const g = ctx.createLinearGradient(cx, cy-woodR, cx, cy+woodR);
    g.addColorStop(0,'#7a5232'); g.addColorStop(0.5,'#a8764f'); g.addColorStop(1,'#5b391f');
    ctx.beginPath();
    ctx.arc(cx, cy, woodR, 0, Math.PI*2);
    ctx.fillStyle = g; ctx.fill();

    ctx.beginPath();
    ctx.arc(cx, cy, boardRadius + 6, 0, Math.PI*2);
    ctx.fillStyle = '#f8f5ee'; ctx.fill();

    for(let i = ringDefs.length-1; i >= 0; i--){
      const rd = ringRadii[i];
      const def = ringDefs[i];
      const grad = ctx.createRadialGradient(cx, cy, rd*0.1, cx, cy, rd);
      grad.addColorStop(0, def.colorInner);
      grad.addColorStop(1, def.colorOuter);
      ctx.beginPath();
      ctx.arc(cx, cy, rd, 0, Math.PI*2);
      ctx.fillStyle = grad;
      ctx.fill();

      ctx.beginPath();
      ctx.arc(cx, cy, rd, 0, Math.PI*2);
      ctx.lineWidth = 1;
      ctx.strokeStyle = 'rgba(0,0,0,0.18)';
      ctx.stroke();
    }

    ctx.beginPath();
    ctx.arc(cx, cy, 2.2, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(255,255,255,0.06)';
    ctx.fill();
  }

  function drawSight(){
    if(!sight.active) return;
    ctx.save();
    ctx.translate(sight.x, sight.y);
    ctx.beginPath();
    ctx.arc(0,0, sight.radius+6, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(30,220,120,0.04)';
    ctx.fill();
    ctx.beginPath();
    ctx.arc(0,0, sight.radius, 0, Math.PI*2);
    ctx.lineWidth = 2;
    ctx.strokeStyle = 'rgba(180,255,200,0.95)';
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(-14,0); ctx.lineTo(-6,0);
    ctx.moveTo(6,0); ctx.lineTo(14,0);
    ctx.moveTo(0,-14); ctx.lineTo(0,-6);
    ctx.moveTo(0,6); ctx.lineTo(0,14);
    ctx.strokeStyle = 'rgba(180,255,200,0.9)';
    ctx.lineWidth = 1.6;
    ctx.stroke();
    ctx.restore();
  }

  function updateSight(){
    if(!sight.active) return;
    if(sight.movingLeft){
      sight.x -= sight.speed;
      if(sight.x <= 8){
        sight.x = 8;
        sight.movingLeft = false;
      }
    } else {
      sight.x += sight.speed;
      if(sight.x >= W - 8){
        sight.x = W - 8;
        sight.movingLeft = true;
      }
    }

    if(sight.auto){
      const centerBand = 8;
      if(!sight._lastCross && Math.abs(sight.x - cx) <= centerBand){
        sight._lastCross = true;
        performShot();
      } else if(Math.abs(sight.x - cx) > centerBand){
        sight._lastCross = false;
      }
    }
  }

  function computeScore(px, py){
    const dx = px - cx;
    const dy = py - cy;
    const dist = Math.sqrt(dx*dx + dy*dy);
    for(let i=0;i<ringRadii.length;i++){
      if(dist <= ringRadii[i]) {
        return ringDefs[i].score;
      }
    }
    return 0;
  }

  function performShot(){
    if(!sight.active) return;
    if(archeryBet === 0){
      document.getElementById('archeryStatus').textContent = 'You must select a bet first.';
      return;
    }
    if(archeryShots.length >= 5) return;

    const score = computeScore(sight.x, sight.y);
    archeryShots.push(score);
    refreshScoreBoxes();

    document.getElementById('archeryStatus').textContent = `Shot ${archeryShots.length} ‚Üí ${score} points`;
    document.getElementById('shotSound').play().catch(() => {});

    if(archeryShots.length === 5){
      sight.active = false;
      let allTen = archeryShots.every(s=> s === 10);
      if(allTen){
        balance += archeryBet;
        document.getElementById('archeryStatus').textContent = `üéâ PERFECT! All 5 are bullseyes. You doubled your bet to ‚Ç®${archeryBet*2}`;
        document.getElementById('winSound').play().catch(() => {});
        document.getElementById("particles-js").style.display = "block";
        setTimeout(() => document.getElementById("particles-js").style.display = "none", 2500);
      } else {
        balance -= archeryBet;
        if(balance < 0) balance = 0;
        document.getElementById('archeryStatus').textContent = `‚úñ You lost the bet of ‚Ç®${archeryBet}.`;
        document.getElementById('loseSound').play().catch(() => {});
      }
      updateUserBalance(balance);
      updateBalanceDisplay();
    }
  }

  function refreshScoreBoxes(){
    const scoreBoxes = document.querySelectorAll('#archeryScoreRow .archery-score-box');
    for(let i=0;i<5;i++){
      scoreBoxes[i].textContent = archeryShots[i] !== undefined ? archeryShots[i] : '';
    }
  }

  canvas.addEventListener('click', ()=> {
    performShot();
  });

  function drawArchery(){
    ctx.clearRect(0,0,W,H);
    drawBoard();
    drawSight();
  }

  function loop(){
    updateSight();
    drawArchery();
    requestAnimationFrame(loop);
  }
  loop();

  window.selectArcheryBet = function(amount){
    if (archeryGameActive) return;

    if (balance < amount) {
      alert("Insufficient balance! Please deposit more to play.");
      return;
    }

    archeryBet = amount;
    archeryShots = [];
    const scoreBoxes = document.querySelectorAll('#archeryScoreRow .archery-score-box');
    for(let b of scoreBoxes) b.textContent = '';
    sight.x = W - 8;
    sight.y = cy;
    sight.movingLeft = true;
    sight.active = true;
    archeryGameActive = true;

    balance -= amount;
    updateUserBalance(balance);
    updateBalanceDisplay();

    document.getElementById('archeryStatus').textContent = `Bet ‚Ç® ${archeryBet} placed ‚Äî 5 shots. Click canvas to shoot when sight passes.`;
  };

  window.resetArcheryGame = function(){
    archeryBet = 0;
    archeryShots = [];
    const scoreBoxes = document.querySelectorAll('#archeryScoreRow .archery-score-box');
    for(let b of scoreBoxes) b.textContent = '';
    sight.active = false;
    archeryGameActive = false;
    document.getElementById('archeryStatus').textContent = 'Pick a bet to start';
  };

  window.toggleArcheryAuto = function(){
    archeryAutoMode = !archeryAutoMode;
    document.getElementById('archeryAutoBtn').textContent = 'Auto: ' + (archeryAutoMode ? 'ON' : 'OFF');
    sight.auto = archeryAutoMode;
  };
}

function startArcheryGame() {
  document.getElementById('scratchGame').style.display = 'none';
  document.getElementById('fruitGame').style.display = 'none';
  document.getElementById('tictactoeGame').style.display = 'none';
  document.getElementById('findAceGame').style.display = 'none';
  document.getElementById('archeryGame').style.display = 'block';
}

// Helper function to shuffle array
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Particles effect
particlesJS("particles-js", {
  "particles": {
    "number": { "value": 100 },
    "color": { "value": "#FFD700" },
    "shape": { "type": "star" },
    "opacity": { "value": 0.8 },
    "size": { "value": 5 },
    "move": { "enable": true, "speed": 8 }
  },
  "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false } } },
  "retina_detect": true
});
</script>
</body>
</html>
